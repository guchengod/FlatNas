import{d as _t,u as Ct,r as h,S as Tt,U as St,c as Y,C as $t,w as Ge,y as Pt,V as Mt,K as ae,J as It,a as i,e as n,b as c,g as l,E as Qe,p as k,i as _,t as v,F as S,h as W,q as ke,j as Lt,f as j,T as Ze,l as Et,m as jt,n as Dt,x as qe,W as Ot,L as zt,_ as Ut}from"./index-DXce9nG8.js";const Rt={key:0,class:"absolute inset-0 z-20 pointer-events-none flex items-center justify-center"},Bt={key:1,class:"border-b border-white/10 px-3 py-2"},Nt={class:"mt-2 flex items-center justify-between gap-2 flex-wrap"},At={class:"flex items-center gap-1 bg-white/10 rounded-xl p-1 border border-white/10"},Ft={class:"flex items-center gap-2"},Ht=["disabled"],Yt={key:2,class:"px-3 py-2 border-b border-white/10 space-y-2"},Wt={class:"flex-1 min-w-0"},Xt={class:"flex items-center justify-between gap-2"},Kt={class:"text-xs font-semibold text-white truncate"},Jt={class:"text-[11px] text-white/60 shrink-0"},Vt={class:"mt-1 h-1.5 bg-white/10 rounded-full overflow-hidden"},Gt={class:"mt-1 flex items-center justify-between"},Qt={class:"text-[11px] text-white/60"},Zt={key:0,class:"text-red-200 ml-2"},qt={class:"flex items-center gap-1"},eo=["onClick"],to=["onClick"],oo=["onClick"],so=["disabled"],no=["disabled"],lo=["disabled"],io={key:1,class:"h-px bg-white/10"},ro={class:"flex-1 min-h-0 overflow-hidden"},ao={key:0,class:"h-full flex items-center justify-center text-white/70"},co={key:1,class:"h-full flex flex-col"},uo={key:0,class:"px-3 py-2 text-xs text-red-100 bg-red-500/20 border-b border-red-500/20"},fo={key:1,class:"px-3 py-2 text-xs text-white/60"},ho={key:0,class:"text-center text-white/70 text-sm py-10"},vo={key:1,class:"space-y-2"},po={class:"flex justify-center"},xo={class:"px-2 py-0.5 rounded-full bg-white/10 border border-white/10 text-[10px] text-white/60"},wo=["data-transfer-id","onClick","onContextmenu","onPointerdown","onTouchstart"],go={class:"whitespace-pre-wrap break-words"},bo=["href"],mo={key:1},yo=["data-transfer-id","onClick","onContextmenu","onPointerdown","onTouchstart"],ko={class:"flex items-center gap-3"},_o={class:"w-10 h-10 rounded-xl bg-white/10 flex items-center justify-center border border-white/10 overflow-hidden"},Co=["src"],To={key:1},So={class:"min-w-0"},$o={class:"text-[11px] text-white/60"},Po={key:0,class:"text-center text-white/70 text-sm py-10"},Mo={key:1,class:"space-y-2"},Io=["checked","onChange"],Lo={class:"w-9 h-9 rounded-xl bg-white/10 border border-white/10 flex items-center justify-center shrink-0 overflow-hidden"},Eo=["src"],jo={key:1},Do={key:2},Oo={class:"flex-1 min-w-0"},zo={class:"text-sm font-bold text-white truncate"},Uo={class:"text-[11px] text-white/60"},Ro={class:"flex items-center gap-1"},Bo=["onClick"],No=["onClick"],Ao=["onClick"],Fo={key:0,class:"text-center text-white/70 text-sm py-10"},Ho={key:1,class:"grid grid-cols-2 md:grid-cols-3 gap-2"},Yo=["onClick"],Wo=["src","alt"],Xo={key:1,class:"text-white/60 text-sm"},Ko=["placeholder"],Jo={class:"px-4 py-3 border-b border-white/10 flex items-center justify-between"},Vo={class:"min-w-0"},Go={class:"text-sm font-bold text-white truncate"},Qo={key:0,class:"text-[11px] text-white/60"},Zo={class:"flex items-center gap-2"},qo={class:"p-4"},es={key:0},ts=["src","alt"],os={key:1,class:"rounded-xl bg-white/5 border border-white/10 p-4 text-sm text-white/80"},ss=2,ns=50*1024*1024,ls=1800*1e3,is=_t({__name:"FileTransferWidget",props:{widget:{}},setup(_e){const ce=_e,u=Ct(),X=h(null),{isMobile:et}=Tt(St(u.appConfig,"deviceMode")),$=Y(()=>ce.widget.w===1&&ce.widget.h===2),b=$t(`flatnas-transfer-tab-${ce.widget.id}`,"chat"),de=h(!1),L=h(null),p=h([]),K=h(null),tt=async()=>{await qe(),K.value&&(K.value.scrollTop=K.value.scrollHeight)},J=h(""),Ce=h(null),Te=h(null),B=h(!1),V=h(0),G=h(!1),N=h(!1),Se=h(0),$e=h(0),w=h(null),P=h([]),te=h(0),ue=h(!1),x=h(null),f=h({});let D=null;const ot=Y(()=>[...p.value].sort((e,t)=>(e.timestamp||0)-(t.timestamp||0))),Pe=Y(()=>{const e=ot.value,t=[];let o=-1;for(const s of e){const r=Number(s.timestamp)||0,a=t[t.length-1];!a||o>=0&&r-o>ls?t.push({key:s.id,timestamp:r,items:[s]}):a.items.push(s),o=r}return t}),g=h({}),O=Y(()=>Object.values(g.value).filter(Boolean).length),st=(e,t)=>{const o={...g.value};t?o[e]=!0:delete o[e],g.value=o},Me=e=>st(e,!g.value[e]),Q=()=>{const e=u.token||localStorage.getItem("flat-nas-token"),t={};return e&&(t.Authorization=`Bearer ${e}`),t},Z=e=>{const t=Number(e)||0;if(t<1024)return`${t} B`;const o=t/1024;if(o<1024)return`${o.toFixed(1)} KB`;const s=o/1024;return s<1024?`${s.toFixed(1)} MB`:`${(s/1024).toFixed(2)} GB`},nt=e=>{try{return new Date(e).toLocaleString()}catch{return""}},lt=e=>{try{const t=new Date(e),o=new Date;return t.getFullYear()===o.getFullYear()&&t.getMonth()===o.getMonth()&&t.getDate()===o.getDate()?t.toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit"}):t.toLocaleString(void 0,{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return""}},it=e=>{const t=String(e??"");if(!t)return[{kind:"text",text:""}];const o=/https?:\/\/[^\s<>"'`]+/g,s=[];let r=0;for(const a of t.matchAll(o)){const m=a[0]||"",y=a.index??-1;if(!m||y<0)continue;y>r&&s.push({kind:"text",text:t.slice(r,y)});let d=m,I="";for(;d&&/[)\]}\.,!?;:]+$/.test(d);)I=d.slice(-1)+I,d=d.slice(0,-1);d&&d!=="http://"&&d!=="https://"?s.push({kind:"link",text:d,href:d}):s.push({kind:"text",text:m}),I&&s.push({kind:"text",text:I}),r=y+m.length}return r<t.length&&s.push({kind:"text",text:t.slice(r)}),s.length?s:[{kind:"text",text:t}]},rt=e=>`${e.name}|${e.size}|${e.lastModified}`,at=e=>{const t=e.currentTarget,{scrollTop:o,scrollHeight:s,clientHeight:r}=t,a=e.deltaY,m=o<=0,y=o+r>=s-1;(m&&a<0||y&&a>0)&&(e.preventDefault(),e.stopPropagation())},Ie=e=>{if(e.type==="add"&&e.item)p.value.some(t=>t.id===e.item.id)||(p.value=[e.item,...p.value].slice(0,1e3));else if(e.type==="delete"&&e.id){if(p.value=p.value.filter(t=>t.id!==e.id),g.value[e.id]){const t={...g.value};delete t[e.id],g.value=t}x.value?.id===e.id&&ie()}},Le=async()=>{if(u.isLogged){de.value=!0,L.value=null;try{const e=b.value==="photos"?"photo":b.value==="files"?"file":"all",t=Q(),o=await fetch(`/api/transfer/items?type=${encodeURIComponent(e)}&limit=1000`,{headers:t}),s=await o.json().catch(()=>({}));if(!o.ok||!s.success)throw new Error(s.error||`HTTP ${o.status}`);p.value=Array.isArray(s.items)?s.items:[]}catch(e){const t=e instanceof Error?e.message:String(e);L.value=t||"åŠ è½½å¤±è´¥"}finally{de.value=!1}}},Ee=()=>Te.value?.click(),fe=e=>{if(!u.isLogged)return;const t=e.filter(o=>o&&o.size>0);if(t.length){for(const o of t)P.value.push({id:`q-${Date.now()}-${Math.random().toString(36).slice(2,8)}`,file:o,status:"queued",progress:0});he()}},ct=e=>{const t=e.target,o=t.files?Array.from(t.files):[];fe(o),t&&(t.value="")},dt=e=>{e.preventDefault(),e.stopPropagation(),B.value=!1,V.value=0;const t=e.dataTransfer?.files?Array.from(e.dataTransfer.files):[];fe(t)},je=e=>Array.from(e.dataTransfer?.types||[]).includes("Files"),ut=e=>{je(e)&&(V.value+=1,B.value=!0)},ft=e=>{je(e)&&(e.preventDefault(),B.value=!0)},ht=()=>{V.value=Math.max(0,V.value-1),V.value===0&&(B.value=!1)},z=e=>p.value.find(t=>t.id===e)||null,C=()=>{N.value=!1,w.value=null},q=(e,t,o)=>{Se.value=Math.max(8,Math.min(e,window.innerWidth-196-8)),$e.value=Math.max(8,Math.min(t,window.innerHeight-220-8)),w.value=o,N.value=!0},vt=e=>{if(!u.isLogged)return;e.preventDefault();const o=e.target?.closest?.("[data-transfer-id]");q(e.clientX,e.clientY,o?.dataset.transferId||null)},De=e=>{if(oe===e.id){oe=null;return}if(G.value){Me(e.id);return}e.type==="file"&&le(e)},pt=Y(()=>{if(typeof navigator>"u")return!1;const e=navigator;return Math.max(0,e.maxTouchPoints||0,e.msMaxTouchPoints||0)>0?!0:typeof window<"u"&&"ontouchstart"in window}),Oe=Y(()=>pt.value);let U=null,A=0,F=0,M=null,oe=null,H=null;const E=()=>{U&&window.clearTimeout(U),U=null,M=null,H=null},ze=(e,t)=>{if(!u.isLogged||!Oe.value||N.value||H==="pointer")return;const o=e.touches&&e.touches[0];o&&(E(),H="touch",A=o.clientX,F=o.clientY,M=t,U=window.setTimeout(()=>{M&&(oe=M,q(A,F,M),E())},520))},Ue=e=>{if(!U||H!=="touch")return;const t=e.touches&&e.touches[0];if(!t)return;const o=t.clientX-A,s=t.clientY-F;o*o+s*s>256&&E()},se=()=>{E()},Re=(e,t)=>{u.isLogged&&Oe.value&&(N.value||e.pointerType==="touch"&&(E(),H="pointer",A=e.clientX,F=e.clientY,M=t,U=window.setTimeout(()=>{M&&(oe=M,q(A,F,M),E())},520)))},Be=e=>{if(!U||H!=="pointer"||e.pointerType!=="touch")return;const t=e.clientX-A,o=e.clientY-F;t*t+o*o>256&&E()},ne=()=>{E()},Ne=()=>{g.value={}},xt=()=>{G.value=!G.value,G.value||Ne()},wt=async e=>{try{await navigator.clipboard.writeText(e)}catch(t){console.error("Copy failed",t)}},Ae=e=>{e.key==="Escape"&&C()},Fe=e=>{!N.value||e.button!==0||e.target?.closest?.("[data-transfer-context-menu]")||C()},He=e=>{const t=e.clipboardData;if(!t)return;const o=[];for(const s of Array.from(t.items||[]))if(s.kind==="file"){const r=s.getAsFile();r&&o.push(r)}o.length&&(fe(o),e.preventDefault())},he=()=>{if(u.isLogged)for(;te.value<ss;){const e=P.value.find(t=>t.status==="queued");if(!e)break;mt(e)}},ve=e=>{e.abort&&e.abort.abort(),e.abort=void 0,e.status==="uploading"&&(e.status="paused")},gt=e=>{e.status!=="paused"&&e.status!=="failed"||(e.status="queued",e.error=void 0,he())},bt=e=>{ve(e),P.value=P.value.filter(t=>t.id!==e.id)},mt=async e=>{te.value+=1,e.status="uploading",e.progress=Math.max(0,Math.min(1,e.progress||0)),e.error=void 0;const t=new AbortController;e.abort=t;try{const s=await fetch("/api/transfer/upload/init",{method:"POST",headers:u.getHeaders(),body:JSON.stringify({fileName:e.file.name,size:e.file.size,mime:e.file.type||"",fileKey:rt(e.file),chunkSize:5242880}),signal:t.signal}),r=await s.json().catch(()=>({}));if(!s.ok||!r.success)throw new Error(r.error||`HTTP ${s.status}`);const a=String(r.uploadId||""),m=Number(r.chunkSize||5242880),y=Number(r.totalChunks||0),d=new Set(Array.isArray(r.uploaded)?r.uploaded.map(T=>Number(T)):[]);if(!a||!Number.isFinite(y)||y<=0)throw new Error("ä¸Šä¼ åˆå§‹åŒ–å¤±è´¥");let I=0;d.size&&(I=Math.min(e.file.size,d.size*m),e.progress=I/e.file.size);for(let T=0;T<y;T++){if(d.has(T))continue;const Ke=T*m,kt=Math.min(e.file.size,Ke+m),Je=e.file.slice(Ke,kt);let ye=0;for(;;){ye+=1;try{const R=new FormData;R.append("uploadId",a),R.append("index",String(T)),R.append("chunk",Je,`${e.file.name}.part`);const ee=await fetch("/api/transfer/upload/chunk",{method:"POST",headers:Q(),body:R,signal:t.signal}),Ve=await ee.json().catch(()=>({}));if(!ee.ok||!Ve.success)throw new Error(Ve.error||`HTTP ${ee.status}`);I+=Je.size,e.progress=Math.max(0,Math.min(1,I/e.file.size));break}catch(R){if(t.signal.aborted||ye>=3)throw R;await new Promise(ee=>setTimeout(ee,300*ye))}}}const ge=await fetch("/api/transfer/upload/complete",{method:"POST",headers:u.getHeaders(),body:JSON.stringify({uploadId:a}),signal:t.signal}),be=await ge.json().catch(()=>({}));if(!ge.ok||!be.success)throw new Error(be.error||`HTTP ${ge.status}`);e.status="completed",e.progress=1;const me=be.item;me?p.value.some(T=>T.id===me.id)||(p.value=[me,...p.value].slice(0,200)):await Le(),P.value=P.value.filter(T=>T.id!==e.id)}catch(o){if(t.signal.aborted)e.status==="uploading"&&(e.status="paused");else{const s=o instanceof Error?o.message:String(o);e.status="failed",e.error=s||"ä¸Šä¼ å¤±è´¥"}}finally{e.abort===t&&(e.abort=void 0),te.value=Math.max(0,te.value-1),he()}},pe=async()=>{if(!u.isLogged)return;const e=J.value.trim();if(e){J.value="",await qe();try{const t=await fetch("/api/transfer/text",{method:"POST",headers:u.getHeaders(),body:JSON.stringify({text:e})}),o=await t.json().catch(()=>({}));if(!t.ok||!o.success)throw new Error(o.error||`HTTP ${t.status}`);const s=o.item;s&&!p.value.some(r=>r.id===s.id)&&(p.value=[s,...p.value].slice(0,200))}catch(t){const o=t instanceof Error?t.message:String(t);L.value=o||"å‘é€å¤±è´¥"}finally{Ce.value?.focus()}}},le=async e=>{x.value=e,ue.value=!0,e.type==="file"&&await Ye(e.id,e.file.url)},ie=()=>{const e=x.value?.id;ue.value=!1,x.value=null,e&&Xe(e)},Ye=async(e,t)=>{if(f.value[e])return Ot(`transfer:${e}`),f.value[e];const o=Q(),s=await fetch(t,{headers:o});if(!s.ok)throw new Error(`HTTP ${s.status}`);const r=await s.blob(),a=zt(`transfer:${e}`,r);return f.value={...f.value,[e]:a},a},xe=async e=>{if(!e||e.type!=="file"||et.value&&e.file.size>=ns&&!confirm(`æ£€æµ‹åˆ°æ–‡ä»¶è¾ƒå¤§ï¼ˆ${Z(e.file.size)}ï¼‰ï¼Œå¯èƒ½è€—æ—¶ä¸”å ç”¨è¾ƒå¤šæµé‡/å†…å­˜ï¼Œæ˜¯å¦ç»§ç»­ä¸‹è½½ï¼Ÿ`))return;try{const m=await fetch("/api/transfer/download-token",{method:"POST",headers:u.getHeaders(),body:JSON.stringify({url:e.file.url})}),y=await m.json().catch(()=>({}));if(m.ok&&y.success&&typeof y.token=="string"){const d=document.createElement("a");d.href=`${e.file.url}?download=1&token=${encodeURIComponent(y.token)}`,d.download=e.file.name||"download",d.target="_blank",d.rel="noopener noreferrer",document.body.appendChild(d),d.click(),d.remove();return}}catch{}const t=Q(),o=await fetch(`${e.file.url}?download=1`,{headers:t});if(!o.ok)throw new Error(`HTTP ${o.status}`);const s=await o.blob(),r=URL.createObjectURL(s),a=document.createElement("a");a.href=r,a.download=e.file.name||"download",document.body.appendChild(a),a.click(),a.remove(),setTimeout(()=>URL.revokeObjectURL(r),1e3)},re=async e=>{if(u.isLogged)try{const t=Q(),o=await fetch(`/api/transfer/items/${encodeURIComponent(e)}`,{method:"DELETE",headers:t}),s=await o.json().catch(()=>({}));if(!o.ok||!s.success)throw new Error(s.error||`HTTP ${o.status}`);if(p.value=p.value.filter(a=>a.id!==e),g.value=Object.fromEntries(Object.entries(g.value).filter(([a])=>a!==e)),f.value[e]){ae(`transfer:${e}`,!0);const a={...f.value};delete a[e],f.value=a}x.value?.id===e&&ie()}catch(t){const o=t instanceof Error?t.message:String(t);L.value=o||"åˆ é™¤å¤±è´¥"}},We=async()=>{const e=Object.entries(g.value).filter(([,t])=>t).map(([t])=>t);for(const t of e)await re(t)};Ge(()=>[u.isLogged,b.value],async()=>{g.value={},u.isLogged&&(await Le(),b.value==="chat"&&tt())},{immediate:!0});const Xe=e=>{if(x.value?.id===e)return;if(f.value[e]){ae(`transfer:${e}`);const o={...f.value};delete o[e],f.value=o}},yt=()=>{D||(D=new IntersectionObserver(e=>{for(const t of e){const s=t.target.dataset.observeId;if(s)if(t.isIntersecting){const r=z(s);r&&r.type==="file"&&String(r.file.type||"").startsWith("image/")&&Ye(r.id,r.file.url).catch(()=>{})}else Xe(s)}},{root:K.value,rootMargin:"500px 0px 500px 0px"}))},we=(e,t)=>{if(!e||!D)return;const o=e instanceof Element?e:e.$el;o&&o instanceof HTMLElement&&(o.dataset.observeId=t,D.observe(o))};return Pt(()=>{document.addEventListener("paste",He),document.addEventListener("keydown",Ae),document.addEventListener("pointerdown",Fe,!0),X.value=Mt(),X.value.on("transfer:update",Ie),yt()}),Ge(b,()=>{for(const e of Object.keys(f.value))ae(`transfer:${e}`);f.value={}}),It(()=>{document.removeEventListener("paste",He),document.removeEventListener("keydown",Ae),document.removeEventListener("pointerdown",Fe,!0),X.value&&(X.value.off("transfer:update",Ie),X.value.close()),D&&(D.disconnect(),D=null),P.value.forEach(e=>ve(e));for(const e of Object.keys(f.value))ae(`transfer:${e}`)}),(e,t)=>(n(),i("div",{class:k(["w-full h-full rounded-2xl backdrop-blur border border-white/10 overflow-hidden flex flex-col text-white relative transition-shadow",B.value?"shadow-[0_0_0_2px_rgba(96,165,250,0.55)]":""]),style:ke({backgroundColor:`rgba(0,0,0,${Math.min(.85,Math.max(.15,_e.widget.opacity??.35))})`,color:"#fff"}),onDrop:dt,onDragenter:ut,onDragover:ft,onDragleave:ht},[B.value?(n(),i("div",Rt,[...t[20]||(t[20]=[l("div",{class:"w-[92%] h-[92%] rounded-2xl border-2 border-dashed border-blue-300/70 bg-blue-500/10 backdrop-blur-sm flex items-center justify-center"},[l("div",{class:"text-sm font-bold text-white/90"},"æ¾å¼€é¼ æ ‡å³å¯ä¸Šä¼ ")],-1)])])):c("",!0),l("input",{ref_key:"fileInputRef",ref:Te,type:"file",multiple:"",class:"hidden",onChange:ct},null,544),$.value?c("",!0):(n(),i("div",Bt,[t[21]||(t[21]=l("div",{class:"flex flex-wrap items-baseline gap-x-2 gap-y-0.5 leading-tight"},[l("div",{class:"text-sm font-bold text-white"},"æ–‡ä»¶ä¼ è¾“åŠ©æ‰‹"),l("div",{class:"text-[11px] text-white/70"},"æ”¯æŒæ‹–æ‹½ã€å¤šé€‰ã€æ–­ç‚¹ç»­ä¼ ")],-1)),l("div",Nt,[l("div",At,[l("button",{onClick:t[0]||(t[0]=o=>b.value="chat"),class:k(["px-2.5 py-1 text-xs rounded-lg font-medium",_(b)==="chat"?"bg-white/20 text-white shadow-sm":"text-white/70"])}," èŠå¤© ",2),l("button",{onClick:t[1]||(t[1]=o=>b.value="files"),class:k(["px-2.5 py-1 text-xs rounded-lg font-medium",_(b)==="files"?"bg-white/20 text-white shadow-sm":"text-white/70"])}," æ–‡ä»¶ ",2),l("button",{onClick:t[2]||(t[2]=o=>b.value="photos"),class:k(["px-2.5 py-1 text-xs rounded-lg font-medium",_(b)==="photos"?"bg-white/20 text-white shadow-sm":"text-white/70"])}," å›¾ç‰‡ ",2)]),l("div",Ft,[l("button",{class:k(["px-3 py-1.5 text-xs font-bold rounded-lg transition-colors",_(u).isLogged?"bg-blue-500 text-white hover:bg-blue-600":"bg-white/10 text-white/40 cursor-not-allowed"]),disabled:!_(u).isLogged,onClick:Ee}," æ·»åŠ æ–‡ä»¶ ",10,Ht),_(b)==="files"&&O.value>0?(n(),i("button",{key:0,class:"px-3 py-1.5 text-xs font-bold rounded-lg bg-red-500/20 text-red-100 hover:bg-red-500/30",onClick:We}," åˆ é™¤é€‰ä¸­ ("+v(O.value)+") ",1)):c("",!0)])])])),P.value.length?(n(),i("div",Yt,[(n(!0),i(S,null,W(P.value,o=>(n(),i("div",{key:o.id,class:"rounded-xl border border-white/10 bg-white/5 px-3 py-2 flex items-center gap-3"},[l("div",Wt,[l("div",Xt,[l("div",Kt,v(o.file.name),1),l("div",Jt,v(Z(o.file.size)),1)]),l("div",Vt,[l("div",{class:"h-full bg-blue-500 rounded-full transition-[width]",style:ke({width:`${Math.round((o.progress||0)*100)}%`})},null,4)]),l("div",Gt,[l("div",Qt,[Lt(v(o.status==="uploading"?"ä¸Šä¼ ä¸­":o.status==="paused"?"å·²æš‚åœ":o.status==="failed"?"å¤±è´¥":o.status==="completed"?"å®Œæˆ":"ç­‰å¾…ä¸­")+" ",1),o.error?(n(),i("span",Zt,v(o.error),1)):c("",!0)]),l("div",qt,[o.status==="uploading"?(n(),i("button",{key:0,class:"px-2 py-1 text-[11px] rounded-lg bg-white/10 text-white hover:bg-white/15",onClick:s=>ve(o)}," æš‚åœ ",8,eo)):c("",!0),o.status==="paused"||o.status==="failed"?(n(),i("button",{key:1,class:"px-2 py-1 text-[11px] rounded-lg bg-blue-500/20 text-blue-100 hover:bg-blue-500/30",onClick:s=>gt(o)}," ç»§ç»­ ",8,to)):c("",!0),l("button",{class:"px-2 py-1 text-[11px] rounded-lg bg-red-500/20 text-red-100 hover:bg-red-500/30",onClick:s=>bt(o)}," ç§»é™¤ ",8,oo)])])])]))),128))])):c("",!0),(n(),Qe(Ze,{to:"body"},[N.value?(n(),i("div",{key:0,"data-transfer-context-menu":"",class:"fixed z-[10001] w-48 rounded-xl border border-white/10 bg-black/70 backdrop-blur shadow-xl overflow-hidden",style:ke({left:`${Se.value}px`,top:`${$e.value}px`}),onClick:t[12]||(t[12]=j(()=>{},["stop"])),onContextmenu:t[13]||(t[13]=j(()=>{},["prevent"]))},[w.value&&z(w.value)?.type==="text"?(n(),i("button",{key:0,class:"w-full text-left px-2.5 py-1.5 text-[13px] hover:bg-white/10 transition-colors text-white",onClick:t[3]||(t[3]=async()=>{const o=w.value,s=o?z(o):null;C(),s&&s.type==="text"&&await wt(s.content)})}," å¤åˆ¶ ")):c("",!0),l("button",{class:k(["w-full text-left px-2.5 py-1.5 text-[13px] hover:bg-white/10 transition-colors",_(u).isLogged?"text-white":"text-white/40 cursor-not-allowed"]),disabled:!_(u).isLogged,onClick:t[4]||(t[4]=()=>{C(),Ee()})}," æ·»åŠ æ–‡ä»¶ ",10,so),l("button",{class:"w-full text-left px-2.5 py-1.5 text-[13px] hover:bg-white/10 transition-colors text-white",onClick:t[5]||(t[5]=()=>{C(),xt()})},v(G.value?"é€€å‡ºå¤šé€‰":"å¤šé€‰"),1),l("button",{class:k(["w-full text-left px-2.5 py-1.5 text-[13px] hover:bg-white/10 transition-colors",O.value>0?"text-white":"text-white/40 cursor-not-allowed"]),disabled:O.value===0,onClick:t[6]||(t[6]=async()=>{C(),await We()})}," åˆ é™¤é€‰ä¸­ ("+v(O.value)+") ",11,no),l("button",{class:k(["w-full text-left px-2.5 py-1.5 text-[13px] hover:bg-white/10 transition-colors",O.value>0?"text-white":"text-white/40 cursor-not-allowed"]),disabled:O.value===0,onClick:t[7]||(t[7]=()=>{C(),Ne()})}," æ¸…ç©ºé€‰æ‹© ",10,lo),w.value?(n(),i("div",io)):c("",!0),w.value?(n(),i("button",{key:2,class:"w-full text-left px-2.5 py-1.5 text-[13px] hover:bg-white/10 transition-colors text-white",onClick:t[8]||(t[8]=()=>{const o=w.value;C(),o&&Me(o)})},v(w.value&&g.value[w.value]?"å–æ¶ˆé€‰æ‹©":"é€‰æ‹©"),1)):c("",!0),w.value?(n(),i("button",{key:3,class:"w-full text-left px-2.5 py-1.5 text-[13px] hover:bg-white/10 transition-colors text-white",onClick:t[9]||(t[9]=async()=>{const o=w.value;C(),o&&await re(o)})}," åˆ é™¤æ­¤æ¡ ")):c("",!0),w.value&&z(w.value)?.type==="file"?(n(),i("button",{key:4,class:"w-full text-left px-2.5 py-1.5 text-[13px] hover:bg-white/10 transition-colors text-white",onClick:t[10]||(t[10]=async()=>{const o=w.value,s=o?z(o):null;C(),s&&s.type==="file"&&le(s)})}," é¢„è§ˆ ")):c("",!0),w.value&&z(w.value)?.type==="file"?(n(),i("button",{key:5,class:"w-full text-left px-2.5 py-1.5 text-[13px] hover:bg-white/10 transition-colors text-white",onClick:t[11]||(t[11]=async()=>{const o=w.value,s=o?z(o):null;C(),s&&s.type==="file"&&await xe(s)})}," ä¸‹è½½ ")):c("",!0)],36)):c("",!0)])),l("div",ro,[_(u).isLogged?(n(),i("div",co,[L.value?(n(),i("div",uo,v(L.value),1)):c("",!0),de.value?(n(),i("div",fo,"åŠ è½½ä¸­...")):(n(),i("div",{key:2,ref_key:"scrollContainerRef",ref:K,class:"flex-1 min-h-0 overflow-y-auto px-3 py-3 space-y-3 scrollbar-glass",onWheel:at,onContextmenu:j(vt,["prevent","stop"])},[_(b)==="chat"?(n(),i(S,{key:0},[Pe.value.length?(n(),i("div",vo,[(n(!0),i(S,null,W(Pe.value,o=>(n(),i("div",{key:o.key,class:"space-y-1.5"},[l("div",po,[l("div",xo,v(lt(o.timestamp)),1)]),(n(!0),i(S,null,W(o.items,s=>(n(),i("div",{key:s.id,class:"flex"},[s.type==="text"?(n(),i("div",{key:0,class:k(["max-w-[90%] rounded-xl bg-white/10 text-white border border-white/10 transition-shadow select-text",[g.value[s.id]?"shadow-[0_0_0_2px_rgba(96,165,250,0.55)]":"",$.value?"px-2 py-1.5 text-xs":"px-3 py-2 text-sm"]]),"data-transfer-id":s.id,onClick:r=>De(s),onContextmenu:j(r=>q(r.clientX,r.clientY,s.id),["prevent","stop"]),onPointerdown:r=>Re(r,s.id),onPointermove:Be,onPointerup:ne,onPointercancel:ne,onTouchstart:r=>ze(r,s.id),onTouchmove:Ue,onTouchend:se,onTouchcancel:se},[l("div",go,[(n(!0),i(S,null,W(it(s.content),(r,a)=>(n(),i(S,{key:a},[r.kind==="link"?(n(),i("a",{key:0,href:r.href,target:"_blank",rel:"noopener noreferrer",class:"text-blue-200 underline underline-offset-2 hover:text-blue-100",onClick:t[14]||(t[14]=j(()=>{},["stop"]))},v(r.text),9,bo)):(n(),i("span",mo,v(r.text),1))],64))),128))])],42,wo)):(n(),i("button",{key:1,class:k(["max-w-[90%] text-left rounded-xl bg-white/10 hover:bg-white/15 transition-colors border border-white/10 transition-shadow select-none",[g.value[s.id]?"shadow-[0_0_0_2px_rgba(96,165,250,0.55)]":"",$.value?"px-2 py-1.5":"px-3 py-2"]]),"data-transfer-id":s.id,ref_for:!0,ref:r=>we(r,s.id),style:{"-webkit-touch-callout":"none"},onClick:r=>De(s),onContextmenu:j(r=>q(r.clientX,r.clientY,s.id),["prevent","stop"]),onPointerdown:r=>Re(r,s.id),onPointermove:Be,onPointerup:ne,onPointercancel:ne,onTouchstart:r=>ze(r,s.id),onTouchmove:Ue,onTouchend:se,onTouchcancel:se},[l("div",ko,[l("div",_o,[String(s.file.type||"").startsWith("image/")&&f.value[s.id]?(n(),i("img",{key:0,src:f.value[s.id],class:"w-full h-full object-cover"},null,8,Co)):(n(),i("span",To,v(String(s.file.type||"").startsWith("image/")?"ğŸ–¼ï¸":"ğŸ“„"),1))]),l("div",So,[l("div",{class:k(["font-bold text-white truncate",$.value?"text-xs":"text-sm"])},v(s.file.name),3),l("div",$o,v(Z(s.file.size)),1)])])],42,yo))]))),128))]))),128))])):(n(),i("div",ho,[...t[23]||(t[23]=[l("div",{class:"text-3xl mb-2"},"ğŸ’¬",-1),l("div",{class:"font-bold text-white"},"æŠŠæ–‡ä»¶å’Œæ–‡å­—å‘åˆ°è¿™é‡Œ",-1),l("div",{class:"text-xs text-white/60 mt-1"},"æ”¯æŒæ‹–æ‹½ä¸Šä¼ ï¼›æ”¯æŒå¤åˆ¶ç²˜è´´å›¾ç‰‡/æ–‡ä»¶",-1)])]))],64)):_(b)==="files"?(n(),i(S,{key:1},[p.value.length?(n(),i("div",Mo,[(n(!0),i(S,null,W(p.value,o=>(n(),i("div",{key:o.id,class:"rounded-xl border border-white/10 bg-white/5 hover:bg-white/10 transition-colors px-3 py-2 flex items-center gap-3",ref_for:!0,ref:s=>we(s,o.id)},[o.type==="file"?(n(),i("input",{key:0,type:"checkbox",class:"accent-blue-600",checked:!!g.value[o.id],onChange:s=>{g.value[o.id]=s.target.checked}},null,40,Io)):c("",!0),l("div",Lo,[o.type==="file"&&String(o.file.type||"").startsWith("image/")&&f.value[o.id]?(n(),i("img",{key:0,src:f.value[o.id],class:"w-full h-full object-cover"},null,8,Eo)):o.type==="file"&&String(o.file.type||"").startsWith("image/")?(n(),i("span",jo,"ğŸ–¼ï¸")):(n(),i("span",Do,"ğŸ“„"))]),l("div",Oo,[l("div",zo,v(o.type==="file"?o.file.name:""),1),l("div",Uo,v(o.type==="file"?Z(o.file.size):"")+" Â· "+v(nt(o.timestamp)),1)]),l("div",Ro,[o.type==="file"?(n(),i("button",{key:0,class:"px-2 py-1 text-[11px] rounded-lg bg-white/10 text-white hover:bg-white/15",onClick:s=>le(o)}," é¢„è§ˆ ",8,Bo)):c("",!0),o.type==="file"?(n(),i("button",{key:1,class:"px-2 py-1 text-[11px] rounded-lg bg-white/10 text-white hover:bg-white/15",onClick:async()=>{try{await xe(o)}catch(s){L.value=s.message||"ä¸‹è½½å¤±è´¥"}}}," ä¸‹è½½ ",8,No)):c("",!0),l("button",{class:"px-2 py-1 text-[11px] rounded-lg bg-red-500/20 text-red-100 hover:bg-red-500/30",onClick:s=>re(o.id)}," åˆ é™¤ ",8,Ao)])]))),128))])):(n(),i("div",Po,[...t[24]||(t[24]=[l("div",{class:"text-3xl mb-2"},"ğŸ“",-1),l("div",{class:"font-bold text-white"},"æš‚æ— æ–‡ä»¶",-1)])]))],64)):(n(),i(S,{key:2},[p.value.length?(n(),i("div",Ho,[(n(!0),i(S,null,W(p.value,o=>(n(),i("button",{key:o.id,class:"rounded-xl border border-white/10 bg-white/5 hover:bg-white/10 overflow-hidden aspect-square flex items-center justify-center",onClick:s=>le(o),ref_for:!0,ref:s=>we(s,o.id)},[o.type==="file"&&f.value[o.id]?(n(),i("img",{key:0,src:f.value[o.id],class:"w-full h-full object-cover",alt:o.file.name},null,8,Wo)):(n(),i("div",Xo,"åŠ è½½ä¸­..."))],8,Yo))),128))])):(n(),i("div",Fo,[...t[25]||(t[25]=[l("div",{class:"text-3xl mb-2"},"ğŸ–¼ï¸",-1),l("div",{class:"font-bold text-white"},"æš‚æ— å›¾ç‰‡",-1)])]))],64))],544)),_(b)==="chat"?(n(),i("div",{key:3,class:k(["border-t border-white/10",$.value?"p-1":"p-3"])},[l("div",{class:k($.value?"relative block":"flex items-end gap-2")},[Et(l("textarea",{ref_key:"composerRef",ref:Ce,"onUpdate:modelValue":t[15]||(t[15]=o=>J.value=o),rows:"1",placeholder:$.value?"ç²˜è´´/æ‹–å…¥ (Shift+Enter)":"Shift+Enter æ¢è¡Œ",class:k(["resize-none rounded-xl border border-white/20 bg-white/10 outline-none text-white placeholder-white/50 focus:border-blue-400",$.value?"w-full pr-8 pl-2 py-1 text-xs scrollbar-hide":"flex-1 px-3 py-2 text-sm"]),onKeydown:t[16]||(t[16]=Dt(j(o=>{if(o.shiftKey){J.value+=`
`;return}pe()},["prevent"]),["enter"]))},null,42,Ko),[[jt,J.value]]),$.value?(n(),i("button",{key:0,class:"absolute right-1 bottom-1 p-1 text-blue-400 hover:text-blue-300 transition-colors",onClick:pe},[...t[26]||(t[26]=[l("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[l("line",{x1:"22",y1:"2",x2:"11",y2:"13"}),l("polygon",{points:"22 2 15 22 11 13 2 9 22 2"})],-1)])])):(n(),i("button",{key:1,class:"px-3 py-2 text-xs font-bold rounded-xl bg-blue-500 text-white hover:bg-blue-600",onClick:pe}," å‘é€ "))],2)],2)):c("",!0)])):(n(),i("div",ao,[...t[22]||(t[22]=[l("div",{class:"text-center px-6"},[l("div",{class:"text-3xl mb-2"},"ğŸ”’"),l("div",{class:"text-sm font-bold text-white"},"ç™»å½•åä½¿ç”¨æ–‡ä»¶ä¼ è¾“åŠ©æ‰‹")],-1)])]))]),(n(),Qe(Ze,{to:"body"},[ue.value&&x.value?(n(),i("div",{key:0,class:"fixed inset-0 z-[9999] bg-black/40 backdrop-blur-sm flex items-center justify-center p-4",onClick:ie},[l("div",{class:"w-full max-w-3xl rounded-2xl bg-black/50 backdrop-blur border border-white/10 shadow-xl overflow-hidden text-white",onClick:t[19]||(t[19]=j(()=>{},["stop"]))},[l("div",Jo,[l("div",Vo,[l("div",Go,v(x.value.type==="file"?x.value.file.name:"é¢„è§ˆ"),1),x.value.type==="file"?(n(),i("div",Qo,v(Z(x.value.file.size))+" Â· "+v(x.value.file.type||"unknown"),1)):c("",!0)]),l("div",Zo,[x.value.type==="file"?(n(),i("button",{key:0,class:"px-3 py-1.5 text-xs font-bold rounded-lg bg-white/10 text-white hover:bg-white/15",onClick:t[17]||(t[17]=async()=>{try{await xe(x.value)}catch(o){L.value=o.message||"ä¸‹è½½å¤±è´¥"}})}," ä¸‹è½½ ")):c("",!0),l("button",{class:"px-3 py-1.5 text-xs font-bold rounded-lg bg-red-500/20 text-red-100 hover:bg-red-500/30",onClick:t[18]||(t[18]=async()=>{await re(x.value.id)})}," åˆ é™¤ "),l("button",{class:"px-3 py-1.5 text-xs font-bold rounded-lg bg-blue-500 text-white hover:bg-blue-600",onClick:ie}," å…³é—­ ")])]),l("div",qo,[x.value.type==="file"?(n(),i("div",es,[String(x.value.file.type||"").startsWith("image/")&&f.value[x.value.id]?(n(),i("img",{key:0,src:f.value[x.value.id],class:"max-h-[70vh] w-full object-contain rounded-xl bg-white/5 border border-white/10",alt:x.value.file.name},null,8,ts)):(n(),i("div",os," è¯¥æ–‡ä»¶ç±»å‹æš‚ä¸æ”¯æŒç›´æ¥é¢„è§ˆï¼Œè¯·ä½¿ç”¨â€œä¸‹è½½â€ã€‚ "))])):c("",!0)])])])):c("",!0)]))],38))}}),as=Ut(is,[["__scopeId","data-v-d65f2e35"]]);export{as as default};
