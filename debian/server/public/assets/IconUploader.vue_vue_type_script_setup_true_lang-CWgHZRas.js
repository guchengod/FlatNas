import{d as me,a as C,e as y,b as Y,g as l,l as _,I as Me,q as V,p as N,t as T,u as Ye,r as H,c as se,w as je,y as De,J as Ve,F as pe,E as ue,f as de,j as Q,m as D,i as O,z as Fe,A as qe,h as Ie,T as We,K as Se,L as Je,k as He}from"./index-DXce9nG8.js";const Le={};Le.getData=e=>new Promise((s,o)=>{let i={};Qe(e).then(t=>{i.arrayBuffer=t;try{i.orientation=et(t)}catch{i.orientation=-1}s(i)}).catch(t=>{o(t)})});function Qe(e){let s=null;return new Promise((o,i)=>{if(e.src)if(/^data\:/i.test(e.src))s=Ze(e.src),o(s);else if(/^blob\:/i.test(e.src)){var t=new FileReader;t.onload=function(a){s=a.target.result,o(s)},Ge(e.src,function(a){t.readAsArrayBuffer(a)})}else{var r=new XMLHttpRequest;r.onload=function(){if(this.status==200||this.status===0)s=r.response,o(s);else throw"Could not load image";r=null},r.open("GET",e.src,!0),r.responseType="arraybuffer",r.send(null)}else i("img error")})}function Ge(e,s){var o=new XMLHttpRequest;o.open("GET",e,!0),o.responseType="blob",o.onload=function(i){(this.status==200||this.status===0)&&s(this.response)},o.send()}function Ze(e,s){s=s||e.match(/^data\:([^\;]+)\;base64,/mi)[1]||"",e=e.replace(/^data\:([^\;]+)\;base64,/gmi,"");for(var o=atob(e),i=o.length%2==0?o.length:o.length+1,t=new ArrayBuffer(i),r=new Uint16Array(t),a=0;a<i;a++)r[a]=o.charCodeAt(a);return t}function Ke(e,s,o){var i="",t;for(t=s,o+=s;t<o;t++)i+=String.fromCharCode(e.getUint8(t));return i}function et(e){var s=new DataView(e),o=s.byteLength,i,t,r,a,c,u,d,g,m,v;if(s.getUint8(0)===255&&s.getUint8(1)===216)for(m=2;m<o;){if(s.getUint8(m)===255&&s.getUint8(m+1)===225){d=m;break}m++}if(d&&(t=d+4,r=d+10,Ke(s,t,4)==="Exif"&&(u=s.getUint16(r),c=u===18761,(c||u===19789)&&s.getUint16(r+2,c)===42&&(a=s.getUint32(r+4,c),a>=8&&(g=r+a)))),g){for(o=s.getUint16(g,c),v=0;v<o;v++)if(m=g+v*12+2,s.getUint16(m,c)===274){m+=8,i=s.getUint16(m,c);break}}return i}const tt=(e,s)=>{const o=e.__vccOpts||e;for(const[i,t]of s)o[i]=t;return o},st=me({data:function(){return{w:0,h:0,scale:1,x:0,y:0,loading:!0,trueWidth:0,trueHeight:0,move:!0,moveX:0,moveY:0,crop:!1,cropping:!1,cropW:0,cropH:0,cropOldW:0,cropOldH:0,canChangeX:!1,canChangeY:!1,changeCropTypeX:1,changeCropTypeY:1,cropX:0,cropY:0,cropChangeX:0,cropChangeY:0,cropOffsertX:0,cropOffsertY:0,support:"",touches:[],touchNow:!1,rotate:0,isIos:!1,orientation:0,imgs:"",coe:.2,scaling:!1,scalingSet:"",coeStatus:"",isCanShow:!0,imgIsQqualCrop:!1}},props:{img:{type:[String,Blob,null,File],default:""},outputSize:{type:Number,default:1},outputType:{type:String,default:"jpeg"},info:{type:Boolean,default:!0},canScale:{type:Boolean,default:!0},autoCrop:{type:Boolean,default:!1},autoCropWidth:{type:[Number,String],default:0},autoCropHeight:{type:[Number,String],default:0},fixed:{type:Boolean,default:!1},fixedNumber:{type:Array,default:()=>[1,1]},fixedBox:{type:Boolean,default:!1},full:{type:Boolean,default:!1},canMove:{type:Boolean,default:!0},canMoveBox:{type:Boolean,default:!0},original:{type:Boolean,default:!1},centerBox:{type:Boolean,default:!1},high:{type:Boolean,default:!0},infoTrue:{type:Boolean,default:!1},maxImgSize:{type:[Number,String],default:2e3},enlarge:{type:[Number,String],default:1},preW:{type:[Number,String],default:0},mode:{type:String,default:"contain"},limitMinSize:{type:[Number,Array,String],default:()=>10,validator:function(e){return Array.isArray(e)?Number(e[0])>=0&&Number(e[1])>=0:Number(e)>=0}},fillColor:{type:String,default:""}},computed:{cropInfo(){let e={};if(e.top=this.cropOffsertY>21?"-21px":"0px",e.width=this.cropW>0?this.cropW:0,e.height=this.cropH>0?this.cropH:0,this.infoTrue){let s=1;this.high&&!this.full&&(s=window.devicePixelRatio),this.enlarge!==1&!this.full&&(s=Math.abs(Number(this.enlarge))),e.width=e.width*s,e.height=e.height*s,this.full&&(e.width=e.width/this.scale,e.height=e.height/this.scale)}return e.width=e.width.toFixed(0),e.height=e.height.toFixed(0),e},isIE(){return!!window.ActiveXObject||"ActiveXObject"in window},passive(){return this.isIE?null:{passive:!1}},isRotateRightOrLeft(){return[1,-1,3,-3].includes(this.rotate)}},watch:{img(){this.checkedImg()},imgs(e){e!==""&&this.reload()},cropW(){this.showPreview()},cropH(){this.showPreview()},cropOffsertX(){this.showPreview()},cropOffsertY(){this.showPreview()},scale(e,s){this.showPreview()},x(){this.showPreview()},y(){this.showPreview()},autoCrop(e){e&&this.goAutoCrop()},autoCropWidth(){this.autoCrop&&this.goAutoCrop()},autoCropHeight(){this.autoCrop&&this.goAutoCrop()},mode(){this.checkedImg()},rotate(){this.showPreview(),this.autoCrop?this.goAutoCrop(this.cropW,this.cropH):(this.cropW>0||this.cropH>0)&&this.goAutoCrop(this.cropW,this.cropH)}},methods:{getVersion(e){var s=navigator.userAgent.split(" "),o="";let i=0;const t=new RegExp(e,"i");for(var r=0;r<s.length;r++)t.test(s[r])&&(o=s[r]);return o?i=o.split("/")[1].split("."):i=["0","0","0"],i},checkOrientationImage(e,s,o,i){if(this.getVersion("chrome")[0]>=81)s=-1;else if(this.getVersion("safari")[0]>=605){const a=this.getVersion("version");a[0]>13&&a[1]>1&&(s=-1)}else{const a=navigator.userAgent.toLowerCase().match(/cpu iphone os (.*?) like mac os/);if(a){let c=a[1];c=c.split("_"),(c[0]>13||c[0]>=13&&c[1]>=4)&&(s=-1)}}let t=document.createElement("canvas"),r=t.getContext("2d");switch(r.save(),s){case 2:t.width=o,t.height=i,r.translate(o,0),r.scale(-1,1);break;case 3:t.width=o,t.height=i,r.translate(o/2,i/2),r.rotate(180*Math.PI/180),r.translate(-o/2,-i/2);break;case 4:t.width=o,t.height=i,r.translate(0,i),r.scale(1,-1);break;case 5:t.height=o,t.width=i,r.rotate(.5*Math.PI),r.scale(1,-1);break;case 6:t.width=i,t.height=o,r.translate(i/2,o/2),r.rotate(90*Math.PI/180),r.translate(-o/2,-i/2);break;case 7:t.height=o,t.width=i,r.rotate(.5*Math.PI),r.translate(o,-i),r.scale(-1,1);break;case 8:t.height=o,t.width=i,r.translate(i/2,o/2),r.rotate(-90*Math.PI/180),r.translate(-o/2,-i/2);break;default:t.width=o,t.height=i}r.drawImage(e,0,0,o,i),r.restore(),t.toBlob(a=>{let c=URL.createObjectURL(a);URL.revokeObjectURL(this.imgs),this.imgs=c},"image/"+this.outputType,1)},checkedImg(){if(this.img===null||this.img===""){this.imgs="",this.clearCrop();return}this.loading=!0,this.scale=1,this.rotate=0,this.imgIsQqualCrop=!1,this.clearCrop();let e=new Image;if(e.onload=()=>{if(this.img==="")return this.$emit("img-load",new Error("图片不能为空")),!1;let o=e.width,i=e.height;Le.getData(e).then(t=>{this.orientation=t.orientation||1;let r=Number(this.maxImgSize);if(!this.orientation&&o<r&i<r){this.imgs=this.img;return}o>r&&(i=i/o*r,o=r),i>r&&(o=o/i*r,i=r),this.checkOrientationImage(e,this.orientation,o,i)}).catch(t=>{this.$emit("img-load","error"),this.$emit("img-load-error",t)})},e.onerror=o=>{this.$emit("img-load","error"),this.$emit("img-load-error",o)},this.img.substr(0,4)!=="data"&&(e.crossOrigin=""),this.isIE){var s=new XMLHttpRequest;s.onload=function(){var o=URL.createObjectURL(this.response);e.src=o},s.open("GET",this.img,!0),s.responseType="blob",s.send()}else e.src=this.img},startMove(e){if(e.preventDefault(),this.move&&!this.crop){if(!this.canMove)return!1;this.moveX=("clientX"in e?e.clientX:e.touches[0].clientX)-this.x,this.moveY=("clientY"in e?e.clientY:e.touches[0].clientY)-this.y,e.touches?(window.addEventListener("touchmove",this.moveImg),window.addEventListener("touchend",this.leaveImg),e.touches.length==2&&(this.touches=e.touches,window.addEventListener("touchmove",this.touchScale),window.addEventListener("touchend",this.cancelTouchScale))):(window.addEventListener("mousemove",this.moveImg),window.addEventListener("mouseup",this.leaveImg)),this.$emit("img-moving",{moving:!0,axis:this.getImgAxis()})}else this.cropping=!0,window.addEventListener("mousemove",this.createCrop),window.addEventListener("mouseup",this.endCrop),window.addEventListener("touchmove",this.createCrop),window.addEventListener("touchend",this.endCrop),this.cropOffsertX=e.offsetX?e.offsetX:e.touches[0].pageX-this.$refs.cropper.offsetLeft,this.cropOffsertY=e.offsetY?e.offsetY:e.touches[0].pageY-this.$refs.cropper.offsetTop,this.cropX="clientX"in e?e.clientX:e.touches[0].clientX,this.cropY="clientY"in e?e.clientY:e.touches[0].clientY,this.cropChangeX=this.cropOffsertX,this.cropChangeY=this.cropOffsertY,this.cropW=0,this.cropH=0},touchScale(e){e.preventDefault();let s=this.scale;var o={x:this.touches[0].clientX,y:this.touches[0].clientY},i={x:e.touches[0].clientX,y:e.touches[0].clientY},t={x:this.touches[1].clientX,y:this.touches[1].clientY},r={x:e.touches[1].clientX,y:e.touches[1].clientY},a=Math.sqrt(Math.pow(o.x-t.x,2)+Math.pow(o.y-t.y,2)),c=Math.sqrt(Math.pow(i.x-r.x,2)+Math.pow(i.y-r.y,2)),u=c-a,d=1;d=d/this.trueWidth>d/this.trueHeight?d/this.trueHeight:d/this.trueWidth,d=d>.1?.1:d;var g=d*u;if(!this.touchNow){if(this.touchNow=!0,u>0?s+=Math.abs(g):u<0&&s>Math.abs(g)&&(s-=Math.abs(g)),this.touches=e.touches,setTimeout(()=>{this.touchNow=!1},8),!this.checkoutImgAxis(this.x,this.y,s))return!1;this.scale=s}},cancelTouchScale(e){window.removeEventListener("touchmove",this.touchScale)},moveImg(e){if(e.preventDefault(),e.touches&&e.touches.length===2)return this.touches=e.touches,window.addEventListener("touchmove",this.touchScale),window.addEventListener("touchend",this.cancelTouchScale),window.removeEventListener("touchmove",this.moveImg),!1;let s="clientX"in e?e.clientX:e.touches[0].clientX,o="clientY"in e?e.clientY:e.touches[0].clientY,i,t;i=s-this.moveX,t=o-this.moveY,this.$nextTick(()=>{if(this.centerBox){let r=this.getImgAxis(i,t,this.scale),a=this.getCropAxis(),c=this.trueHeight*this.scale,u=this.trueWidth*this.scale,d,g,m,v;switch(this.rotate){case 1:case-1:case 3:case-3:d=this.cropOffsertX-this.trueWidth*(1-this.scale)/2+(c-u)/2,g=this.cropOffsertY-this.trueHeight*(1-this.scale)/2+(u-c)/2,m=d-c+this.cropW,v=g-u+this.cropH;break;default:d=this.cropOffsertX-this.trueWidth*(1-this.scale)/2,g=this.cropOffsertY-this.trueHeight*(1-this.scale)/2,m=d-u+this.cropW,v=g-c+this.cropH;break}r.x1>=a.x1&&(i=d),r.y1>=a.y1&&(t=g),r.x2<=a.x2&&(i=m),r.y2<=a.y2&&(t=v)}this.x=i,this.y=t,this.$emit("img-moving",{moving:!0,axis:this.getImgAxis()})})},leaveImg(e){window.removeEventListener("mousemove",this.moveImg),window.removeEventListener("touchmove",this.moveImg),window.removeEventListener("mouseup",this.leaveImg),window.removeEventListener("touchend",this.leaveImg),this.$emit("img-moving",{moving:!1,axis:this.getImgAxis()})},scaleImg(){this.canScale&&window.addEventListener(this.support,this.changeSize,this.passive)},cancelScale(){this.canScale&&window.removeEventListener(this.support,this.changeSize)},changeSize(e){e.preventDefault();let s=this.scale;var o=e.deltaY||e.wheelDelta,i=navigator.userAgent.indexOf("Firefox");o=i>0?o*30:o,this.isIE&&(o=-o);var t=this.coe;t=t/this.trueWidth>t/this.trueHeight?t/this.trueHeight:t/this.trueWidth;var r=t*o;r<0?s+=Math.abs(r):s>Math.abs(r)&&(s-=Math.abs(r));let a=r<0?"add":"reduce";if(a!==this.coeStatus&&(this.coeStatus=a,this.coe=.2),this.scaling||(this.scalingSet=setTimeout(()=>{this.scaling=!1,this.coe=this.coe+=.01},50)),this.scaling=!0,!this.checkoutImgAxis(this.x,this.y,s))return!1;this.scale=s},changeScale(e){let s=this.scale;e=e||1;var o=20;if(o=o/this.trueWidth>o/this.trueHeight?o/this.trueHeight:o/this.trueWidth,e=e*o,e>0?s+=Math.abs(e):s>Math.abs(e)&&(s-=Math.abs(e)),!this.checkoutImgAxis(this.x,this.y,s))return!1;this.scale=s},createCrop(e){e.preventDefault();var s="clientX"in e?e.clientX:e.touches?e.touches[0].clientX:0,o="clientY"in e?e.clientY:e.touches?e.touches[0].clientY:0;this.$nextTick(()=>{var i=s-this.cropX,t=o-this.cropY;if(i>0?(this.cropW=i+this.cropChangeX>this.w?this.w-this.cropChangeX:i,this.cropOffsertX=this.cropChangeX):(this.cropW=this.w-this.cropChangeX+Math.abs(i)>this.w?this.cropChangeX:Math.abs(i),this.cropOffsertX=this.cropChangeX+i>0?this.cropChangeX+i:0),!this.fixed)t>0?(this.cropH=t+this.cropChangeY>this.h?this.h-this.cropChangeY:t,this.cropOffsertY=this.cropChangeY):(this.cropH=this.h-this.cropChangeY+Math.abs(t)>this.h?this.cropChangeY:Math.abs(t),this.cropOffsertY=this.cropChangeY+t>0?this.cropChangeY+t:0);else{var r=this.cropW/this.fixedNumber[0]*this.fixedNumber[1];r+this.cropOffsertY>this.h?(this.cropH=this.h-this.cropOffsertY,this.cropW=this.cropH/this.fixedNumber[1]*this.fixedNumber[0],i>0?this.cropOffsertX=this.cropChangeX:this.cropOffsertX=this.cropChangeX-this.cropW):this.cropH=r,this.cropOffsertY=this.cropOffsertY}})},changeCropSize(e,s,o,i,t){e.preventDefault(),window.addEventListener("mousemove",this.changeCropNow),window.addEventListener("mouseup",this.changeCropEnd),window.addEventListener("touchmove",this.changeCropNow),window.addEventListener("touchend",this.changeCropEnd),this.canChangeX=s,this.canChangeY=o,this.changeCropTypeX=i,this.changeCropTypeY=t,this.cropX="clientX"in e?e.clientX:e.touches[0].clientX,this.cropY="clientY"in e?e.clientY:e.touches[0].clientY,this.cropOldW=this.cropW,this.cropOldH=this.cropH,this.cropChangeX=this.cropOffsertX,this.cropChangeY=this.cropOffsertY,this.fixed&&this.canChangeX&&this.canChangeY&&(this.canChangeY=0),this.$emit("change-crop-size",{width:this.cropW,height:this.cropH})},changeCropNow(e){e.preventDefault();var s="clientX"in e?e.clientX:e.touches?e.touches[0].clientX:0,o="clientY"in e?e.clientY:e.touches?e.touches[0].clientY:0;let i=this.w,t=this.h,r=0,a=0;if(this.centerBox){let d=this.getImgAxis(),g=d.x2,m=d.y2;r=d.x1>0?d.x1:0,a=d.y1>0?d.y1:0,i>g&&(i=g),t>m&&(t=m)}const[c,u]=this.checkCropLimitSize();this.$nextTick(()=>{var d=s-this.cropX,g=o-this.cropY;if(this.canChangeX&&(this.changeCropTypeX===1?this.cropOldW-d<c?(this.cropW=c,this.cropOffsertX=this.cropOldW+this.cropChangeX-r-c):this.cropOldW-d>0?(this.cropW=i-this.cropChangeX-d<=i-r?this.cropOldW-d:this.cropOldW+this.cropChangeX-r,this.cropOffsertX=i-this.cropChangeX-d<=i-r?this.cropChangeX+d:r):(this.cropW=Math.abs(d)+this.cropChangeX<=i?Math.abs(d)-this.cropOldW:i-this.cropOldW-this.cropChangeX,this.cropOffsertX=this.cropChangeX+this.cropOldW):this.changeCropTypeX===2&&(this.cropOldW+d<c?this.cropW=c:this.cropOldW+d>0?(this.cropW=this.cropOldW+d+this.cropOffsertX<=i?this.cropOldW+d:i-this.cropOffsertX,this.cropOffsertX=this.cropChangeX):(this.cropW=i-this.cropChangeX+Math.abs(d+this.cropOldW)<=i-r?Math.abs(d+this.cropOldW):this.cropChangeX-r,this.cropOffsertX=i-this.cropChangeX+Math.abs(d+this.cropOldW)<=i-r?this.cropChangeX-Math.abs(d+this.cropOldW):r))),this.canChangeY&&(this.changeCropTypeY===1?this.cropOldH-g<u?(this.cropH=u,this.cropOffsertY=this.cropOldH+this.cropChangeY-a-u):this.cropOldH-g>0?(this.cropH=t-this.cropChangeY-g<=t-a?this.cropOldH-g:this.cropOldH+this.cropChangeY-a,this.cropOffsertY=t-this.cropChangeY-g<=t-a?this.cropChangeY+g:a):(this.cropH=Math.abs(g)+this.cropChangeY<=t?Math.abs(g)-this.cropOldH:t-this.cropOldH-this.cropChangeY,this.cropOffsertY=this.cropChangeY+this.cropOldH):this.changeCropTypeY===2&&(this.cropOldH+g<u?this.cropH=u:this.cropOldH+g>0?(this.cropH=this.cropOldH+g+this.cropOffsertY<=t?this.cropOldH+g:t-this.cropOffsertY,this.cropOffsertY=this.cropChangeY):(this.cropH=t-this.cropChangeY+Math.abs(g+this.cropOldH)<=t-a?Math.abs(g+this.cropOldH):this.cropChangeY-a,this.cropOffsertY=t-this.cropChangeY+Math.abs(g+this.cropOldH)<=t-a?this.cropChangeY-Math.abs(g+this.cropOldH):a))),this.canChangeX&&this.fixed){var m=this.cropW/this.fixedNumber[0]*this.fixedNumber[1];m<u?(this.cropH=u,this.cropW=this.fixedNumber[0]*u/this.fixedNumber[1],this.changeCropTypeX===1&&(this.cropOffsertX=this.cropChangeX+(this.cropOldW-this.cropW))):m+this.cropOffsertY>t?(this.cropH=t-this.cropOffsertY,this.cropW=this.cropH/this.fixedNumber[1]*this.fixedNumber[0],this.changeCropTypeX===1&&(this.cropOffsertX=this.cropChangeX+(this.cropOldW-this.cropW))):this.cropH=m}if(this.canChangeY&&this.fixed){var v=this.cropH/this.fixedNumber[1]*this.fixedNumber[0];v<c?(this.cropW=c,this.cropH=this.fixedNumber[1]*c/this.fixedNumber[0],this.cropOffsertY=this.cropOldH+this.cropChangeY-this.cropH):v+this.cropOffsertX>i?(this.cropW=i-this.cropOffsertX,this.cropH=this.cropW/this.fixedNumber[0]*this.fixedNumber[1]):this.cropW=v}})},checkCropLimitSize(){let{cropW:e,cropH:s,limitMinSize:o}=this,i=new Array;return Array.isArray(o)?i=o:i=[o,o],e=parseFloat(i[0]),s=parseFloat(i[1]),[e,s]},changeCropEnd(e){window.removeEventListener("mousemove",this.changeCropNow),window.removeEventListener("mouseup",this.changeCropEnd),window.removeEventListener("touchmove",this.changeCropNow),window.removeEventListener("touchend",this.changeCropEnd)},calculateSize(e,s,o,i,t,r){const a=e/s;let c=t,u=r;return c<o&&(c=o,u=Math.ceil(c/a)),u<i&&(u=i,c=Math.ceil(u*a),c<o&&(c=o,u=Math.ceil(c/a))),c<t&&(c=t,u=Math.ceil(c/a)),u<r&&(u=r,c=Math.ceil(u*a)),{width:c,height:u}},endCrop(){this.cropW===0&&this.cropH===0&&(this.cropping=!1);let[e,s]=this.checkCropLimitSize();const{width:o,height:i}=this.fixed?this.calculateSize(this.fixedNumber[0],this.fixedNumber[1],e,s,this.cropW,this.cropH):{width:e,height:s};o>this.cropW&&(this.cropW=o,this.cropOffsertX+o>this.w&&(this.cropOffsertX=this.w-o)),i>this.cropH&&(this.cropH=i,this.cropOffsertY+i>this.h&&(this.cropOffsertY=this.h-i)),window.removeEventListener("mousemove",this.createCrop),window.removeEventListener("mouseup",this.endCrop),window.removeEventListener("touchmove",this.createCrop),window.removeEventListener("touchend",this.endCrop)},startCrop(){this.crop=!0},stopCrop(){this.crop=!1},clearCrop(){this.cropping=!1,this.cropW=0,this.cropH=0},cropMove(e){if(e.preventDefault(),!this.canMoveBox)return this.crop=!1,this.startMove(e),!1;if(e.touches&&e.touches.length===2)return this.crop=!1,this.startMove(e),this.leaveCrop(),!1;window.addEventListener("mousemove",this.moveCrop),window.addEventListener("mouseup",this.leaveCrop),window.addEventListener("touchmove",this.moveCrop),window.addEventListener("touchend",this.leaveCrop);let s="clientX"in e?e.clientX:e.touches[0].clientX,o="clientY"in e?e.clientY:e.touches[0].clientY,i,t;i=s-this.cropOffsertX,t=o-this.cropOffsertY,this.cropX=i,this.cropY=t,this.$emit("crop-moving",{moving:!0,axis:this.getCropAxis()})},moveCrop(e,s){let o=0,i=0;e&&(e.preventDefault(),o="clientX"in e?e.clientX:e.touches[0].clientX,i="clientY"in e?e.clientY:e.touches[0].clientY),this.$nextTick(()=>{let t,r,a=o-this.cropX,c=i-this.cropY;if(s&&(a=this.cropOffsertX,c=this.cropOffsertY),a<=0?t=0:a+this.cropW>this.w?t=this.w-this.cropW:t=a,c<=0?r=0:c+this.cropH>this.h?r=this.h-this.cropH:r=c,this.centerBox){let u=this.getImgAxis();t<=u.x1&&(t=u.x1),t+this.cropW>u.x2&&(t=u.x2-this.cropW),r<=u.y1&&(r=u.y1),r+this.cropH>u.y2&&(r=u.y2-this.cropH)}this.cropOffsertX=t,this.cropOffsertY=r,this.$emit("crop-moving",{moving:!0,axis:this.getCropAxis()})})},getImgAxis(e,s,o){e=e||this.x,s=s||this.y,o=o||this.scale;let i={x1:0,x2:0,y1:0,y2:0},t=this.trueWidth*o,r=this.trueHeight*o;switch(this.rotate){case 0:i.x1=e+this.trueWidth*(1-o)/2,i.x2=i.x1+this.trueWidth*o,i.y1=s+this.trueHeight*(1-o)/2,i.y2=i.y1+this.trueHeight*o;break;case 1:case-1:case 3:case-3:i.x1=e+this.trueWidth*(1-o)/2+(t-r)/2,i.x2=i.x1+this.trueHeight*o,i.y1=s+this.trueHeight*(1-o)/2+(r-t)/2,i.y2=i.y1+this.trueWidth*o;break;default:i.x1=e+this.trueWidth*(1-o)/2,i.x2=i.x1+this.trueWidth*o,i.y1=s+this.trueHeight*(1-o)/2,i.y2=i.y1+this.trueHeight*o;break}return i},getCropAxis(){let e={x1:0,x2:0,y1:0,y2:0};return e.x1=this.cropOffsertX,e.x2=e.x1+this.cropW,e.y1=this.cropOffsertY,e.y2=e.y1+this.cropH,e},leaveCrop(e){window.removeEventListener("mousemove",this.moveCrop),window.removeEventListener("mouseup",this.leaveCrop),window.removeEventListener("touchmove",this.moveCrop),window.removeEventListener("touchend",this.leaveCrop),this.$emit("crop-moving",{moving:!1,axis:this.getCropAxis()})},getCropChecked(e){let s=document.createElement("canvas"),o=s.getContext("2d"),i=new Image,t=this.rotate,r=this.trueWidth,a=this.trueHeight,c=this.cropOffsertX,u=this.cropOffsertY;i.onload=()=>{if(this.cropW!==0){let v=1;this.high&!this.full&&(v=window.devicePixelRatio),this.enlarge!==1&!this.full&&(v=Math.abs(Number(this.enlarge)));let W=this.cropW*v,z=this.cropH*v,S=r*this.scale*v,w=a*this.scale*v,f=(this.x-c+this.trueWidth*(1-this.scale)/2)*v,b=(this.y-u+this.trueHeight*(1-this.scale)/2)*v;switch(m(W,z),o.save(),t){case 0:this.full?(m(W/this.scale,z/this.scale),o.drawImage(i,f/this.scale,b/this.scale,S/this.scale,w/this.scale)):o.drawImage(i,f,b,S,w);break;case 1:case-3:this.full?(m(W/this.scale,z/this.scale),f=f/this.scale+(S/this.scale-w/this.scale)/2,b=b/this.scale+(w/this.scale-S/this.scale)/2,o.rotate(t*90*Math.PI/180),o.drawImage(i,b,-f-w/this.scale,S/this.scale,w/this.scale)):(f=f+(S-w)/2,b=b+(w-S)/2,o.rotate(t*90*Math.PI/180),o.drawImage(i,b,-f-w,S,w));break;case 2:case-2:this.full?(m(W/this.scale,z/this.scale),o.rotate(t*90*Math.PI/180),f=f/this.scale,b=b/this.scale,o.drawImage(i,-f-S/this.scale,-b-w/this.scale,S/this.scale,w/this.scale)):(o.rotate(t*90*Math.PI/180),o.drawImage(i,-f-S,-b-w,S,w));break;case 3:case-1:this.full?(m(W/this.scale,z/this.scale),f=f/this.scale+(S/this.scale-w/this.scale)/2,b=b/this.scale+(w/this.scale-S/this.scale)/2,o.rotate(t*90*Math.PI/180),o.drawImage(i,-b-S/this.scale,f,S/this.scale,w/this.scale)):(f=f+(S-w)/2,b=b+(w-S)/2,o.rotate(t*90*Math.PI/180),o.drawImage(i,-b-S,f,S,w));break;default:this.full?(m(W/this.scale,z/this.scale),o.drawImage(i,f/this.scale,b/this.scale,S/this.scale,w/this.scale)):o.drawImage(i,f,b,S,w)}o.restore()}else{let v=r*this.scale,W=a*this.scale;switch(o.save(),t){case 0:m(v,W),o.drawImage(i,0,0,v,W);break;case 1:case-3:m(W,v),o.rotate(t*90*Math.PI/180),o.drawImage(i,0,-W,v,W);break;case 2:case-2:m(v,W),o.rotate(t*90*Math.PI/180),o.drawImage(i,-v,-W,v,W);break;case 3:case-1:m(W,v),o.rotate(t*90*Math.PI/180),o.drawImage(i,-v,0,v,W);break;default:m(v,W),o.drawImage(i,0,0,v,W)}o.restore()}e(s)};var d=this.img.substr(0,4);d!=="data"&&(i.crossOrigin="Anonymous"),i.src=this.imgs;const g=this.fillColor;function m(v,W){s.width=Math.round(v),s.height=Math.round(W),g&&(o.fillStyle=g,o.fillRect(0,0,s.width,s.height))}},getCropData(e){this.getCropChecked(s=>{e(s.toDataURL("image/"+this.outputType,this.outputSize))})},getCropBlob(e){this.getCropChecked(s=>{s.toBlob(o=>e(o),"image/"+this.outputType,this.outputSize)})},showPreview(){if(this.isCanShow)this.isCanShow=!1,setTimeout(()=>{this.isCanShow=!0},16);else return!1;let e=this.cropW,s=this.cropH,o=this.scale;var i={};i.div={width:`${e}px`,height:`${s}px`};let t=(this.x-this.cropOffsertX)/o,r=(this.y-this.cropOffsertY)/o,a=0;i.w=e,i.h=s,i.url=this.imgs,i.img={width:`${this.trueWidth}px`,height:`${this.trueHeight}px`,transform:`scale(${o})translate3d(${t}px, ${r}px, ${a}px)rotateZ(${this.rotate*90}deg)`},i.html=`
      <div class="show-preview" style="width: ${i.w}px; height: ${i.h}px,; overflow: hidden">
        <div style="width: ${e}px; height: ${s}px">
          <img src=${i.url} style="width: ${this.trueWidth}px; height: ${this.trueHeight}px; transform:
          scale(${o})translate3d(${t}px, ${r}px, ${a}px)rotateZ(${this.rotate*90}deg)">
        </div>
      </div>`,this.$emit("real-time",i)},reload(){let e=new Image;e.onload=()=>{this.w=parseFloat(window.getComputedStyle(this.$refs.cropper).width),this.h=parseFloat(window.getComputedStyle(this.$refs.cropper).height),this.trueWidth=e.width,this.trueHeight=e.height,this.original?this.scale=1:this.scale=this.checkedMode(),this.$nextTick(()=>{this.x=-(this.trueWidth-this.trueWidth*this.scale)/2+(this.w-this.trueWidth*this.scale)/2,this.y=-(this.trueHeight-this.trueHeight*this.scale)/2+(this.h-this.trueHeight*this.scale)/2,this.loading=!1,this.autoCrop&&this.goAutoCrop(),this.$emit("img-load","success"),setTimeout(()=>{this.showPreview()},20)})},e.onerror=()=>{this.$emit("img-load","error")},e.src=this.imgs},checkedMode(){let e=1,s=this.trueWidth,o=this.trueHeight;const i=this.mode.split(" ");switch(i[0]){case"contain":this.trueWidth>this.w&&(e=this.w/this.trueWidth),this.trueHeight*e>this.h&&(e=this.h/this.trueHeight);break;case"cover":s=this.w,e=s/this.trueWidth,o=o*e,o<this.h&&(o=this.h,e=o/this.trueHeight);break;default:try{let t=i[0];if(t.search("px")!==-1){t=t.replace("px",""),s=parseFloat(t);const r=s/this.trueWidth;let a=1,c=i[1];c.search("px")!==-1&&(c=c.replace("px",""),o=parseFloat(c),a=o/this.trueHeight),e=Math.min(r,a)}if(t.search("%")!==-1&&(t=t.replace("%",""),s=parseFloat(t)/100*this.w,e=s/this.trueWidth),i.length===2&&t==="auto"){let r=i[1];r.search("px")!==-1&&(r=r.replace("px",""),o=parseFloat(r),e=o/this.trueHeight),r.search("%")!==-1&&(r=r.replace("%",""),o=parseFloat(r)/100*this.h,e=o/this.trueHeight)}}catch{e=1}}return e},goAutoCrop(e,s){if(this.imgs===""||this.imgs===null)return;this.clearCrop(),this.cropping=!0;let o=this.w,i=this.h;if(this.centerBox){const a=Math.abs(this.rotate)%2>0;let c=(a?this.trueHeight:this.trueWidth)*this.scale,u=(a?this.trueWidth:this.trueHeight)*this.scale;o=c<o?c:o,i=u<i?u:i}var t=e||parseFloat(this.autoCropWidth),r=s||parseFloat(this.autoCropHeight);(t===0||r===0)&&(t=o*.8,r=i*.8),t=t>o?o:t,r=r>i?i:r,this.fixed&&(r=t/this.fixedNumber[0]*this.fixedNumber[1]),r>this.h&&(r=this.h,t=r/this.fixedNumber[1]*this.fixedNumber[0]),this.changeCrop(t,r)},changeCrop(e,s){if(this.centerBox){let o=this.getImgAxis();e>o.x2-o.x1&&(e=o.x2-o.x1,s=e/this.fixedNumber[0]*this.fixedNumber[1]),s>o.y2-o.y1&&(s=o.y2-o.y1,e=s/this.fixedNumber[1]*this.fixedNumber[0])}this.cropW=e,this.cropH=s,this.checkCropLimitSize(),this.$nextTick(()=>{this.cropOffsertX=(this.w-this.cropW)/2,this.cropOffsertY=(this.h-this.cropH)/2,this.centerBox&&this.moveCrop(null,!0)})},refresh(){this.img,this.imgs="",this.scale=1,this.crop=!1,this.rotate=0,this.w=0,this.h=0,this.trueWidth=0,this.trueHeight=0,this.imgIsQqualCrop=!1,this.clearCrop(),this.$nextTick(()=>{this.checkedImg()})},rotateLeft(){this.rotate=this.rotate<=-3?0:this.rotate-1},rotateRight(){this.rotate=this.rotate>=3?0:this.rotate+1},rotateClear(){this.rotate=0},checkoutImgAxis(e,s,o){e=e||this.x,s=s||this.y,o=o||this.scale;let i=!0;if(this.centerBox){let t=this.getImgAxis(e,s,o),r=this.getCropAxis();t.x1>=r.x1&&(i=!1),t.x2<=r.x2&&(i=!1),t.y1>=r.y1&&(i=!1),t.y2<=r.y2&&(i=!1),i||this.changeImgScale(t,r,o)}return i},changeImgScale(e,s,o){let i=this.trueWidth,t=this.trueHeight,r=i*o,a=t*o;if(r>=this.cropW&&a>=this.cropH)this.scale=o;else{const c=this.cropW/i,u=this.cropH/t,d=this.cropH<=t*c?c:u;this.scale=d,r=i*d,a=t*d}this.imgIsQqualCrop||(e.x1>=s.x1&&(this.isRotateRightOrLeft?this.x=s.x1-(i-r)/2-(r-a)/2:this.x=s.x1-(i-r)/2),e.x2<=s.x2&&(this.isRotateRightOrLeft?this.x=s.x1-(i-r)/2-(r-a)/2-a+this.cropW:this.x=s.x2-(i-r)/2-r),e.y1>=s.y1&&(this.isRotateRightOrLeft?this.y=s.y1-(t-a)/2-(a-r)/2:this.y=s.y1-(t-a)/2),e.y2<=s.y2&&(this.isRotateRightOrLeft?this.y=s.y2-(t-a)/2-(a-r)/2-r:this.y=s.y2-(t-a)/2-a)),(r<this.cropW||a<this.cropH)&&(this.imgIsQqualCrop=!0)}},mounted(){this.support="onwheel"in document.createElement("div")?"wheel":document.onmousewheel!==void 0?"mousewheel":"DOMMouseScroll";let e=this;var s=navigator.userAgent;this.isIOS=!!s.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(o,i,t){for(var r=atob(this.toDataURL(i,t).split(",")[1]),a=r.length,c=new Uint8Array(a),u=0;u<a;u++)c[u]=r.charCodeAt(u);o(new Blob([c],{type:e.type||"image/png"}))}}),this.showPreview(),this.checkedImg()},unmounted(){window.removeEventListener("mousemove",this.moveCrop),window.removeEventListener("mouseup",this.leaveCrop),window.removeEventListener("touchmove",this.moveCrop),window.removeEventListener("touchend",this.leaveCrop),this.cancelScale()}}),ot={key:0,class:"cropper-box"},it=["src"],rt={class:"cropper-view-box"},at=["src"],nt={key:1};function lt(e,s,o,i,t,r){return y(),C("div",{class:"vue-cropper",ref:"cropper",onMouseover:s[28]||(s[28]=(...a)=>e.scaleImg&&e.scaleImg(...a)),onMouseout:s[29]||(s[29]=(...a)=>e.cancelScale&&e.cancelScale(...a))},[e.imgs?(y(),C("div",ot,[_(l("div",{class:"cropper-box-canvas",style:V({width:e.trueWidth+"px",height:e.trueHeight+"px",transform:"scale("+e.scale+","+e.scale+") translate3d("+e.x/e.scale+"px,"+e.y/e.scale+"px,0)rotateZ("+e.rotate*90+"deg)"})},[l("img",{src:e.imgs,alt:"cropper-img",ref:"cropperImg"},null,8,it)],4),[[Me,!e.loading]])])):Y("",!0),l("div",{class:N(["cropper-drag-box",{"cropper-move":e.move&&!e.crop,"cropper-crop":e.crop,"cropper-modal":e.cropping}]),onMousedown:s[0]||(s[0]=(...a)=>e.startMove&&e.startMove(...a)),onTouchstart:s[1]||(s[1]=(...a)=>e.startMove&&e.startMove(...a))},null,34),_(l("div",{class:"cropper-crop-box",style:V({width:e.cropW+"px",height:e.cropH+"px",transform:"translate3d("+e.cropOffsertX+"px,"+e.cropOffsertY+"px,0)"})},[l("span",rt,[l("img",{style:V({width:e.trueWidth+"px",height:e.trueHeight+"px",transform:"scale("+e.scale+","+e.scale+") translate3d("+(e.x-e.cropOffsertX)/e.scale+"px,"+(e.y-e.cropOffsertY)/e.scale+"px,0)rotateZ("+e.rotate*90+"deg)"}),src:e.imgs,alt:"cropper-img"},null,12,at)]),l("span",{class:"cropper-face cropper-move",onMousedown:s[2]||(s[2]=(...a)=>e.cropMove&&e.cropMove(...a)),onTouchstart:s[3]||(s[3]=(...a)=>e.cropMove&&e.cropMove(...a))},null,32),e.info?(y(),C("span",{key:0,class:"crop-info",style:V({top:e.cropInfo.top})},T(e.cropInfo.width)+" × "+T(e.cropInfo.height),5)):Y("",!0),e.fixedBox?Y("",!0):(y(),C("span",nt,[l("span",{class:"crop-line line-w",onMousedown:s[4]||(s[4]=a=>e.changeCropSize(a,!1,!0,0,1)),onTouchstart:s[5]||(s[5]=a=>e.changeCropSize(a,!1,!0,0,1))},null,32),l("span",{class:"crop-line line-a",onMousedown:s[6]||(s[6]=a=>e.changeCropSize(a,!0,!1,1,0)),onTouchstart:s[7]||(s[7]=a=>e.changeCropSize(a,!0,!1,1,0))},null,32),l("span",{class:"crop-line line-s",onMousedown:s[8]||(s[8]=a=>e.changeCropSize(a,!1,!0,0,2)),onTouchstart:s[9]||(s[9]=a=>e.changeCropSize(a,!1,!0,0,2))},null,32),l("span",{class:"crop-line line-d",onMousedown:s[10]||(s[10]=a=>e.changeCropSize(a,!0,!1,2,0)),onTouchstart:s[11]||(s[11]=a=>e.changeCropSize(a,!0,!1,2,0))},null,32),l("span",{class:"crop-point point1",onMousedown:s[12]||(s[12]=a=>e.changeCropSize(a,!0,!0,1,1)),onTouchstart:s[13]||(s[13]=a=>e.changeCropSize(a,!0,!0,1,1))},null,32),l("span",{class:"crop-point point2",onMousedown:s[14]||(s[14]=a=>e.changeCropSize(a,!1,!0,0,1)),onTouchstart:s[15]||(s[15]=a=>e.changeCropSize(a,!1,!0,0,1))},null,32),l("span",{class:"crop-point point3",onMousedown:s[16]||(s[16]=a=>e.changeCropSize(a,!0,!0,2,1)),onTouchstart:s[17]||(s[17]=a=>e.changeCropSize(a,!0,!0,2,1))},null,32),l("span",{class:"crop-point point4",onMousedown:s[18]||(s[18]=a=>e.changeCropSize(a,!0,!1,1,0)),onTouchstart:s[19]||(s[19]=a=>e.changeCropSize(a,!0,!1,1,0))},null,32),l("span",{class:"crop-point point5",onMousedown:s[20]||(s[20]=a=>e.changeCropSize(a,!0,!1,2,0)),onTouchstart:s[21]||(s[21]=a=>e.changeCropSize(a,!0,!1,2,0))},null,32),l("span",{class:"crop-point point6",onMousedown:s[22]||(s[22]=a=>e.changeCropSize(a,!0,!0,1,2)),onTouchstart:s[23]||(s[23]=a=>e.changeCropSize(a,!0,!0,1,2))},null,32),l("span",{class:"crop-point point7",onMousedown:s[24]||(s[24]=a=>e.changeCropSize(a,!1,!0,0,2)),onTouchstart:s[25]||(s[25]=a=>e.changeCropSize(a,!1,!0,0,2))},null,32),l("span",{class:"crop-point point8",onMousedown:s[26]||(s[26]=a=>e.changeCropSize(a,!0,!0,2,2)),onTouchstart:s[27]||(s[27]=a=>e.changeCropSize(a,!0,!0,2,2))},null,32)]))],4),[[Me,e.cropping]])],544)}const ct=tt(st,[["render",lt],["__scopeId","data-v-a742df44"]]),ht="FlatNasImageCache",F="images",pt=1,Be=1440*60*1e3,Xe=40,ne=()=>new Promise((e,s)=>{const o=indexedDB.open(ht,pt);o.onerror=()=>s(o.error),o.onsuccess=()=>e(o.result),o.onupgradeneeded=i=>{const t=i.target.result;t.objectStoreNames.contains(F)||t.createObjectStore(F,{keyPath:"url"})}}),ut=async()=>{const o=(await ne()).transaction(F,"readwrite").objectStore(F),i=[];await new Promise((c,u)=>{const d=o.openCursor();d.onsuccess=()=>{const g=d.result;if(!g){c();return}const m=g.value;i.push({url:m.url,timestamp:typeof m.timestamp=="number"?m.timestamp:0}),g.continue()},d.onerror=()=>u(d.error)});const t=Date.now(),r=new Set;for(const c of i)t-c.timestamp>Be&&r.add(c.url);const a=i.filter(c=>!r.has(c.url));if(a.length>Xe){a.sort((c,u)=>u.timestamp-c.timestamp);for(const c of a.slice(Xe))r.add(c.url)}for(const c of r)o.delete(c),localStorage.removeItem(`cache_meta_${c}`)},dt=async(e,s,o)=>{const r=(await ne()).transaction(F,"readwrite").objectStore(F);await new Promise((a,c)=>{const u=r.put({url:e,blob:s,timestamp:Date.now(),etag:o});u.onsuccess=()=>a(),u.onerror=()=>c(u.error)}),localStorage.setItem(`cache_meta_${e}`,JSON.stringify({timestamp:Date.now(),etag:o})),await ut()},gt=async e=>{const s=localStorage.getItem(`cache_meta_${e}`);if(s){const r=JSON.parse(s);if(Date.now()-r.timestamp>Be){localStorage.removeItem(`cache_meta_${e}`);try{(await ne()).transaction(F,"readwrite").objectStore(F).delete(e)}catch{return null}return null}}else return null;const t=(await ne()).transaction(F,"readonly").objectStore(F);return new Promise((r,a)=>{const c=t.get(e);c.onsuccess=()=>{const u=c.result;r(u?u.blob:null)},c.onerror=()=>a(c.error)})},E=[];for(let e=0;e<256;++e)E.push((e+256).toString(16).slice(1));function ft(e,s=0){return(E[e[s+0]]+E[e[s+1]]+E[e[s+2]]+E[e[s+3]]+"-"+E[e[s+4]]+E[e[s+5]]+"-"+E[e[s+6]]+E[e[s+7]]+"-"+E[e[s+8]]+E[e[s+9]]+"-"+E[e[s+10]]+E[e[s+11]]+E[e[s+12]]+E[e[s+13]]+E[e[s+14]]+E[e[s+15]]).toLowerCase()}let ge;const mt=new Uint8Array(16);function vt(){if(!ge){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");ge=crypto.getRandomValues.bind(crypto)}return ge(mt)}const bt=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),$e={randomUUID:bt};function xt(e,s,o){e=e||{};const i=e.random??e.rng?.()??vt();if(i.length<16)throw new Error("Random bytes length must be >= 16");return i[6]=i[6]&15|64,i[8]=i[8]&63|128,ft(i)}function wt(e,s,o){return $e.randomUUID&&!e?$e.randomUUID():xt(e)}const yt={class:"bg-white md:rounded-2xl shadow-2xl w-full md:max-w-5xl h-full md:h-[85vh] flex flex-col overflow-hidden animate-in fade-in zoom-in duration-200"},Ct={class:"px-4 pb-3 pt-[calc(0.75rem+env(safe-area-inset-top))] md:px-6 md:py-4 border-b border-gray-100 flex justify-between items-center bg-white"},kt={class:"flex items-center gap-4"},Ot={class:"text-lg font-bold text-gray-800"},Mt={class:"flex items-center bg-gray-100 rounded-lg p-1"},It={class:"px-1.5 py-0.5 rounded-full bg-gray-200 text-gray-600 text-[10px]"},Wt={class:"px-1.5 py-0.5 rounded-full bg-gray-200 text-gray-600 text-[10px]"},St={class:"px-4 py-3 md:px-6 bg-white border-b border-gray-100 flex flex-col md:flex-row justify-between items-start md:items-center gap-3 md:gap-0"},Ht={class:"flex flex-wrap gap-2 md:gap-3 items-center w-full md:w-auto"},Xt={class:"flex items-center gap-2 mr-2 bg-gray-50 p-1 rounded-lg border border-gray-100"},$t=["title"],Yt={class:"flex items-center gap-1 px-1"},Lt={key:1,class:"text-[10px] text-gray-400"},Bt={key:1,class:"flex items-center gap-2 mr-2 bg-gray-50 p-1 rounded-lg border border-gray-100"},Ut={class:"flex items-center gap-1 px-1"},Et={class:"flex items-center gap-1 px-1"},At={key:2,class:"flex items-center gap-2 mr-2 bg-gray-50 p-1 rounded-lg border border-gray-100"},Tt={class:"flex items-center gap-1 px-1"},Pt={class:"flex items-center gap-1 px-1"},Rt=["disabled"],Nt={key:0},zt={key:1},_t={class:"flex-1 overflow-y-auto p-6 bg-gray-50"},jt={key:0,class:"absolute inset-x-0 top-[120px] bottom-0 z-50 bg-white/60 backdrop-blur-[2px] flex flex-col items-center justify-center text-blue-600 gap-3"},Dt={key:1,class:"h-full flex flex-col items-center justify-center text-gray-400"},Vt={key:2,class:"h-full flex flex-col items-center justify-center text-gray-400"},Ft=["src"],qt={key:0,class:"absolute top-2 left-2 bg-green-500 text-white text-[10px] font-bold px-2 py-1 rounded-full shadow-sm z-10 flex items-center gap-1"},Jt=["onClick"],Qt=["onClick"],Gt={key:4,class:"space-y-6 p-1"},Zt={class:"border border-gray-200 rounded-xl bg-white p-6 shadow-sm"},Kt={class:"space-y-4"},es={key:0,class:"grid grid-cols-2 gap-4"},ts={class:"space-y-2"},ss={class:"relative h-48 w-full rounded-lg overflow-hidden border border-gray-200 bg-gray-100 group"},os=["src"],is={class:"bg-gray-50 p-2 rounded-lg border border-gray-100 flex items-center justify-center gap-4"},rs={class:"flex items-center gap-1"},as={class:"flex items-center gap-1"},ns=["disabled"],ls={class:"space-y-2"},cs={class:"relative h-48 w-full flex justify-center rounded-lg border border-gray-200 bg-gray-100 overflow-hidden"},hs={class:"relative h-full aspect-[9/16]"},ps=["src"],us={class:"bg-gray-50 p-2 rounded-lg border border-gray-100 flex items-center justify-center gap-4"},ds={class:"flex items-center gap-1"},gs={class:"flex items-center gap-1"},fs=["disabled"],ms={key:0,class:"block w-4 h-4 border-2 border-blue-200 border-t-blue-600 rounded-full animate-spin"},vs={key:1,xmlns:"http://www.w3.org/2000/svg",class:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},bs={class:"flex gap-2"},xs=["disabled"],ws={key:0,class:"inline-block animate-spin"},ys={key:1},Cs={class:"flex flex-wrap gap-2"},ks=["onClick"],Os={class:"pt-4 flex items-center gap-3 border-t border-gray-100 mt-4"},Ms=["disabled"],Is={key:0,class:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"},Ws=["disabled"],Ss={key:0,class:"w-4 h-4 border-2 border-gray-400 border-t-gray-600 rounded-full animate-spin"},Hs={class:"bg-white rounded-xl shadow-2xl w-full max-w-sm p-6 transform transition-all scale-100 animate-in fade-in zoom-in duration-200"},Xs={class:"flex items-start gap-4 mb-4"},$s={class:"text-sm text-gray-600 leading-relaxed"},B="default-wallpaper.svg",fe="wallpaper-preview",Ys=me({__name:"WallpaperLibrary",props:{show:{type:Boolean},title:{}},emits:["update:show","select"],setup(e,{emit:s}){const o=e,i=s,t=Ye(),r=H("pc"),a=H([]),c=H([]),u=H(!1),d=H(!1),g=H(null),m=H(!1),v=H(""),W=H(()=>{}),z=()=>{m.value=!1},S=()=>{W.value(),z()},w=se(()=>t.appConfig.wallpaperApiPcList||"/api/backgrounds"),f=se(()=>t.appConfig.wallpaperApiMobileList||"/api/mobile_backgrounds"),b=async()=>{u.value=!0;const p=t.getHeaders();try{const n=await fetch(w.value,{headers:p});if(n.ok){const $=(await n.json()).filter(x=>x!==B),A=t.appConfig.pcWallpaperOrder||[],I=[],k=new Set($);I.push(B),A.forEach(x=>{k.has(x)&&x!==B&&(I.push(x),k.delete(x))}),k.forEach(x=>{x!==B&&I.push(x)}),a.value=I}else a.value=[B];const h=await fetch(f.value,{headers:p});if(h.ok){const $=(await h.json()).filter(x=>x!==B),A=t.appConfig.mobileWallpaperOrder||[],I=[],k=new Set($);I.push(B),A.forEach(x=>{k.has(x)&&x!==B&&(I.push(x),k.delete(x))}),k.forEach(x=>{x!==B&&I.push(x)}),c.value=I}else c.value=[B]}catch(n){console.error(n),a.value.includes(B)||(a.value=[B,...a.value]),c.value.includes(B)||(c.value=[B,...c.value])}finally{u.value=!1}},P=(p,n)=>{if(p===B)return t.getAssetUrl(`/${B}`);const h=n==="pc"?t.appConfig.wallpaperPcImageBase||"/backgrounds":t.appConfig.wallpaperMobileImageBase||"/mobile_backgrounds",M=h.endsWith("/")?h.slice(0,-1):h;return t.getAssetUrl(`${M}/${encodeURIComponent(p)}`)},Ue=(p,n)=>{if(ve(p,n)){const h=P(p,n);i("select",{url:h,type:n}),i("update:show",!1)}},ve=(p,n)=>{const h=P(p,n);return n==="pc"?t.appConfig.background=h:t.appConfig.mobileBackground=h,!0},le=se({get(){const p=r.value==="pc"?[...a.value]:[...c.value],n=r.value==="pc"?t.appConfig.background:t.appConfig.mobileBackground,h=r.value==="pc"?"pc":"mobile",M=p.findIndex($=>P($,h)===n);if(M>-1){const[$]=p.splice(M,1);$&&p.unshift($)}return p},set(p){r.value==="pc"?(a.value=p,t.appConfig.pcWallpaperOrder=p):(c.value=p,t.appConfig.mobileWallpaperOrder=p);const n=p[0];if(n){const h=r.value==="pc"?"pc":"mobile",M=h==="pc"?t.appConfig.background:t.appConfig.mobileBackground;P(n,h)!==M&&ve(n,h)}}}),Ee=()=>{g.value?.click()},oe=H([]),Ae=p=>{const n=p.target;if(!n.files||n.files.length===0)return;oe.value=Array.from(n.files),oe.value.some(M=>M.size>10*1024*1024)?(v.value="检测到文件超过 10MB，可能导致内存占用过高，是否继续上传？",W.value=be,m.value=!0):be(),n.value=""},be=async()=>{if(oe.value.length===0)return;d.value=!0;const p=new FormData;oe.value.forEach(h=>{p.append("files",h)});const n=r.value==="pc"?t.appConfig.wallpaperApiPcUpload||"/api/backgrounds/upload":t.appConfig.wallpaperApiMobileUpload||"/api/mobile_backgrounds/upload";try{const h=localStorage.getItem("flat-nas-token"),M={};h&&(M.Authorization=`Bearer ${h}`),(await fetch(n,{method:"POST",headers:M,body:p})).ok?(await b(),t.refreshResources()):alert("上传失败")}catch(h){console.error(h),alert("上传出错")}finally{d.value=!1,oe.value=[]}},Te=(p,n)=>{if(p===B){alert("默认壁纸无法删除");return}v.value="确定要删除这张壁纸吗？",W.value=()=>Pe(p,n),m.value=!0},Pe=async(p,n)=>{const h=P(p,n),M=n==="pc"?t.appConfig.background:t.appConfig.mobileBackground;if(h===M){const k=P(B,n);n==="pc"?t.appConfig.background=k:t.appConfig.mobileBackground=k}const $=n==="pc"?t.appConfig.wallpaperApiPcDeleteBase||"/api/backgrounds":t.appConfig.wallpaperApiMobileDeleteBase||"/api/mobile_backgrounds",I=`${$.endsWith("/")?$.slice(0,-1):$}/${encodeURIComponent(p)}`;try{const k=localStorage.getItem("flat-nas-token"),x={};k&&(x.Authorization=`Bearer ${k}`),(await fetch(I,{method:"DELETE",headers:x})).ok?(n==="pc"?a.value=a.value.filter(L=>L!==p):c.value=c.value.filter(L=>L!==p),t.refreshResources()):alert("删除失败")}catch(k){console.error(k)}},Z=se({get:()=>r.value==="pc"?t.appConfig.pcRotation:t.appConfig.mobileRotation,set:p=>{r.value==="pc"?t.appConfig.pcRotation=p:t.appConfig.mobileRotation=p}}),xe=se({get:()=>r.value==="pc"?t.appConfig.pcRotationInterval??30:t.appConfig.mobileRotationInterval??30,set:p=>{r.value==="pc"?t.appConfig.pcRotationInterval=p:t.appConfig.mobileRotationInterval=p}}),ie=se({get:()=>r.value==="pc"?t.appConfig.pcRotationMode??"random":t.appConfig.mobileRotationMode??"random",set:p=>{r.value==="pc"?t.appConfig.pcRotationMode=p:t.appConfig.mobileRotationMode=p}}),Re=()=>{Z.value=!Z.value},Ne=()=>{ie.value=ie.value==="random"?"sequential":"random"},X=H(""),K=H(""),q=H(!1),J=H(null),j=H(""),ee=H(0),re=H(""),we=[{name:"Bing 每日壁纸",url:"https://bing.biturl.top/?resolution=1920&format=image&index=0&mkt=zh-CN",autoUpdate:!0},{name:"随机风景 (Picsum)",url:"https://picsum.photos/1920/1080",autoUpdate:!1},{name:"随机二次元 (PC)",url:"https://www.loliapi.com/acg/pc/",autoUpdate:!1},{name:"随机二次元 (PE)",url:"https://www.loliapi.com/acg/pe/",autoUpdate:!1}],ce=p=>{re.value&&(Se(fe),re.value=""),X.value=p,p.startsWith("blob:")&&(re.value=p)},te=p=>{const n=Je(fe,p);J.value=p,ce(n)},ye=()=>{re.value&&(Se(fe),re.value=""),J.value=null,j.value=""};je(()=>o.show,p=>{p||ye()});const he=async p=>{K.value=p;const n=++ee.value;q.value=!0;try{const h=await gt(p);if(n!==ee.value)return;if(h){j.value=p,te(h),q.value=!1;return}}catch(h){console.warn("Cache lookup failed",h)}try{const h=wt(),M=new AbortController,$=setTimeout(()=>M.abort(),1e4),A=await fetch(`/api/wallpaper/proxy?url=${encodeURIComponent(p)}&uuid=${h}`,{signal:M.signal});if(clearTimeout($),n!==ee.value)return;if(A.ok){const I=await A.blob();await dt(p,I,A.headers.get("ETag")||void 0),j.value=p,te(I),q.value=!1;return}}catch(h){console.warn("Proxy fetch failed, falling back to direct URL",h)}try{const h=p.includes("?")?"&":"?",M=`${p}${h}v=${Date.now()}`,$=await fetch("/api/wallpaper/resolve",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:M})});if(n!==ee.value)return;const A=$.ok?(await $.json()).url:M;j.value=A;try{const I=await fetch(`/api/wallpaper/proxy?url=${encodeURIComponent(A)}&uuid=${n}`);if(n!==ee.value)return;if(I.ok){const k=await I.blob();te(k);return}}catch(I){console.warn("Resolve proxy fetch failed, using URL preview",I)}J.value=null,ce(A)}catch{if(n!==ee.value)return;J.value=null,j.value=p,ce(p)}finally{n===ee.value&&(q.value=!1)}},ze=async p=>{await he(p)},_e=()=>{const p=K.value||X.value;if(p){const n=p.replace(/([?&])v=\d+/,"$1").replace(/[?&]$/,"");he(n)}},R=H(!1),ae=async(p,n=!0)=>{if(X.value){R.value=!0;try{const h=localStorage.getItem("flat-nas-token");let M="";const A=await(async()=>{if(q.value)for(let x=0;x<20&&q.value;x+=1)await new Promise(U=>setTimeout(U,100));const I=async x=>{try{const U=await fetch(x,{cache:"no-store"});if(!U.ok)return null;const L=await U.blob();return te(L),L}catch{return null}};if(J.value||(!j.value&&(K.value||X.value)&&await he(K.value||X.value),J.value))return J.value;const k=K.value||j.value||X.value;if(k){const x=await fetch(`/api/wallpaper/proxy?url=${encodeURIComponent(k)}&uuid=apply`);if(x.ok){const L=await x.blob();return j.value=k,te(L),L}const U=await I(k);if(U)return U}if(k&&k.startsWith("http")){const x=k.includes("?")?"&":"?",U=`${k}${x}v=${Date.now()}`,L=await fetch("/api/wallpaper/resolve",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:U})});if(L.ok){const G=await L.json();j.value=G.url;const Ce=await fetch(`/api/wallpaper/proxy?url=${encodeURIComponent(G.url)}&uuid=apply-resolve`);if(Ce.ok){const Oe=await Ce.blob();return te(Oe),Oe}const ke=await I(G.url);if(ke)return ke}}if(X.value.startsWith("blob:")){const x=await fetch(X.value).then(U=>U.blob());return J.value=x,x}return null})();if(A){n&&p==="pc"&&(document.body.style.backgroundImage=`url(${X.value})`);const I=new FormData,k=A.type.split("/")[1]||"jpg",x=`blob_${Date.now()}.${k}`;I.append("files",A,x);const U=p==="pc"?t.appConfig.wallpaperApiPcUpload||"/api/backgrounds/upload":t.appConfig.wallpaperApiMobileUpload||"/api/mobile_backgrounds/upload",L=await fetch(U,{method:"POST",headers:{Authorization:`Bearer ${h}`},body:I});if(L.ok){const G=await L.json();if(G.success&&G.files&&G.files.length>0)M=G.files[0].path;else throw new Error("Upload failed: No path returned")}else throw new Error("Upload failed: "+L.statusText)}else throw new Error("No preview image available");if(n){const I=we.find(L=>L.url===K.value||L.url===X.value),k=I?I.autoUpdate:!1,U={type:"api",url:k?K.value||X.value:M,enabled:!!k,lastUpdated:Date.now()};p==="pc"?(t.appConfig.background=M,t.appConfig.wallpaperConfig=U):(t.appConfig.mobileBackground=M,t.appConfig.mobileWallpaperConfig=U),t.saveData(),alert("设置成功")}else await b(),alert(p==="pc"?"已保存到 PC 壁纸库":"已保存到手机壁纸库")}catch(h){console.error(h),alert("请求出错，请检查网络"),p==="pc"&&(t.appConfig.background=t.getAssetUrl(`/${B}`))}finally{R.value=!1}}};return De(()=>{b(),t.appConfig.background?.startsWith("http")&&(X.value=t.appConfig.background,j.value=t.appConfig.background)}),Ve(()=>{ye()}),(p,n)=>(y(),C(pe,null,[(y(),ue(We,{to:"body"},[e.show?(y(),C("div",{key:0,class:"fixed inset-0 z-[100] flex items-center justify-center bg-black/50 backdrop-blur-sm",onClick:n[21]||(n[21]=de(h=>p.$emit("update:show",!1),["self"]))},[l("div",yt,[l("div",Ct,[l("div",kt,[l("h3",Ot,T(e.title||"壁纸库"),1),l("div",Mt,[l("button",{onClick:n[0]||(n[0]=h=>r.value="pc"),class:N(["px-3 py-1.5 text-xs font-bold rounded-md transition-all flex items-center gap-2",r.value==="pc"?"bg-white text-blue-600 shadow-sm":"text-gray-500 hover:text-gray-700"])},[n[22]||(n[22]=Q(" PC 壁纸 ",-1)),l("span",It,T(a.value.length),1)],2),l("button",{onClick:n[1]||(n[1]=h=>r.value="mobile"),class:N(["px-3 py-1.5 text-xs font-bold rounded-md transition-all flex items-center gap-2",r.value==="mobile"?"bg-white text-blue-600 shadow-sm":"text-gray-500 hover:text-gray-700"])},[n[23]||(n[23]=Q(" 手机壁纸 ",-1)),l("span",Wt,T(c.value.length),1)],2),l("button",{onClick:n[2]||(n[2]=h=>r.value="api"),class:N(["px-3 py-1.5 text-xs font-bold rounded-md transition-all flex items-center gap-2",r.value==="api"?"bg-white text-blue-600 shadow-sm":"text-gray-500 hover:text-gray-700"])}," API 接口 ",2)])]),l("button",{onClick:n[3]||(n[3]=h=>p.$emit("update:show",!1)),class:"w-8 h-8 rounded-full bg-red-100 hover:bg-red-200 flex items-center justify-center text-red-500 hover:text-red-900 transition-colors"}," ✕ ")]),l("div",St,[n[31]||(n[31]=l("div",{class:"text-xs text-gray-400 hidden md:block"},"请拖动选择",-1)),l("div",Ht,[l("div",Xt,[l("button",{onClick:Ne,class:N(["px-2 py-1 text-xs font-medium rounded transition-colors flex items-center gap-1",ie.value==="random"?"text-purple-600 bg-purple-50":"text-blue-600 bg-blue-50"]),title:ie.value==="random"?"当前：随机播放":"当前：顺序播放"},[l("span",null,T(ie.value==="random"?"随机":"顺播"),1)],10,$t),n[24]||(n[24]=l("div",{class:"h-4 w-px bg-gray-300"},null,-1)),l("div",Yt,[l("button",{onClick:Re,class:N(["text-xs font-medium transition-colors flex items-center gap-1 px-2 py-1 rounded",Z.value?"bg-green-100 text-green-700":"text-gray-600 hover:bg-white"])},[l("span",null,T(Z.value?"轮播中":"点击轮播"),1)],2),Z.value?Y("",!0):_((y(),C("input",{key:0,type:"number","onUpdate:modelValue":n[4]||(n[4]=h=>xe.value=h),min:"5",class:"w-10 text-xs border border-gray-200 rounded px-1 py-0.5 text-center outline-none focus:border-blue-500",title:"轮播间隔(分钟)"},null,512)),[[D,xe.value]]),Z.value?Y("",!0):(y(),C("span",Lt,"分"))])]),Z.value?Y("",!0):(y(),C("button",{key:0,onClick:n[5]||(n[5]=h=>O(t).appConfig.fixedWallpaper=!O(t).appConfig.fixedWallpaper),class:N(["px-3 py-1.5 rounded-lg text-xs font-bold transition-all flex items-center gap-1 shadow-sm",O(t).appConfig.fixedWallpaper?"bg-blue-500 text-white hover:bg-blue-600 shadow-blue-200":"bg-gray-100 text-gray-600 hover:bg-gray-200"]),title:"固定当前壁纸，不参与轮播"},[l("span",null,T(O(t).appConfig.fixedWallpaper?"已固定":"固定"),1)],2)),r.value==="pc"?(y(),C("div",Bt,[l("div",Ut,[n[25]||(n[25]=l("span",{class:"text-[13px] text-gray-500"},"模糊",-1)),_(l("input",{type:"range","onUpdate:modelValue":n[6]||(n[6]=h=>O(t).appConfig.backgroundBlur=h),min:"0",max:"20",step:"1",class:"w-16 h-1.5 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-500",title:"模糊半径"},null,512),[[D,O(t).appConfig.backgroundBlur,void 0,{number:!0}]])]),n[27]||(n[27]=l("div",{class:"w-px h-3 bg-gray-300"},null,-1)),l("div",Et,[n[26]||(n[26]=l("span",{class:"text-[13px] text-gray-500"},"遮罩",-1)),_(l("input",{type:"range","onUpdate:modelValue":n[7]||(n[7]=h=>O(t).appConfig.backgroundMask=h),min:"0",max:"1",step:"0.1",class:"w-16 h-1.5 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-500",title:"遮罩浓度"},null,512),[[D,O(t).appConfig.backgroundMask,void 0,{number:!0}]])])])):Y("",!0),r.value==="mobile"?(y(),C("div",At,[l("div",Tt,[n[28]||(n[28]=l("span",{class:"text-[13px] text-gray-500"},"模糊",-1)),_(l("input",{type:"range","onUpdate:modelValue":n[8]||(n[8]=h=>O(t).appConfig.mobileBackgroundBlur=h),min:"0",max:"20",step:"1",class:"w-16 h-1.5 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-400",title:"模糊半径"},null,512),[[D,O(t).appConfig.mobileBackgroundBlur,void 0,{number:!0}]])]),n[30]||(n[30]=l("div",{class:"w-px h-3 bg-gray-300"},null,-1)),l("div",Pt,[n[29]||(n[29]=l("span",{class:"text-[13px] text-gray-500"},"遮罩",-1)),_(l("input",{type:"range","onUpdate:modelValue":n[9]||(n[9]=h=>O(t).appConfig.mobileBackgroundMask=h),min:"0",max:"1",step:"0.1",class:"w-16 h-1.5 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-400",title:"遮罩浓度"},null,512),[[D,O(t).appConfig.mobileBackgroundMask,void 0,{number:!0}]])])])):Y("",!0),r.value==="mobile"?(y(),C("button",{key:3,onClick:n[10]||(n[10]=h=>O(t).appConfig.enableMobileWallpaper=!O(t).appConfig.enableMobileWallpaper),class:N(["px-3 py-1.5 rounded-lg text-xs font-bold transition-all flex items-center gap-1 shadow-sm",O(t).appConfig.enableMobileWallpaper?"bg-green-500 text-white hover:bg-green-600 shadow-green-200":"bg-gray-100 text-gray-600 hover:bg-gray-200"]),title:"开启后，手机端将优先使用手机壁纸；关闭后，手机端将使用 PC 端壁纸"},[l("span",null,T(O(t).appConfig.enableMobileWallpaper?"已启用手机壁纸":"启用手机壁纸"),1)],2)):Y("",!0),l("button",{onClick:b,class:"px-3 py-1.5 rounded-lg text-xs font-medium text-gray-600 hover:bg-gray-100 transition-colors flex items-center gap-1"}," 刷新 "),l("button",{onClick:Ee,class:"px-4 py-1.5 rounded-lg text-xs font-bold text-white bg-blue-600 hover:bg-blue-700 shadow-sm shadow-blue-200 transition-all flex items-center gap-1",disabled:d.value},[d.value?(y(),C("span",Nt,"上传中...")):(y(),C("span",zt,"上传壁纸"))],8,Rt),l("input",{ref_key:"fileInput",ref:g,type:"file",accept:"image/*",multiple:"",class:"hidden",onChange:Ae},null,544)])]),l("div",_t,[q.value?(y(),C("div",jt,[...n[32]||(n[32]=[l("div",{class:"w-10 h-10 border-4 border-blue-100 border-t-blue-500 rounded-full animate-spin"},null,-1),l("span",{class:"text-sm font-bold bg-white/80 px-4 py-1.5 rounded-full shadow-sm"},"正在通过代理获取并优化壁纸一致性...",-1)])])):Y("",!0),u.value?(y(),C("div",Dt,[...n[33]||(n[33]=[l("div",{class:"w-8 h-8 border-4 border-blue-200 border-t-blue-500 rounded-full animate-spin mb-2"},null,-1),l("span",{class:"text-xs"},"加载中...",-1)])])):r.value==="pc"&&a.value.length===0||r.value==="mobile"&&c.value.length===0?(y(),C("div",Vt,[...n[34]||(n[34]=[l("span",{class:"text-4xl mb-2"},"🖼️",-1),l("span",{class:"text-sm"},"暂无壁纸，请先上传",-1)])])):r.value!=="api"?(y(),ue(O(Fe),{key:3,modelValue:le.value,"onUpdate:modelValue":n[11]||(n[11]=h=>le.value=h),class:N(["grid gap-2 md:gap-4",r.value==="pc"?"grid-cols-1 md:grid-cols-2 lg:grid-cols-3":"grid-cols-2 md:grid-cols-3 lg:grid-cols-4"]),animation:150,forceFallback:!0},{default:qe(()=>[(y(!0),C(pe,null,Ie(le.value,(h,M)=>(y(),C("div",{key:h,class:N(["group relative rounded-xl overflow-hidden cursor-grab border-2 border-transparent hover:border-blue-500 transition-all shadow-sm hover:shadow-md bg-white",r.value==="pc"?"aspect-video":"aspect-[9/16]"])},[l("img",{src:P(h,r.value==="pc"?"pc":"mobile"),class:"w-full h-full object-cover transition-all duration-300 group-hover:scale-110",loading:"lazy"},null,8,Ft),M===0?(y(),C("div",qt,[...n[35]||(n[35]=[l("span",null,"默认壁纸",-1)])])):Y("",!0),n[37]||(n[37]=l("div",{class:"absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors"},null,-1)),l("div",{class:"absolute inset-0 flex items-center justify-center bg-black/50 text-white text-lg font-bold opacity-0 group-hover:opacity-100 transition-opacity z-10",onClick:$=>Ue(h,r.value==="pc"?"pc":"mobile")}," 设为默认壁纸 ",8,Jt),l("button",{onClick:de($=>Te(h,r.value==="pc"?"pc":"mobile"),["stop"]),class:"absolute top-2 right-2 p-1.5 bg-red-500 text-white rounded-lg opacity-0 group-hover:opacity-100 transition-opacity hover:bg-red-600 shadow-sm z-20",title:"删除"},[...n[36]||(n[36]=[l("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,Qt)],2))),128))]),_:1},8,["modelValue","class"])):Y("",!0),r.value==="api"?(y(),C("div",Gt,[n[52]||(n[52]=l("div",{class:"bg-blue-50 text-blue-800 p-4 rounded-xl text-sm leading-relaxed"},[l("ul",{class:"list-disc list-inside space-y-1"},[l("li",null,"在此处可以直接输入图片的 URL 地址，或使用第三方随机壁纸 API。"),l("li",null,[Q(" 支持 "),l("b",null,"JSON 格式 API"),Q("（如 Unsplash/Bing），系统会自动解析并提取图片链接。 ")]),l("li",null,[Q("支持 "),l("b",null,"局域网/自建 API"),Q("（如 http://192.168.x.x），不再受内网访问限制。")])]),l("div",{class:"mt-2 text-xs opacity-80"}," 设置后，每次刷新页面可能会根据 API 返回不同的图片（取决于 API 行为）。 ")],-1)),l("div",Zt,[n[51]||(n[51]=l("h4",{class:"text-sm font-bold text-gray-800 mb-4 flex items-center gap-2"},[l("span",null,"🔗"),Q(" 自定义壁纸接口 ")],-1)),l("div",Kt,[X.value?(y(),C("div",es,[l("div",ts,[n[43]||(n[43]=l("div",{class:"text-[10px] text-gray-500 text-center font-bold"},"PC 端预览",-1)),l("div",ss,[l("img",{src:X.value,class:"w-full h-full object-cover transition-all duration-700",style:V({filter:`blur(${O(t).appConfig.backgroundBlur}px)`})},null,12,os),l("div",{class:"absolute inset-0 pointer-events-none transition-all duration-300",style:V({backgroundColor:`rgba(0,0,0,${O(t).appConfig.backgroundMask})`})},null,4)]),l("div",is,[l("div",rs,[n[38]||(n[38]=l("span",{class:"text-[10px] text-gray-500"},"模糊",-1)),_(l("input",{type:"range","onUpdate:modelValue":n[12]||(n[12]=h=>O(t).appConfig.backgroundBlur=h),min:"0",max:"20",step:"1",class:"w-20 h-1.5 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-500"},null,512),[[D,O(t).appConfig.backgroundBlur,void 0,{number:!0}]])]),n[41]||(n[41]=l("div",{class:"w-px h-3 bg-gray-300"},null,-1)),l("div",as,[n[39]||(n[39]=l("span",{class:"text-[10px] text-gray-500"},"遮罩",-1)),_(l("input",{type:"range","onUpdate:modelValue":n[13]||(n[13]=h=>O(t).appConfig.backgroundMask=h),min:"0",max:"1",step:"0.1",class:"w-20 h-1.5 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-500"},null,512),[[D,O(t).appConfig.backgroundMask,void 0,{number:!0}]])]),n[42]||(n[42]=l("div",{class:"w-px h-3 bg-gray-300"},null,-1)),l("button",{onClick:n[14]||(n[14]=h=>ae("pc",!1)),class:"p-1.5 text-blue-600 hover:bg-blue-50 rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:!X.value||R.value,title:"下载到 PC 壁纸库"},[...n[40]||(n[40]=[l("svg",{xmlns:"http://www.w3.org/2000/svg",class:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1)])],8,ns)])]),l("div",ls,[n[49]||(n[49]=l("div",{class:"text-[10px] text-gray-500 text-center font-bold"},"手机端预览",-1)),l("div",cs,[l("div",hs,[l("img",{src:X.value,class:"w-full h-full object-cover transition-all duration-700",style:V({filter:`blur(${O(t).appConfig.mobileBackgroundBlur}px)`})},null,12,ps),l("div",{class:"absolute inset-0 pointer-events-none transition-all duration-300",style:V({backgroundColor:`rgba(0,0,0,${O(t).appConfig.mobileBackgroundMask})`})},null,4)])]),l("div",us,[l("div",ds,[n[44]||(n[44]=l("span",{class:"text-[10px] text-gray-500"},"模糊",-1)),_(l("input",{type:"range","onUpdate:modelValue":n[15]||(n[15]=h=>O(t).appConfig.mobileBackgroundBlur=h),min:"0",max:"20",step:"1",class:"w-20 h-1.5 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-500"},null,512),[[D,O(t).appConfig.mobileBackgroundBlur,void 0,{number:!0}]])]),n[47]||(n[47]=l("div",{class:"w-px h-3 bg-gray-300"},null,-1)),l("div",gs,[n[45]||(n[45]=l("span",{class:"text-[10px] text-gray-500"},"遮罩",-1)),_(l("input",{type:"range","onUpdate:modelValue":n[16]||(n[16]=h=>O(t).appConfig.mobileBackgroundMask=h),min:"0",max:"1",step:"0.1",class:"w-20 h-1.5 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-500"},null,512),[[D,O(t).appConfig.mobileBackgroundMask,void 0,{number:!0}]])]),n[48]||(n[48]=l("div",{class:"w-px h-3 bg-gray-300"},null,-1)),l("button",{onClick:n[17]||(n[17]=h=>ae("mobile",!1)),class:"p-1.5 text-blue-600 hover:bg-blue-50 rounded-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:!X.value||R.value,title:"下载到 手机壁纸库"},[R.value?(y(),C("span",ms)):(y(),C("svg",vs,[...n[46]||(n[46]=[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"},null,-1)])]))],8,fs)])])])):Y("",!0),l("div",null,[n[50]||(n[50]=l("label",{class:"block text-xs font-medium text-gray-600 mb-2"},"图片 URL / API 地址",-1)),l("div",bs,[_(l("input",{"onUpdate:modelValue":n[18]||(n[18]=h=>X.value=h),class:"flex-1 px-4 py-3 border border-gray-200 rounded-lg text-sm focus:border-blue-500 focus:ring-2 focus:ring-blue-100 outline-none transition-all",placeholder:"https://example.com/image.jpg 或 随机图片API"},null,512),[[D,X.value]]),l("button",{onClick:_e,class:"px-3 bg-gray-100 hover:bg-gray-200 text-gray-600 rounded-lg border border-gray-200 transition-colors disabled:opacity-50",title:"刷新预览 (追加时间戳)",disabled:q.value},[q.value?(y(),C("span",ws,"🔄")):(y(),C("span",ys,"🔄"))],8,xs)])]),l("div",Cs,[(y(),C(pe,null,Ie(we,h=>l("button",{key:h.name,onClick:M=>ze(h.url),class:"px-3 py-1.5 bg-gray-100 hover:bg-gray-200 text-gray-700 text-xs rounded-lg transition-colors"},T(h.name),9,ks)),64))]),l("div",Os,[l("button",{onClick:n[19]||(n[19]=h=>ae("pc")),class:N(["flex-1 px-4 py-2.5 bg-blue-600 hover:bg-blue-700 text-white text-sm font-bold rounded-lg shadow-sm transition-all active:scale-95 flex items-center justify-center gap-2",!X.value||R.value?"opacity-50 cursor-not-allowed":""]),disabled:!X.value||R.value},[R.value?(y(),C("span",Is)):Y("",!0),Q(" "+T(R.value?"保存中...":"应用到 PC 壁纸"),1)],10,Ms),l("button",{onClick:n[20]||(n[20]=h=>ae("mobile")),class:N(["flex-1 px-4 py-2.5 bg-white border border-gray-200 hover:bg-gray-50 text-gray-700 text-sm font-bold rounded-lg shadow-sm transition-all active:scale-95 flex items-center justify-center gap-2",!X.value||R.value?"opacity-50 cursor-not-allowed":""]),disabled:!X.value||R.value},[R.value?(y(),C("span",Ss)):Y("",!0),Q(" "+T(R.value?"保存中...":"应用到 手机壁纸"),1)],10,Ws)])])])])):Y("",!0)])])])):Y("",!0)])),(y(),ue(We,{to:"body"},[m.value?(y(),C("div",{key:0,class:"fixed inset-0 z-[200] flex items-center justify-center bg-black/60 backdrop-blur-sm",onClick:de(z,["self"])},[l("div",Hs,[l("div",Xs,[n[54]||(n[54]=l("div",{class:"p-2 bg-yellow-100 rounded-full text-yellow-600 shrink-0"},[l("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[l("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})])],-1)),l("div",null,[n[53]||(n[53]=l("h3",{class:"text-lg font-bold text-gray-900 mb-2"},"提示",-1)),l("p",$s,T(v.value),1)])]),l("div",{class:"flex justify-end gap-3"},[l("button",{onClick:z,class:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors"}," 取消 "),l("button",{onClick:S,class:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors shadow-sm"}," 确定 ")])])])):Y("",!0)]))],64))}}),Ls={class:"w-full"},Bs={key:0,class:"absolute inset-0 z-0 overflow-hidden"},Us=["src"],Es={class:"text-xs text-gray-500 group-hover:text-blue-600"},As={key:0,class:"fixed inset-0 z-[999] bg-black/60 flex items-center justify-center p-4 backdrop-blur-sm"},Ts={class:"bg-white w-full max-w-lg rounded-2xl overflow-hidden shadow-2xl flex flex-col h-[500px]"},Ps={class:"px-4 py-3 border-b border-gray-100 flex justify-between items-center"},Rs={class:"flex-1 bg-gray-900 relative"},Ns={class:"px-4 py-2 bg-gray-800 flex items-center gap-3 border-t border-gray-700"},zs=["value"],_s={class:"text-gray-400 text-xs font-mono w-10 text-right"},js={class:"p-4 bg-gray-50 flex justify-end gap-3"},Vs=me({__name:"IconUploader",props:{modelValue:{},crop:{type:Boolean,default:!0},previewStyle:{default:()=>({})},overlayStyle:{default:()=>({})},uploadOnly:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:s}){const o=e,i=s,t=Ye(),r=H(!1),a=H(!1),c=H(""),u=H(),d=H(null),g=H(1),m=()=>{o.uploadOnly||o.crop?d.value?.click():a.value=!0},v=w=>{const f=typeof w=="string"?w:w.url;i("update:modelValue",f)},W=w=>{const f=w.target.files?.[0];if(!f)return;if(f.size>5*1024*1024){alert("图片太大啦，请上传小于 5MB 的图片");return}const b=new FileReader;b.onload=P=>{c.value=P.target?.result,o.crop?(g.value=1,r.value=!0):i("update:modelValue",c.value)},b.readAsDataURL(f),d.value&&(d.value.value="")},z=w=>{const f=parseFloat(w.target.value),b=f-g.value;u.value.changeScale(b),g.value=f},S=()=>{u.value.getCropData(w=>{const f=new Image;f.onload=()=>{const b=document.createElement("canvas");b.width=216,b.height=216;const P=b.getContext("2d");P?(P.imageSmoothingEnabled=!0,P.imageSmoothingQuality="high",P.drawImage(f,0,0,216,216),i("update:modelValue",b.toDataURL("image/png"))):i("update:modelValue",w),r.value=!1},f.src=w})};return(w,f)=>(y(),C("div",Ls,[l("input",{ref_key:"fileInput",ref:d,type:"file",accept:"image/*",class:"hidden",onChange:W},null,544),l("div",{class:"w-full h-32 border-2 border-dashed border-gray-300 rounded-xl flex flex-col items-center justify-center cursor-pointer hover:border-blue-400 hover:bg-blue-50 transition-all group relative overflow-hidden",onClick:m},[e.modelValue?(y(),C("div",Bs,[l("img",{src:O(t).getAssetUrl(e.modelValue),class:"w-full h-full object-cover transition-all duration-300",style:V(e.previewStyle)},null,12,Us),l("div",{class:"absolute inset-0 transition-all duration-300",style:V(e.overlayStyle)},null,4)])):Y("",!0),l("div",{class:N(["z-10 flex flex-col items-center justify-center",e.modelValue?"opacity-0 group-hover:opacity-100 bg-white/80 absolute inset-0 transition-opacity":""])},[f[3]||(f[3]=l("span",{class:"text-2xl text-gray-400 mb-1 group-hover:text-blue-500"},"+",-1)),l("span",Es,T(e.uploadOnly?"点击上传":e.crop?"点击上传 / 裁剪":"从壁纸库选择"),1)],2)]),He(Ys,{show:a.value,"onUpdate:show":f[0]||(f[0]=b=>a.value=b),onSelect:v},null,8,["show"]),r.value?(y(),C("div",As,[l("div",Ts,[l("div",Ps,[f[4]||(f[4]=l("h3",{class:"font-bold text-gray-700"},"裁剪图片",-1)),l("button",{onClick:f[1]||(f[1]=b=>r.value=!1),class:"text-gray-400 hover:text-gray-600 text-xl"}," × ")]),l("div",Rs,[He(O(ct),{ref_key:"cropper",ref:u,img:c.value,autoCrop:!0,autoCropWidth:216,autoCropHeight:216,fixed:!0,fixedNumber:[1,1],centerBox:!0,outputType:"png"},null,8,["img"])]),l("div",Ns,[f[5]||(f[5]=l("span",{class:"text-gray-400 text-xs"},"🔍",-1)),l("input",{type:"range",min:"0.1",max:"3",step:"0.1",value:g.value,onInput:z,class:"flex-1 h-1 bg-gray-600 rounded-lg appearance-none cursor-pointer accent-blue-400"},null,40,zs),l("span",_s,T(Math.round(g.value*100))+"%",1)]),l("div",js,[l("button",{onClick:f[2]||(f[2]=b=>r.value=!1),class:"px-4 py-2 rounded-lg text-gray-600 hover:bg-gray-200 transition-colors"}," 取消 "),l("button",{onClick:S,class:"px-6 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 shadow-lg shadow-blue-200 transition-all"}," 确认使用 ")])])])):Y("",!0)]))}});export{Vs as _,Ys as a};
