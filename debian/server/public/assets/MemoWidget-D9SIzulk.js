import{d as he,Q as Te,R as it,r as g,w as Y,E as We,e as v,b as u,_ as Fe,F as G,i as ue,t as H,u as ct,S as ut,U as dt,c as ae,o as vt,f as T,h as p,a as Ve,m as Ee,j as x,C as Se,n as R,g as se,q as Pe,y as ft,A as mt,p as Ae,k as pt,D as ht}from"./index-0Xhfa8Kb.js";const gt=["contenteditable","data-placeholder"],yt=he({__name:"MemoEditor",props:Te({editable:{type:Boolean},placeholder:{}},{content:{},contentModifiers:{}}),emits:Te(["focus","blur","input"],["update:content"]),setup(e,{expose:t,emit:o}){const i=o,r=it(e,"content"),s=g(null),f=g(!1);Y(r,c=>{!f.value&&s.value&&c!==s.value.innerHTML&&(s.value.innerHTML=c||"")});const m=()=>{s.value&&(r.value=s.value.innerHTML),i("input")},d=()=>{f.value=!0,i("focus")},w=()=>{f.value=!1,m(),i("blur")},h=(c,y)=>{document.execCommand(c,!1,y),m(),s.value&&s.value.focus()};return We(()=>{s.value&&(s.value.innerHTML=r.value||"")}),t({execCommand:h,editorRef:s}),(c,y)=>(u(),v("div",{ref_key:"editorRef",ref:s,contenteditable:e.editable,class:"w-full h-full bg-transparent outline-none text-sm text-gray-800 break-words font-sans leading-relaxed overflow-y-auto p-2 empty:before:content-[attr(data-placeholder)] empty:before:text-gray-400","data-placeholder":e.placeholder,onInput:m,onFocus:d,onBlur:w},null,40,gt))}}),bt=Fe(yt,[["__scopeId","data-v-3d2ca38b"]]),wt={class:"flex items-center gap-1 mt-0 pt-0 border-t border-gray-200/20 flex-wrap -mx-4 -mb-4 px-0 pb-0"},xt={key:0,class:"w-px h-4 bg-gray-400/30 mx-1"},kt=["aria-label","title","onClick"],Dt=["innerHTML"],Mt={key:1,class:"text-[10px] font-bold w-4 h-4 flex items-center justify-center"},It=he({__name:"MemoToolbar",emits:["command"],setup(e,{emit:t}){const o=t,i=[{cmd:"bold",label:"Bold",icon:'<path d="M6 4h8a4 4 0 0 1 4 4 4 4 0 0 1-4 4h-1v4h1a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6V4zm5 6h3a2 2 0 0 0 0-4h-3v4zm0 8h3a2 2 0 0 0 0-4h-3v4z"/>'},{cmd:"italic",label:"Italic",icon:'<path d="M10 4v3h2.21l-3.42 8H6v3h8v-3h-2.21l3.42-8H18V4z"/>'},{separator:!0},{cmd:"formatBlock",val:"H1",label:"H1",text:"H1"},{cmd:"formatBlock",val:"H2",label:"H2",text:"H2"},{separator:!0},{cmd:"insertUnorderedList",label:"List",icon:'<path d="M4 10.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0-6c-.83 0-1.5.67-1.5 1.5S3.17 7.5 4 7.5 5.5 6.83 5.5 6 4.83 4.5 4 4.5zm0 12c-.83 0-1.5.68-1.5 1.5s.68 1.5 1.5 1.5 1.5-.68 1.5-1.5-.67-1.5-1.5-1.5zM7 19h14v-2H7v2zm0-6h14v-2H7v2zm0-8v2h14V5H7z"/>'},{cmd:"formatBlock",val:"PRE",label:"Code",icon:'<path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"/>'},{cmd:"formatBlock",val:"BLOCKQUOTE",label:"Quote",icon:'<path d="M6 17h3l2-4V7H5v6h3zm8 0h3l2-4V7h-6v6h3z"/>'}],r=s=>{s.cmd&&o("command",s.cmd,s.val)};return(s,f)=>(u(),v("div",wt,[(u(),v(G,null,ue(i,(m,d)=>(u(),v(G,{key:d},[m.separator?(u(),v("div",xt)):(u(),v("button",{key:1,type:"button",class:"p-1.5 rounded transition-all duration-200 text-gray-600 hover:text-[#0052D9] hover:bg-white/40 focus:outline-none focus:ring-2 focus:ring-[#0052D9]/50 disabled:opacity-40 disabled:cursor-not-allowed active:scale-95","aria-label":m.label,title:m.label,onClick:w=>r(m)},[m.icon?(u(),v("svg",{key:0,viewBox:"0 0 24 24",class:"w-4 h-4 fill-current",innerHTML:m.icon},null,8,Dt)):(u(),v("span",Mt,H(m.text),1))],8,kt))],64))),64))]))}}),de=(e,t)=>t.some(o=>e instanceof o);let He,ze;function Lt(){return He||(He=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Ct(){return ze||(ze=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const ve=new WeakMap,re=new WeakMap,J=new WeakMap;function Bt(e){const t=new Promise((o,i)=>{const r=()=>{e.removeEventListener("success",s),e.removeEventListener("error",f)},s=()=>{o(V(e.result)),r()},f=()=>{i(e.error),r()};e.addEventListener("success",s),e.addEventListener("error",f)});return J.set(t,e),t}function _t(e){if(ve.has(e))return;const t=new Promise((o,i)=>{const r=()=>{e.removeEventListener("complete",s),e.removeEventListener("error",f),e.removeEventListener("abort",f)},s=()=>{o(),r()},f=()=>{i(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",s),e.addEventListener("error",f),e.addEventListener("abort",f)});ve.set(e,t)}let fe={get(e,t,o){if(e instanceof IDBTransaction){if(t==="done")return ve.get(e);if(t==="store")return o.objectStoreNames[1]?void 0:o.objectStore(o.objectStoreNames[0])}return V(e[t])},set(e,t,o){return e[t]=o,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function Ne(e){fe=e(fe)}function Tt(e){return Ct().includes(e)?function(...t){return e.apply(me(this),t),V(this.request)}:function(...t){return V(e.apply(me(this),t))}}function Vt(e){return typeof e=="function"?Tt(e):(e instanceof IDBTransaction&&_t(e),de(e,Lt())?new Proxy(e,fe):e)}function V(e){if(e instanceof IDBRequest)return Bt(e);if(re.has(e))return re.get(e);const t=Vt(e);return t!==e&&(re.set(e,t),J.set(t,e)),t}const me=e=>J.get(e);function Et(e,t,{blocked:o,upgrade:i,blocking:r,terminated:s}={}){const f=indexedDB.open(e,t),m=V(f);return i&&f.addEventListener("upgradeneeded",d=>{i(V(f.result),d.oldVersion,d.newVersion,V(f.transaction),d)}),o&&f.addEventListener("blocked",d=>o(d.oldVersion,d.newVersion,d)),m.then(d=>{s&&d.addEventListener("close",()=>s()),r&&d.addEventListener("versionchange",w=>r(w.oldVersion,w.newVersion,w))}).catch(()=>{}),m}const St=["get","getKey","getAll","getAllKeys","count"],Pt=["put","add","delete","clear"],le=new Map;function $e(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(le.get(t))return le.get(t);const o=t.replace(/FromIndex$/,""),i=t!==o,r=Pt.includes(o);if(!(o in(i?IDBIndex:IDBObjectStore).prototype)||!(r||St.includes(o)))return;const s=async function(f,...m){const d=this.transaction(f,r?"readwrite":"readonly");let w=d.store;return i&&(w=w.index(m.shift())),(await Promise.all([w[o](...m),r&&d.done]))[0]};return le.set(t,s),s}Ne(e=>({...e,get:(t,o,i)=>$e(t,o)||e.get(t,o,i),has:(t,o)=>!!$e(t,o)||e.has(t,o)}));const At=["continue","continuePrimaryKey","advance"],je={},pe=new WeakMap,Ue=new WeakMap,Ht={get(e,t){if(!At.includes(t))return e[t];let o=je[t];return o||(o=je[t]=function(...i){pe.set(this,Ue.get(this)[t](...i))}),o}};async function*zt(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;t=t;const o=new Proxy(t,Ht);for(Ue.set(o,t),J.set(o,me(t));t;)yield o,t=await(pe.get(o)||t.continue()),pe.delete(o)}function Oe(e,t){return t===Symbol.asyncIterator&&de(e,[IDBIndex,IDBObjectStore,IDBCursor])||t==="iterate"&&de(e,[IDBIndex,IDBObjectStore])}Ne(e=>({...e,get(t,o,i){return Oe(t,o)?zt:e.get(t,o,i)},has(t,o){return Oe(t,o)||e.has(t,o)}}));const $t="flatnas-memo-db",F="memos",N="memo_versions",jt=2;function ie(e){let t=5381;for(let o=0;o<e.length;o++)t=t*33^e.charCodeAt(o);return(t>>>0).toString(16)}const A=(e,t)=>{console.error(`[Sentry Report] ${t}:`,e);const o=window.Sentry;o&&o.captureException(e,{tags:{context:t}})};let ce=null;function W(){return ce||(ce=Et($t,jt,{upgrade(e){e.objectStoreNames.contains(F)||e.createObjectStore(F,{keyPath:"id"}),e.objectStoreNames.contains(N)||e.createObjectStore(N,{keyPath:"id"}).createIndex("by-widget","widgetId")}})),ce}const Z=new Map;function Ot(e,t,o){const i=g("idle"),r=g(0),s=async(h=0)=>{i.value="saving",r.value=30;try{const c=await W(),y=t.value,D=ie(y),I={id:e,content:y,mode:o.value,updatedAt:Date.now(),checksum:D};r.value=60,await c.put(F,I);const B=await c.get(F,e);if(!B||B.checksum!==D)throw new Error("Checksum validation failed");Z.set(e,D),r.value=100,i.value="success",setTimeout(()=>{i.value="idle",r.value=0},1200)}catch(c){console.error(`Save failed (attempt ${h+1})`,c),h<3?setTimeout(()=>s(h+1),500*(h+1)):(i.value="error",A(c,"MemoPersistenceSave"))}};return{saveToIndexedDB:s,loadFromIndexedDB:async()=>{try{const c=await(await W()).get(F,e);c&&(ie(c.content)===c.checksum?(t.value=c.content,o.value=c.mode,Z.set(e,c.checksum)):A(new Error("Data corruption detected on load"),"MemoPersistenceLoad"))}catch(h){A(h,"MemoPersistenceLoad")}},saveVersionSnapshot:async(h=!1)=>{try{const c=await W(),y=t.value,D=ie(y),I=Z.get(e);if(!h&&D===I)return;const B=Date.now(),X={id:`${e}-${B}-${Math.random().toString(36).slice(2,8)}`,widgetId:e,content:y,mode:o.value,updatedAt:B,checksum:D};await c.put(N,X),Z.set(e,D)}catch(c){A(c,"MemoPersistenceSnapshot")}},loadVersions:async()=>{try{return(await(await W()).getAllFromIndex(N,"by-widget",e)).sort((y,D)=>D.updatedAt-y.updatedAt)}catch(h){return A(h,"MemoPersistenceHistoryLoad"),[]}},deleteVersion:async h=>{try{await(await W()).delete(N,h)}catch(c){A(c,"MemoPersistenceHistoryDelete")}},status:i,progress:r}}const Rt={key:1,class:"flex items-center justify-end gap-2 mb-2 z-10 -mt-4 -mr-4"},Wt=["aria-expanded"],Ft={class:"truncate max-w-[80px]"},Nt=["onClick"],Ut=["onClick"],Kt=["disabled"],Qt={key:0,class:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Zt={key:1,class:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Yt={class:"flex-1 min-h-0 relative"},Gt=["placeholder","readonly"],Jt=["onClick"],Xt=["onClick"],qt={key:0,class:"absolute top-12 right-4 z-30 bg-gray-800 text-white text-xs px-3 py-1.5 rounded shadow-lg flex items-center gap-2"},en=800,Re=800,tn=5e3,nn=he({__name:"MemoWidget",props:{widget:{}},setup(e){const t=e,o=ct(),{isMobile:i}=ut(dt(o.appConfig,"deviceMode")),r=g("simple"),s=g(""),f=g(null),m=g(!1),d=g(0),w=g(0),h=g(!1),c=g(document.visibilityState==="visible"),{saveToIndexedDB:y,loadFromIndexedDB:D,status:I,progress:B,saveVersionSnapshot:X,loadVersions:Ke,deleteVersion:Qe}=Ot(t.widget.id,s,r),q=g(!1),ge=g(""),_=g(!1),z=g([]),k=g("new"),L=g(0),ee=g(null),$=ae(()=>{const a=[{id:"new",label:"新建备忘",kind:"new"}];return z.value.forEach(n=>{a.push({id:n.id,label:tt(n.content),kind:"history",version:n})}),a}),Ze=ae(()=>k.value==="new"&&z.value.length>0?"版本管理":$.value.find(n=>n.id===k.value)?.label||"新建备忘"),Ye=ae(()=>({backgroundColor:`rgba(254, 249, 195, ${t.widget.opacity??.9})`,color:t.widget.textColor||"#374151"})),Ge=(a,n)=>{f.value?.execCommand(a,n)},Je=async()=>{await X(!0),await y(),await K(),I.value==="success"&&(ge.value="已保存，刷新不丢失",q.value=!0,setTimeout(()=>q.value=!1,3e3)),O(!0)},Xe=()=>{r.value=r.value==="simple"?"rich":"simple";const a=te();d.value=a.updatedAt,O(!0),o.isLogged&&o.socket?.emit("memo:update",{token:o.token||localStorage.getItem("flat-nas-token"),widgetId:t.widget.id,content:a})},qe=a=>{let n="",l=r.value,M=0;if(typeof a=="string")n=a;else if(a&&typeof a=="object"){const b=a;typeof b.content=="string"?n=b.content:typeof b.rich=="string"?n=b.rich:typeof b.simple=="string"&&(n=b.simple),(b.mode==="simple"||b.mode==="rich")&&(l=b.mode),typeof b.updatedAt=="number"&&(M=b.updatedAt)}return{content:n,mode:l,updatedAt:M}},te=()=>({content:s.value,mode:r.value,updatedAt:Date.now()});let E=null,j=null;const O=(a=!1)=>{if(!o.isLogged)return;const n=()=>{const l=te();d.value=l.updatedAt,o.saveWidget(t.widget.id,l)};if(a){n();return}E&&clearTimeout(E),E=setTimeout(()=>{E=null,n()},800)},ye=a=>{const n=qe(a);n.content&&(m.value||n.updatedAt&&n.updatedAt<=d.value||n.content!==s.value&&(s.value=n.content,r.value=n.mode,d.value=n.updatedAt||Date.now()))},et=()=>{!h.value||!o.isLogged||(j&&clearTimeout(j),j=setTimeout(()=>{if(!h.value||!o.isLogged)return;const a=te();o.socket?.emit("memo:update",{token:o.token||localStorage.getItem("flat-nas-token"),widgetId:t.widget.id,content:a})},300))},S=()=>{const a=m.value&&Date.now()-w.value<=en,n=c.value?Re:tn;a?(C&&(clearInterval(C),C=null),h.value=!0):(h.value=!1,C?C&&n!==De&&(clearInterval(C),C=setInterval(Ie,n)):C=setInterval(Ie,n)),De=n},be=()=>{w.value=Date.now(),S(),et()},U=a=>{const n=a.currentTarget;if(!n)return;const l=n.scrollHeight,M=n.clientHeight;if(!(l>M+1)){a.preventDefault(),a.stopPropagation();return}const Be=a.deltaY,_e=n.scrollTop,rt=_e<=0,lt=_e+M>=l-1;(rt&&Be<0||lt&&Be>0)&&a.preventDefault(),a.stopPropagation()},tt=a=>{const n=a.replace(/<[^>]*>/g,"").replace(/\s+/g," ").trim();if(!n)return"空白备忘";const l=10;return n.length>l?`${n.slice(0,l)}…`:n},K=async()=>{z.value=await Ke()},we=async()=>{_.value=!0,await ht();const a=$.value.findIndex(n=>n.id===k.value);L.value=a>=0?a:0},P=()=>{_.value=!1},nt=()=>{_.value?P():we()},ot=async()=>{s.value="",d.value=Date.now(),await y(),O(!0)},at=async a=>{s.value=a.content,r.value=a.mode,d.value=Date.now(),await y(),O(!0)},ne=async(a,n)=>{L.value=n,a.kind==="new"?(k.value="new",await ot()):a.version&&(k.value=a.id,await at(a.version)),P()},xe=async a=>{a.kind==="history"&&a.version&&(await Qe(a.id),await K(),k.value===a.id&&(k.value="new"))},st=a=>{const n=$.value;if(n.length){if(!_.value){(a.key==="Enter"||a.key===" "||a.key==="ArrowDown")&&(a.preventDefault(),we());return}if(a.key==="ArrowDown"){a.preventDefault(),L.value=(L.value+1)%n.length;return}if(a.key==="ArrowUp"){a.preventDefault(),L.value=(L.value-1+n.length)%n.length;return}if(a.key==="Enter"){a.preventDefault();const l=n[L.value];l&&ne(l,L.value);return}a.key==="Escape"&&(a.preventDefault(),P())}},ke=a=>{if(!_.value)return;const n=a.target;n&&ee.value&&!ee.value.contains(n)&&P()};D().then(async()=>{if(!s.value&&t.widget.data){if(typeof t.widget.data=="string")s.value=t.widget.data;else{const a=t.widget.data;s.value=a.rich||a.simple||"",r.value=a.mode||"simple"}d.value=Date.now()}await K()});let Q;Y([s,r],()=>{clearTimeout(Q),Q=setTimeout(()=>{y(),O()},800)}),Y(()=>t.widget.data,a=>{a&&ye(a)}),Y(z,()=>{if(k.value==="new")return;z.value.some(n=>n.id===k.value)||(k.value="new")});let C=null,oe=null,De=Re;const Me=()=>{c.value=document.visibilityState==="visible",S()},Ie=async()=>{if(!o.isLogged||!o.isConnected||m.value)return;const a=t.widget.id;if(a)try{const n=await fetch(`/api/widgets/${a}`,{headers:o.getHeaders()});if(!n.ok)return;const l=await n.json();l?.data&&ye(l.data)}catch{return}};We(()=>{S(),oe=setInterval(S,1e3),document.addEventListener("visibilitychange",Me),document.addEventListener("pointerdown",ke),K()}),vt(()=>{C&&clearInterval(C),oe&&clearInterval(oe),E&&clearTimeout(E),Q&&clearTimeout(Q),j&&clearTimeout(j),document.removeEventListener("visibilitychange",Me),document.removeEventListener("pointerdown",ke)});const Le=()=>{m.value=!0,S()},Ce=()=>{m.value=!1,S()};return(a,n)=>(u(),v("div",{class:R(["w-full h-full rounded-2xl backdrop-blur border border-white/10 relative group flex flex-col transition-colors duration-300 overflow-hidden",r.value==="simple"?"p-0":"p-4"]),style:Se(Ye.value)},[x(B)>0?(u(),v("div",{key:0,class:"absolute top-0 left-0 h-1 bg-[#0052D9] transition-all duration-300 rounded-t-2xl z-20",style:Se({width:`${x(B)}%`,opacity:x(B)===100?0:1})},null,4)):T("",!0),p("div",{class:"absolute top-0 left-0 w-3 h-3 cursor-pointer z-50 overflow-hidden group/curl",onClick:Xe,title:"切换模式 (Switch Mode)"},[...n[3]||(n[3]=[p("div",{class:"absolute top-0 left-0 w-0 h-0 border-t-[12px] border-r-[12px] border-t-white/0 border-r-black/20 transform translate-x-0.5 translate-y-0.5 blur-[1px] transition-all duration-300 group-hover/curl:scale-105"},null,-1),p("div",{class:"absolute top-0 left-0 w-0 h-0 border-t-[12px] border-r-[12px] border-t-white/90 border-r-transparent shadow-sm transition-all duration-300 group-hover/curl:border-t-white group-hover/curl:scale-105"},null,-1)])]),r.value==="rich"?(u(),v("div",Rt,[p("div",{ref_key:"versionWrapperRef",ref:ee,class:"relative",tabindex:"0",onKeydown:st},[p("button",{type:"button",class:"flex items-center justify-between gap-2 px-2 h-7 w-[120px] rounded-md text-xs font-medium text-gray-700 bg-white/40 border border-white/20 hover:bg-white/60 transition-colors","aria-expanded":_.value,onClick:nt},[p("span",Ft,H(Ze.value),1),(u(),v("svg",{class:R(["w-3 h-3 transition-transform duration-200",_.value?"rotate-180":""]),viewBox:"0 0 20 20",fill:"currentColor"},[...n[4]||(n[4]=[p("path",{"fill-rule":"evenodd",d:"M5.23 7.21a.75.75 0 0 1 1.06.02L10 10.94l3.71-3.71a.75.75 0 1 1 1.06 1.06l-4.24 4.24a.75.75 0 0 1-1.06 0L5.21 8.29a.75.75 0 0 1 .02-1.08Z","clip-rule":"evenodd"},null,-1)])],2))],8,Wt),_.value&&!x(i)?(u(),v("div",{key:0,class:"absolute right-0 top-full mt-1 z-40 w-[128px] max-h-[200px] overflow-y-auto no-scrollbar rounded-lg border border-white/20 bg-white/80 backdrop-blur shadow-lg p-1",onWheel:U},[(u(!0),v(G,null,ue($.value,(l,M)=>(u(),v("div",{key:l.id,class:R(["flex items-center gap-1 rounded-md transition-colors",[L.value===M?"bg-[#0052D9]/10 text-[#0052D9]":"text-gray-700 hover:bg-white/60",k.value===l.id?"bg-[#0052D9]/20 text-[#0052D9]":""]])},[p("button",{type:"button",class:"flex-1 text-left px-2 py-2 text-xs truncate",onClick:b=>ne(l,M)},H(l.label),9,Nt),l.kind==="history"?(u(),v("button",{key:0,type:"button",class:"shrink-0 p-1 rounded-md text-gray-400 hover:text-red-500 hover:bg-white/60","aria-label":"删除版本",onClick:se(b=>xe(l),["stop"])},[...n[5]||(n[5]=[p("svg",{class:"w-3 h-3",viewBox:"0 0 20 20",fill:"currentColor"},[p("path",{"fill-rule":"evenodd",d:"M6.28 5.22a.75.75 0 0 1 1.06 0L10 7.94l2.66-2.72a.75.75 0 1 1 1.08 1.04L11.06 9l2.68 2.76a.75.75 0 1 1-1.08 1.04L10 10.06l-2.66 2.72a.75.75 0 1 1-1.08-1.04L8.94 9 6.28 6.26a.75.75 0 0 1 0-1.04Z","clip-rule":"evenodd"})],-1)])],8,Ut)):T("",!0)],2))),128))],32)):T("",!0)],544),r.value==="rich"?(u(),v("button",{key:0,onClick:Je,class:R(["flex items-center justify-center gap-1 px-2 h-7 w-[72px] rounded-md text-xs font-medium text-white transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-[#0052D9] border border-white/10 border-t-0 border-r-0",[x(I)==="success"?"bg-green-500 animate-pulse":"bg-[#0052D9] hover:brightness-110",x(I)==="saving"?"opacity-70 cursor-wait":""]]),disabled:x(I)==="saving",title:"保存 (Save)"},[x(I)==="success"?(u(),v("svg",Qt,[...n[6]||(n[6]=[p("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"},null,-1)])])):(u(),v("svg",Zt,[...n[7]||(n[7]=[p("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"},null,-1)])])),p("span",null,H(x(I)==="success"?"已保存":"保存"),1)],10,Kt)):T("",!0)])):T("",!0),p("div",Yt,[Ee(Ae,{name:"page-tear",mode:"out-in"},{default:Pe(()=>[(u(),v("div",{key:r.value,class:"w-full h-full"},[r.value==="simple"?ft((u(),v("textarea",{key:0,"onUpdate:modelValue":n[0]||(n[0]=l=>s.value=l),class:"w-full h-full bg-transparent resize-none outline-none text-sm placeholder-gray-600 font-medium p-4 pt-4",placeholder:x(o).isLogged?"写点什么...":"请先登录",readonly:!x(o).isLogged,onFocus:Le,onBlur:Ce,onInput:be,onWheel:U},null,40,Gt)),[[mt,s.value]]):(u(),Ve(bt,{key:1,ref_key:"editorRef",ref:f,content:s.value,"onUpdate:content":n[1]||(n[1]=l=>s.value=l),editable:x(o).isLogged,placeholder:x(o).isLogged?"在此输入内容...":"请先登录",onFocus:Le,onBlur:Ce,onInput:be,onWheel:U},null,8,["content","editable","placeholder"]))]))]),_:1})]),r.value==="rich"?(u(),Ve(It,{key:2,onCommand:Ge})):T("",!0),_.value&&x(i)?(u(),v("div",{key:3,class:"fixed inset-0 z-50 bg-black/40 backdrop-blur-sm",onClick:P},[p("div",{class:"absolute inset-0 bg-white/95 text-gray-800 flex flex-col",onClick:n[2]||(n[2]=se(()=>{},["stop"]))},[p("div",{class:"flex items-center justify-between p-4 border-b border-gray-200/60"},[n[8]||(n[8]=p("span",{class:"text-sm font-semibold"},"选择版本",-1)),p("button",{type:"button",class:"text-xs text-gray-500 hover:text-gray-700 px-2 py-1 rounded-md hover:bg-gray-100",onClick:P}," 关闭 ")]),p("div",{class:"flex-1 overflow-y-auto no-scrollbar p-3 space-y-1",onWheel:U},[(u(!0),v(G,null,ue($.value,(l,M)=>(u(),v("div",{key:l.id,class:R(["flex items-center gap-2 rounded-md transition-colors",[L.value===M?"bg-[#0052D9]/10 text-[#0052D9]":"text-gray-700 hover:bg-gray-100",k.value===l.id?"bg-[#0052D9]/20 text-[#0052D9]":""]])},[p("button",{type:"button",class:"flex-1 text-left px-3 py-3 text-sm truncate",onClick:b=>ne(l,M)},H(l.label),9,Jt),l.kind==="history"?(u(),v("button",{key:0,type:"button",class:"shrink-0 mr-2 p-1 rounded-md text-gray-400 hover:text-red-500 hover:bg-gray-100","aria-label":"删除版本",onClick:se(b=>xe(l),["stop"])},[...n[9]||(n[9]=[p("svg",{class:"w-4 h-4",viewBox:"0 0 20 20",fill:"currentColor"},[p("path",{"fill-rule":"evenodd",d:"M6.28 5.22a.75.75 0 0 1 1.06 0L10 7.94l2.66-2.72a.75.75 0 1 1 1.08 1.04L11.06 9l2.68 2.76a.75.75 0 1 1-1.08 1.04L10 10.06l-2.66 2.72a.75.75 0 1 1-1.08-1.04L8.94 9 6.28 6.26a.75.75 0 0 1 0-1.04Z","clip-rule":"evenodd"})],-1)])],8,Xt)):T("",!0)],2))),128))],32)])])):T("",!0),Ee(Ae,{"enter-active-class":"transition ease-out duration-300","enter-from-class":"transform opacity-0 translate-y-2","enter-to-class":"transform opacity-100 translate-y-0","leave-active-class":"transition ease-in duration-200","leave-from-class":"transform opacity-100 translate-y-0","leave-to-class":"transform opacity-0 translate-y-2"},{default:Pe(()=>[q.value?(u(),v("div",qt,[n[10]||(n[10]=p("svg",{class:"w-3 h-3 text-green-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[p("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),pt(" "+H(ge.value),1)])):T("",!0)]),_:1})],6))}}),an=Fe(nn,[["__scopeId","data-v-8a78c57d"]]);export{an as default};
