import{d as Ft,u as qt,r as m,w as te,c as N,D as mt,E as Dt,V as Vt,o as Jt,e as n,b as o,h as l,C as R,g as _,n as P,t as c,f as U,k as we,y as xe,M as De,F as W,i as H,J as Wt,j as ke,K as Ht,O as Gt,P as Kt,_ as Qt}from"./index-0Xhfa8Kb.js";import{_ as Xt}from"./daoliyu-CAYE7_Pg.js";const Yt={key:1,class:"absolute inset-0 bg-white/5 transition-all pointer-events-none"},Zt={key:2,class:"w-full h-full relative z-10"},ea={class:"aplayer-body"},ta={class:"aplayer-pic"},aa=["title"],la={class:"aplayer-info"},sa={class:"aplayer-music-text-wrap"},ia={key:0,class:"ml-8"},ra={class:"aplayer-music-text-wrap"},na={key:0,class:"ml-8"},oa=["title"],ca={class:"aplayer-time-main"},ua={class:"aplayer-controls"},da={class:"aplayer-right"},va=["title"],pa={class:"aplayer-volume"},fa=["value"],ya={class:"aplayer-bar-container"},ma={class:"aplayer-bar"},ha=["max","value","disabled"],ga={class:"aplayer-ptime"},ba={key:3,class:"w-full h-full relative z-10"},wa={class:"aplayer-body"},xa={class:"aplayer-pic"},ka=["title"],_a={class:"aplayer-info"},Ta={class:"aplayer-music-text-wrap"},$a={key:0,class:"ml-8"},Ia={class:"aplayer-music-text-wrap"},Pa={key:0,class:"ml-8"},Ua={class:"aplayer-time-main"},Ca={class:"aplayer-controls"},Aa={class:"aplayer-right"},Ma=["title"],ja={class:"aplayer-volume"},Sa=["value"],Na={class:"aplayer-bar-container"},Ea={class:"aplayer-bar"},Oa=["max","value","disabled"],La={class:"aplayer-ptime"},za={class:"aplayer-list-body"},Ra={key:0,class:"aplayer-list-state"},Ba={key:1,class:"aplayer-list-state is-error"},Fa={key:2,class:"aplayer-list-state"},qa={key:4,class:"flex h-full relative z-10"},Da={class:"flex flex-col min-w-0 transition-all duration-300 w-[39.2%] border-r border-white/10"},Va={class:"border-b border-white/10 bg-white/5 flex flex-col shrink-0"},Ja={class:"p-3 flex gap-1.5 items-center relative"},Wa={class:"w-10 h-10 rounded-lg bg-white/10 flex items-center justify-center overflow-hidden shadow-sm shrink-0"},Ha=["src"],Ga={key:1,src:Xt,class:"w-6 h-6 object-contain opacity-50"},Ka={class:"flex-1 min-w-0 flex flex-col"},Qa={class:"font-bold text-white truncate text-sm leading-tight"},Xa={class:"text-xs text-white/60 truncate leading-tight"},Ya=["title"],Za={class:"px-1 pb-2"},el={class:"flex items-center gap-1 text-[12px] text-white/70"},tl={class:"tabular-nums w-9 text-right"},al=["max","value"],ll={class:"tabular-nums w-9"},sl={class:"px-3 py-1.5 border-b border-white/10 bg-white/5 flex flex-col gap-1.5"},il={class:"flex gap-1 overflow-x-auto custom-scrollbar pb-0.5"},rl=["onClick"],nl=["value"],ol={key:0,class:"p-4 text-center text-xs text-white/40"},cl={key:1,class:"p-4 text-center text-xs text-red-400"},ul={key:2},dl={key:0,class:"grid grid-cols-3 gap-2 p-2"},vl=["onClick"],pl={class:"w-14 h-14 rounded-full overflow-hidden bg-white/10 shadow-sm group-hover:scale-105 transition-transform border border-white/5"},fl=["src"],yl={key:1,class:"w-full h-full flex items-center justify-center text-2xl opacity-50"},ml={class:"text-[10px] text-white/80 text-center truncate w-full"},hl={key:1,class:"grid grid-cols-3 gap-2 p-2"},gl=["onClick"],bl={class:"w-14 h-14 rounded overflow-hidden bg-white/10 shadow-sm group-hover:scale-105 transition-transform border border-white/5"},wl=["src"],xl={key:1,class:"w-full h-full flex items-center justify-center text-2xl opacity-50"},kl={class:"text-[10px] text-white/80 text-center truncate w-full"},_l={key:2},Tl={key:0,class:"sticky top-0 z-10 bg-black/40 backdrop-blur-md border-b border-white/10 px-3 py-2 flex items-center gap-2 mb-1"},$l={class:"flex items-center gap-2 overflow-hidden flex-1"},Il=["src"],Pl={class:"text-xs font-bold text-white truncate"},Ul={key:1,class:"sticky top-0 z-10 bg-black/40 backdrop-blur-md border-b border-white/10 px-3 py-2 flex items-center gap-2 mb-1"},Cl={class:"flex items-center gap-2 overflow-hidden flex-1"},Al=["src"],Ml={class:"text-xs font-bold text-white truncate"},jl=["onClick"],Sl={class:"text-xs text-white/40 w-4 text-center"},Nl={key:0,class:"animate-pulse text-blue-400"},El={key:1},Ol={class:"flex-1 min-w-0"},Ll={class:"text-[10px] text-white/50 truncate"},zl={class:"text-[10px] text-white/40 opacity-0 group-hover/item:opacity-100 transition-opacity"},Rl={key:0,class:"absolute right-0 mt-2 w-40 bg-black/80 backdrop-blur-xl border border-white/10 rounded-xl shadow-2xl py-1 z-40 overflow-hidden"},Bl=["onClick"],Fl={class:"text-sm"},ql={key:0,class:"pt-[40%] pb-[60%]"},Dl={key:1,class:"text-xs text-white/90 whitespace-pre-line leading-7 font-medium tracking-wide"},Vl={key:2,class:"h-full flex flex-col items-center justify-center text-white/40 gap-2"},Jl={key:1,class:"flex-1 flex flex-col items-center justify-center p-4"},Wl={class:"text-white/40 flex flex-col items-center gap-6"},Hl={class:"flex items-end gap-1.5 h-20"},Gl={class:"flex flex-col items-center gap-2 w-full max-w-[80%]"},Kl={key:0,class:"flex flex-col items-center gap-2"},Ql={class:"text-sm font-bold text-white text-center drop-shadow-md"},Xl={key:0,class:"text-[11px] text-white/40 text-center line-clamp-1 italic"},Yl={key:1,class:"flex flex-col items-center gap-1"},Zl={key:2,class:"flex-1 flex flex-col items-center justify-center p-4 overflow-hidden"},es={class:"flex flex-col items-center gap-2 mt-8 w-full max-w-[80%]"},ts={key:0,class:"flex flex-col items-center gap-2"},as={class:"text-sm font-bold text-white text-center drop-shadow-md"},ls={key:0,class:"text-[11px] text-white/40 text-center line-clamp-1 italic"},ss={key:1,class:"flex flex-col items-center gap-1"},is={key:3,class:"flex-1 flex flex-col items-center justify-center p-4"},rs={class:"relative group mt-[-20px] scale-[1.1]"},ns={class:"w-20 h-20 rounded-full overflow-hidden border-4 border-[#111] z-10 shadow-inner"},os=["src"],cs={key:1,class:"w-full h-full bg-zinc-800 flex items-center justify-center text-white/20"},us={class:"flex flex-col items-center gap-2 mt-12 w-full max-w-[80%]"},ds={key:0,class:"flex flex-col items-center gap-2"},vs={class:"text-sm font-bold text-white text-center drop-shadow-md"},ps={key:0,class:"text-[11px] text-white/40 text-center line-clamp-1 italic"},fs={key:1,class:"flex flex-col items-center gap-1"},ys={class:"absolute left-1/2 -translate-x-1/2 bottom-3 z-20 max-w-[calc(100vw-2rem)]"},ms={class:"bg-black/40 backdrop-blur-md rounded-xl px-4 py-2 shadow-lg flex items-center gap-6 w-fit min-w-[280px] max-w-[calc(100vw-2rem)] transition-all opacity-0 group-hover:opacity-100 duration-300"},hs={class:"flex items-center justify-center gap-4 shrink-0"},gs={class:"flex items-center gap-2 shrink-0 border-l border-white/10 pl-6"},bs=["value"],Ve="‚èÆÔ∏é",Je="‚è≠Ô∏é",We="‚ñ∂Ô∏é",He="‚è∏Ô∏é",ht="üîÅÔ∏é",gt="üîÄÔ∏é",bt="üîÇÔ∏é",ws=Ft({__name:"MusicWidget",props:{widget:{}},setup(Ge){const b=Ge,C=qt(),d=m([]),_e=m([]),B=m([]),D=m([]),h=m("songs"),G=m("lyrics"),re=m(!1),Ke=[{id:"lyrics",label:"Ê≠åËØç",icon:"üìù"},{id:"spectrum",label:"È¢ëË∞±ÂàÜÊûê",icon:"üìä"},{id:"abstract",label:"ÊäΩË±°Âä®Áîª",icon:"‚ú®"},{id:"vinyl",label:"Â∞ÅÈù¢‰∏éÈªëËÉ∂",icon:"üíø"}],wt=e=>{G.value=e,re.value=!1},j=m(null),g=m(null),x=m(null),s=m({isPlaying:!1,currentTime:0,duration:0,volume:.7,currentTrackId:null,playbackMode:"sequence"});te(()=>C.activeMusicPlayer,e=>{e!=="music-widget"&&s.value.isPlaying&&(f.value&&f.value.pause(),s.value.isPlaying=!1)});const f=m(null),Qe=m(null),Te=m(!1),ae=m(!1),T=m(""),S=N(()=>b.widget.data?.syncPlayerState===!0),$e=N(()=>(b.widget.colSpan??1)<=1&&(b.widget.rowSpan??1)<=1),ye=N(()=>(b.widget.colSpan??1)<=1&&(b.widget.rowSpan??1)>=2.5),K=m([]),Ie=m(!1),ne=m(""),Xe=m(!1),Q=m(!1),me=m(0),oe=m(null),ce=m(null),Pe=N(()=>ye.value?!0:Xe.value),V=N(()=>{if(se.value)return st(se.value);if(h.value==="artists"&&g.value){const e=B.value.find(t=>t.id===g.value);return C.getAssetUrl(e?.coverUrl)}}),Ye=N(()=>{const e=s.value.duration||0;return e?Math.max(0,Math.min(100,s.value.currentTime/e*100)):0}),Ze=N(()=>{const e=s.value.duration||0;return e?Math.max(0,Math.min(100,me.value/e*100)):0}),v=N(()=>{let e=b.widget.data?.apiUrl||"/api";return e=e.replace(/\/$/,""),/\/api(\/v\d+)?$/.test(e)||(e+="/api"),e}),w=()=>{const e={};return b.widget.data?.token&&(e.Authorization=`Bearer ${b.widget.data.token}`),e},Ue=async()=>{if(!(!b.widget.data?.username||!b.widget.data?.password))try{const e=await fetch(`${v.value}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:b.widget.data.username,password:b.widget.data.password})});if(e.ok){const t=await e.json();if(t.token){const a=C.widgets.find(i=>i.id===b.widget.id);a&&a.data&&(a.data.token=t.token,C.saveData()),xt()}}}catch(e){console.error("Login failed",e)}},xt=async()=>{try{const e=await fetch(`${v.value}/auth/me`,{headers:w()});if(e.ok){const t=await e.json();console.log("User profile:",t)}}catch(e){console.error("Fetch profile failed",e)}},le=async()=>{try{const e=await fetch(`${v.value}/player`,{headers:w()});if(e.ok){const t=await e.json();s.value.isPlaying=t.isPlaying,ie.value||(s.value.currentTime=t.progress||t.currentTime||0),s.value.volume=t.volume??.7,s.value.currentTrackId=t.currentTrack?.id||t.currentTrackId,(t.lyrics||t.currentTrack?.lyrics)&&(s.value.lyrics=t.lyrics||t.currentTrack?.lyrics),t.queue&&Array.isArray(t.queue)&&(d.value=t.queue.map(Y).filter(Boolean));const a=Y(t.currentTrack);a&&!d.value.find(i=>i.id===a.id)&&d.value.push(a),f.value&&(f.value.volume=s.value.volume)}}catch(e){console.error("Fetch player state failed",e)}},et=async()=>{if(d.value.length===0){T.value="ÂàóË°®‰∏∫Á©∫ÔºåÊó†Ê≥ïÊí≠Êîæ";return}const e=d.value.map(t=>t.id);ae.value=!0,T.value="";try{const t=await fetch(`${v.value}/player/queue`,{method:"PUT",headers:{...w(),"Content-Type":"application/json"},body:JSON.stringify({trackIds:e})});t.ok||console.warn("Queue replace failed",t.status),d.value.length>0&&d.value[0]&&await q(d.value[0]),S.value&&le()}catch(t){console.error("Play all failed",t),T.value="Êí≠ÊîæÂÖ®ÈÉ®Â§±Ë¥•: "+(t instanceof Error?t.message:String(t))}finally{ae.value=!1}},kt=async e=>{try{const t={};e&&(t.trackId=e),await fetch(`${v.value}/player/play`,{method:"POST",headers:{...w(),"Content-Type":"application/json"},body:JSON.stringify(t)})}catch(t){console.error(t)}},_t=async()=>{try{await fetch(`${v.value}/player/pause`,{method:"POST",headers:w()})}catch(e){console.error(e)}},tt=async()=>{try{await fetch(`${v.value}/player/next`,{method:"POST",headers:w()}),S.value&&le()}catch(e){console.error(e)}},Tt=async()=>{try{await fetch(`${v.value}/player/prev`,{method:"POST",headers:w()}),S.value&&le()}catch(e){console.error(e)}},$t=async e=>{try{await fetch(`${v.value}/player/volume`,{method:"POST",headers:{...w(),"Content-Type":"application/json"},body:JSON.stringify({volume:e})}),s.value.volume=e}catch(t){console.error(t)}},X=e=>{if(Array.isArray(e))return e;if(e&&typeof e=="object"){const t=e;if(Array.isArray(t.data))return t.data;if(Array.isArray(t.items))return t.items;if(Array.isArray(t.tracks))return t.tracks;if(Array.isArray(t.songs))return t.songs}return[]},Y=e=>{if(!e||typeof e!="object")return null;const t=e,a=t.track&&typeof t.track=="object"?t.track:t,r=(O=>typeof O=="string"?O:typeof O=="number"&&Number.isFinite(O)?String(O):null)(a.id??t.trackId??a.trackId??t.songId??a.songId??t.id),u=typeof a.title=="string"?a.title:typeof a.name=="string"?a.name:typeof a.songName=="string"?a.songName:typeof t.title=="string"?t.title:typeof t.name=="string"?t.name:typeof t.songName=="string"?t.songName:null;if(!r||!u)return null;const p=a.album&&typeof a.album=="object"?a.album:null,$=Array.isArray(a.artists)&&a.artists.length>0?a.artists.map(O=>{if(typeof O=="string")return O;if(O&&typeof O=="object"){const yt=O;if(typeof yt.name=="string")return yt.name}return""}).filter(Boolean).join(", "):typeof a.artist=="string"?a.artist:a.artist&&typeof a.artist=="object"&&typeof a.artist.name=="string"?a.artist.name:typeof a.singer=="string"?a.singer:typeof a.artistName=="string"?a.artistName:typeof t.artistName=="string"?t.artistName:typeof t.singer=="string"?t.singer:void 0,M=a.album&&typeof a.album=="object"&&typeof a.album.title=="string"?a.album.title:typeof a.album=="string"?a.album:typeof a.albumName=="string"?a.albumName:typeof a.albumTitle=="string"?a.albumTitle:typeof t.albumTitle=="string"?t.albumTitle:typeof t.albumName=="string"?t.albumName:void 0,E=typeof a.duration=="number"?a.duration:typeof t.duration=="number"?t.duration:typeof a.length=="number"?a.length:typeof t.length=="number"?t.length:void 0,y=a.cover&&typeof a.cover=="object"?a.cover:t.cover&&typeof t.cover=="object"?t.cover:null,z=typeof a.coverArtUrl=="string"?a.coverArtUrl:typeof a.coverUrl=="string"?a.coverUrl:p&&typeof p.coverArtUrl=="string"?p.coverArtUrl:p&&typeof p.coverUrl=="string"?p.coverUrl:y&&typeof y.url=="string"?y.url:y&&typeof y.src=="string"?y.src:y&&typeof y.path=="string"?y.path:y&&typeof y.imageUrl=="string"?y.imageUrl:typeof a.imageUrl=="string"?a.imageUrl:typeof a.coverArtPath=="string"?a.coverArtPath:p&&typeof p.coverArtPath=="string"?p.coverArtPath:typeof t.coverArtUrl=="string"?t.coverArtUrl:typeof t.coverUrl=="string"?t.coverUrl:typeof t.imageUrl=="string"?t.imageUrl:void 0,ee=typeof a.coverId=="string"?a.coverId:typeof t.coverId=="string"?t.coverId:void 0,Bt=typeof a.lyrics=="string"?a.lyrics:typeof t.lyrics=="string"?t.lyrics:void 0;return{id:r,title:u,artist:$,album:M,duration:E,coverUrl:z,coverId:ee,lyrics:Bt}},L=async(e,t)=>{const a=await fetch(e,{...t,headers:{...w()}});return a.status!==401?a:(await Ue(),fetch(e,{...t,headers:{...w()}}))},Ce=async()=>{Ie.value=!0,ne.value="";try{let e=await L(`${v.value}/songs?take=1000`);if(e.ok||(e=await L(`${v.value}/tracks?take=1000`)),!e.ok)throw new Error(await e.text());const t=await e.json(),i=X(t).map(Y).filter(Boolean);K.value=i}catch(e){K.value=[],ne.value=e.message||"Âä†ËΩΩÂ§±Ë¥•"}finally{Ie.value=!1}},It=(e,t)=>{if(!e.length)return;d.value=e;const a=e[0];a&&q(a)},at=async()=>{ne.value="",K.value.length===0&&await Ce();const e=K.value;e.length&&(It(e),Xe.value=!1)},lt=async()=>{try{let e=await L(`${v.value}/playlists?take=1000`);if(e.ok||(e=await L(`${v.value}/music/playlists?take=1000`)),e.ok){const t=await e.json(),a=X(t);_e.value=a.map(i=>{const r=i;return{id:r.id,name:r.name||r.title||"Êú™ÂëΩÂêçÊ≠åÂçï",coverUrl:he(r.coverUrl||r.cover)}})}}catch(e){console.error("Fetch playlists failed",e)}},Pt=async()=>{try{const e=await L(`${v.value}/library/artists?take=1000`);if(e.ok){const t=await e.json(),a=X(t);B.value=a.map(i=>{const r=i;return{id:r.id,name:r.name||r.artist||"Unknown Artist",coverUrl:he(r.coverUrl||r.cover)}})}}catch(e){console.error("Fetch artists failed",e)}},Ut=async()=>{try{const e=await L(`${v.value}/library/albums?take=1000`);if(e.ok){const t=await e.json(),a=X(t);D.value=a.map(i=>{const r=i;return{id:r.id,title:r.title||r.name||"Unknown Album",artist:r.artist,coverUrl:he(r.coverUrl||r.cover)}})}}catch(e){console.error("Fetch albums failed",e)}},J=async()=>{!b.widget.data?.token&&b.widget.data?.username&&b.widget.data?.password&&await Ue(),ae.value=!0,T.value="";try{let e=`${v.value}/songs?take=1000`;h.value==="playlists"&&j.value?e=`${v.value}/playlists/${j.value}/tracks?take=1000`:h.value==="artists"&&g.value?e=`${v.value}/library/artists/${g.value}/songs?take=1000`:h.value==="albums"&&x.value&&(e=`${v.value}/library/albums/${x.value}`);let t=await fetch(e,{headers:w()});if(!t.ok)if(h.value==="playlists"&&j.value)e=`${v.value}/playlists/${j.value}/songs?take=1000`,t=await fetch(e,{headers:w()});else if(h.value==="artists"&&g.value){if(e=`${v.value}/library/artists/${g.value}/tracks?take=1000`,t=await fetch(e,{headers:w()}),!t.ok){const u=B.value.find(p=>p.id===g.value);u&&u.name&&(e=`${v.value}/tracks?search=${encodeURIComponent(u.name)}&take=1000`,t=await fetch(e,{headers:w()}))}}else if(h.value==="albums"&&x.value){const u=D.value.find(p=>p.id===x.value);u&&u.title&&(e=`${v.value}/tracks?search=${encodeURIComponent(u.title)}&take=1000`,t=await fetch(e,{headers:w()}))}else e.includes("/songs")&&(e=e.replace("/songs","/tracks"),t=await fetch(e,{headers:w()}));t.status===401&&(await Ue(),t=await fetch(e,{headers:w()}));const i=(v.value==="/api"||v.value==="/api/")&&!j.value&&h.value==="songs";if(!t.ok&&!i)throw new Error(`API Error: ${t.status}`);const r=t.ok?X(await t.json()):[];if(r.length===0&&h.value==="albums"&&x.value){const u=D.value.find(p=>p.id===x.value);if(u&&u.title){const p=`${v.value}/tracks?search=${encodeURIComponent(u.title)}&take=1000`,$=await L(p);if($.ok){const M=await $.json(),E=X(M);if(E.length>0){d.value=E.map(Y).filter(Boolean),ae.value=!1;return}}}}if(d.value=r.map(Y).filter(Boolean),d.value.length===0&&!j.value){let u=await fetch(`${v.value}/songs?take=100`,{headers:w()});if(u.ok||(u=await fetch(`${v.value}/tracks?take=100`,{headers:w()})),u.ok){const p=await u.json(),$=X(p);d.value=$.map(Y).filter(Boolean)}}if(d.value.length===0&&i)try{const u=await fetch(`${v.value}/music-list`,{headers:w()});if(u.ok){const p=await u.json();Array.isArray(p)&&(d.value=p.map($=>({id:$,title:$.split("/").pop()||$,artist:"Unknown Artist",album:"Unknown Album",duration:0,coverUrl:void 0})))}}catch(u){console.error("FlatNas music-list fallback failed",u)}d.value.length===0&&(T.value="ÊöÇÊó†Ê≠åÊõ≤ÔºåËØ∑Ê£ÄÊü• API ÈÖçÁΩÆÊàñÊî∂Ëóè")}catch(e){console.error("Fetch tracks failed",e),T.value=`Âä†ËΩΩÂ§±Ë¥•: ${e.message}`,d.value=[]}finally{ae.value=!1}},Ct=e=>{h.value=e,j.value=null,g.value=null,x.value=null,e==="playlists"&&_e.value.length===0&&lt(),e==="artists"&&B.value.length===0&&Pt(),e==="albums"&&D.value.length===0&&Ut(),e==="songs"?J():d.value=[]},At=e=>({songs:"Ê≠åÊõ≤",playlists:"Ê≠åÂçï",artists:"Ëâ∫‰∫∫",albums:"‰∏ìËæë"})[e]||e,Mt=e=>{g.value=e,J()},jt=e=>{x.value=e,J()},ue=()=>{oe.value&&(ce.value?Gt(`music:${ce.value}`):URL.revokeObjectURL(oe.value),oe.value=null,ce.value=null)},St=async(e,t=0,a=!0)=>{if(!f.value)return;const i=[`${v.value}/tracks/${encodeURIComponent(e)}/stream`,`${v.value}/songs/${encodeURIComponent(e)}/stream`];let r=null,u=null;for(const M of i){try{r=await L(M)}catch(ee){throw new Error(`ËøûÊé•Â§±Ë¥•: ${ee.message}`)}if(r.ok){u=null;break}const E=await r.text();let y=E;try{const ee=JSON.parse(E);typeof ee.error=="string"?y=ee.error:y=JSON.stringify(ee)}catch{}if(u={status:r.status,detail:y},!(r.status===404||y.includes("TRACK_NOT_FOUND")||y.toLowerCase().includes("not found")))break}if(!r||!r.ok)throw u?new Error(`Stream API Error ${u.status}: ${u.detail}`):new Error("Stream API Error: ËØ∑Ê±ÇÂ§±Ë¥•");const p=r.headers.get("content-type")||"";p&&!p.startsWith("audio/")&&!p.startsWith("application/octet-stream")&&!p.startsWith("video/")&&console.warn(`Unexpected content-type: ${p}`);const $=await r.blob();if(ue(),oe.value=Kt(`music:${e}`,$),ce.value=e,f.value.src=oe.value,f.value.currentTime=t,a)try{await f.value.play(),T.value=""}catch(M){throw s.value.isPlaying=!1,new Error(`Playback failed: ${M.name} - ${M.message}`)}},de=m({}),Nt=async e=>{if(!de.value[e])try{let t=await L(`${v.value}/tracks/${encodeURIComponent(e)}`);if(t.ok||(t=await L(`${v.value}/songs/${encodeURIComponent(e)}`)),!t.ok)return;const a=await t.json(),i=Y(a);if(!i)return;de.value={...de.value,[e]:i}}catch{}};te(()=>s.value.currentTrackId,e=>{e&&Nt(e)},{immediate:!0});const he=e=>{if(!e)return;const t=b.widget.data?.token;if(e.startsWith("http")){const r=`${v.value}/proxy-image?url=${encodeURIComponent(e)}`;return t?`${r}&token=${t}`:r}const a=v.value.replace(/\/api(\/v\d+)?$/,""),i=e.startsWith("/")?`${a}${e}`:`${a}/${e}`;return t?`${i}${i.includes("?")?"&":"?"}token=${t}`:i},st=e=>{const t=b.widget.data?.token,i=de.value[e.id]?.coverUrl||e.coverUrl;if(!i&&e.id){const r=`${v.value}/subsonic/rest/getCoverArt?id=track:${e.id}`,u=t?`${r}&token=${t}`:r;return C.getAssetUrl(u)}return C.getAssetUrl(he(i))},A=N(()=>d.value.find(e=>e.id===s.value.currentTrackId)),se=N(()=>{const e=A.value;return e?de.value[e.id]??e:null});te(()=>se.value,e=>{e&&e.lyrics!==void 0&&(s.value.lyrics=e.lyrics)},{immediate:!0});const F=N(()=>{const e=se.value;if(!e)return h.value==="artists"&&g.value&&B.value.find(r=>r.id===g.value)?.name||"";let t=e.artist||"";Array.isArray(t)&&(t=t.map(i=>{if(typeof i=="string")return i;if(i&&typeof i=="object"){const r=i;if(typeof r.name=="string")return r.name}return""}).filter(Boolean).join(", ")),t=t.trim();const a=(e.album||"").trim();return t&&a?`${t} ¬∑ ${a}`:t||a||""}),Ae=m(null),it=m(null),I=N(()=>{if(!s.value.lyrics)return[];const e=s.value.lyrics.split(`
`),t=[],a=/\[(\d+):(\d+)(?:[:.](\d+))?\]/g;return e.forEach(i=>{const r=i.replace(/\[(\d+):(\d+)(?:[:.](\d+))?\]/g,"").trim();if(!r)return;let u;for(a.lastIndex=0;(u=a.exec(i))!==null;){const p=parseInt(u[1]??"0",10),$=parseInt(u[2]??"0",10),M=u[3]?parseInt(u[3],10):0,E=p*60+$+(M>99?M/1e3:M/100);t.push({time:E,text:r})}}),t.sort((i,r)=>i.time-r.time)}),k=N(()=>{const e=s.value.currentTime,t=I.value;if(t.length===0)return-1;for(let a=t.length-1;a>=0;a--){const i=t[a];if(i&&e>=i.time)return a}return 0});te(k,async()=>{if(!Ae.value)return;await mt();const e=Ae.value,t=it.value;if(!t)return;const a=e.offsetHeight/2-60,i=t.offsetTop-a+t.offsetHeight/2;e.scrollTo({top:Math.max(0,i),behavior:ie.value?"auto":"smooth"})},{immediate:!0});const rt=new Set,Et=async e=>{if(rt.has(e.id))return;rt.add(e.id),f.value&&f.value.pause(),ue();const t=d.value.findIndex(a=>a.id===e.id);if(t!==-1&&d.value.splice(t,1),s.value.currentTrackId=null,s.value.isPlaying=!1,d.value.length>0){const a=d.value[Math.min(t,d.value.length-1)]||d.value[0];a&&await q(a);return}await J()};let Z=0,Me=null;const nt=e=>{Me&&clearTimeout(Me),Me=setTimeout(()=>{e()},120)},q=async(e,t={})=>{const{startTime:a=0,autoPlay:i=!0}=t;if(s.value.currentTrackId===e.id&&!a){ge();return}if(s.value.currentTrackId=e.id,s.value.isPlaying=i,C.activeMusicPlayer="music-widget",f.value){const r=f.value,u=++Z;r.pause(),r.src&&r.src.startsWith("blob:")&&URL.revokeObjectURL(r.src),ue(),ue();let p="";const $=y=>y.split("/").map(z=>encodeURIComponent(z)).join("/"),M=v.value==="/api"||v.value==="/api/",E=/\.[a-zA-Z0-9]{2,4}$/.test(e.id);if(M&&E)p=`/music/${$(e.id)}`;else{const y=b.widget.data?.token;p=`${v.value}/tracks/${encodeURIComponent(e.id)}/stream`,y&&(p+=p.includes("?")?`&token=${y}`:`?token=${y}`)}if(r.src=p,r.currentTime=a,await mt(),u!==Z)return;if(i)try{const y=r.play();if(y!==void 0&&await y,u!==Z)return}catch(y){if(u!==Z)return;const z=y?.message||"";if(z.includes("interrupted by a new load request")||z.includes("play() request was interrupted"))return;console.error("Play failed",y),(z.includes("NotAllowedError")||z.toLowerCase().includes("playback failed"))&&(s.value.isPlaying=!1),T.value=`Êí≠ÊîæÂá∫Èîô: ${z}`}}},Ot=async()=>(K.value.length===0&&await Ce(),K.value.length===0?!1:(await at(),!0)),ge=async()=>{if(f.value){if(!s.value.currentTrackId){const e=d.value[0];if(e){q(e);return}(async()=>await Ot()||await J())();return}if(s.value.isPlaying)f.value.pause(),s.value.isPlaying=!1,Z++;else try{const e=++Z,t=f.value.play();if(t!==void 0&&await t,e!==Z)return;s.value.isPlaying=!0,C.activeMusicPlayer="music-widget"}catch(e){const t=e?.message||"";if(t.includes("interrupted by a new load request")||t.includes("play() request was interrupted"))return}}},je=()=>{const e=["sequence","random","single"],t=(e.indexOf(s.value.playbackMode)+1)%e.length;s.value.playbackMode=e[t]},ve=(e=!1)=>{if(!d.value.length)return;if(!e){nt(()=>{ve(!0)});return}if(e&&s.value.playbackMode==="single"){f.value&&(f.value.currentTime=0,f.value.play().catch(()=>{}));return}if(s.value.playbackMode==="random"){const r=Math.floor(Math.random()*d.value.length),u=d.value[r];u&&q(u),S.value&&tt();return}const a=(d.value.findIndex(r=>r.id===s.value.currentTrackId)+1)%d.value.length,i=d.value[a];i&&q(i),S.value&&tt()},Se=()=>{d.value.length&&nt(()=>{const t=(d.value.findIndex(i=>i.id===s.value.currentTrackId)-1+d.value.length)%d.value.length,a=d.value[t];a&&q(a),S.value&&Tt()})},Ne=()=>`flatnas_music_player_state_${b.widget.id}`,Lt=Vt(()=>{const e={libraryMode:h.value,currentPlaylistId:j.value,currentArtistId:g.value,currentAlbumId:x.value,playerState:{volume:s.value.volume,playbackMode:s.value.playbackMode,currentTrackId:s.value.currentTrackId,currentTime:s.value.currentTime,isPlaying:s.value.isPlaying}};localStorage.setItem(Ne(),JSON.stringify(e))},1e3),zt=()=>{const e={libraryMode:h.value,currentPlaylistId:j.value,currentArtistId:g.value,currentAlbumId:x.value,playerState:{volume:s.value.volume,playbackMode:s.value.playbackMode,currentTrackId:s.value.currentTrackId,currentTime:s.value.currentTime,isPlaying:s.value.isPlaying}};localStorage.setItem(Ne(),JSON.stringify(e))},Rt=async()=>{const e=localStorage.getItem(Ne());if(!e)return!1;try{const t=JSON.parse(e);if(h.value=t.libraryMode||"songs",j.value=t.currentPlaylistId||null,g.value=t.currentArtistId||null,x.value=t.currentAlbumId||null,t.playerState&&(s.value.volume=t.playerState.volume??.7,s.value.playbackMode=t.playerState.playbackMode||"sequence",t.playerState.currentTrackId)){await J();const a=d.value.find(i=>i.id===t.playerState.currentTrackId);if(a)return await q(a,{startTime:t.playerState.currentTime||0,autoPlay:t.playerState.isPlaying}),s.value.currentTime=t.playerState.currentTime||0,!0}}catch(t){console.error("Failed to restore playback state",t)}return!1},ie=m(!1),ot=m(0),Ee=()=>{f.value&&(ie.value||(s.value.currentTime=f.value.currentTime),s.value.duration=f.value.duration||0,dt())},Oe=()=>{ve(!0)},Le=e=>{const t=e.target;s.value.volume=parseFloat(t.value),f.value&&(f.value.volume=s.value.volume),S.value&&$t(s.value.volume)},ze=()=>{S.value&&kt(s.value.currentTrackId||void 0)},Re=()=>{S.value&&_t()},Be=()=>{const e=s.value.currentTrackId;if(e&&ce.value!==e){St(e).catch(t=>{if((t.message||"").includes("TRACK_NOT_FOUND")){const i=d.value.find(r=>r.id===e);i&&Et(i),T.value="Ê≠åÊõ≤‰∏çÂ≠òÂú®ÔºåÂ∑≤Ë∑≥Ëøá";return}T.value="Èü≥È¢ëÊ∫ê‰∏çÊîØÊåÅÊàñÊó†ÊùÉÈôê"});return}T.value="Èü≥È¢ëÊ∫ê‰∏çÊîØÊåÅÊàñÊó†ÊùÉÈôê"},Fe=e=>{const t=e.target,a=parseFloat(t.value);isNaN(a)||(ie.value=!0,ot.value=a,s.value.currentTime=a)},be=e=>{const t=e?parseFloat(e.target.value):NaN,a=isNaN(t)?ot.value:t;f.value&&!isNaN(a)&&(f.value.currentTime=a,s.value.currentTime=a),ie.value=!1},ct=()=>{ie.value&&be()},ut=()=>{Q.value=!1},dt=()=>{const e=f.value;if(!e||!e.duration||e.duration<=0||!e.buffered||e.buffered.length===0){me.value=0;return}try{me.value=e.buffered.end(e.buffered.length-1)}catch{me.value=0}},qe=()=>{dt()},vt=e=>{const t=e.currentTarget,a=s.value.duration||0;if(!t||!a)return;const i=t.getBoundingClientRect();if(!i.width)return;const r=(e.clientX-i.left)/i.width,u=Math.max(0,Math.min(a,r*a));f.value&&(f.value.currentTime=u),s.value.currentTime=u},pe=e=>{if(!e||isNaN(e)||!isFinite(e))return"0:00";const t=Math.floor(e/60),a=Math.floor(e%60);return`${t}:${a.toString().padStart(2,"0")}`};let fe=null;const pt=()=>{fe==null&&(fe=window.setInterval(le,3e3))},ft=()=>{fe!=null&&(window.clearInterval(fe),fe=null)};return Dt(()=>{const e=document.getElementById("flatnas-global-audio");e?(Te.value=!0,f.value=e,e.addEventListener("timeupdate",Ee),e.addEventListener("ended",Oe),e.addEventListener("play",ze),e.addEventListener("pause",Re),e.addEventListener("progress",qe),e.addEventListener("error",Be),e.paused||(s.value.isPlaying=!0,s.value.currentTime=e.currentTime,C.activeMusicPlayer="music-widget")):f.value=Qe.value,J(),lt(),S.value&&(le(),pt()),($e.value||ye.value)&&(Ce(),!S.value&&C.appConfig.autoPlayMusic&&at());const t=Te.value&&f.value&&!f.value.paused;!S.value&&!t&&Rt().then(a=>{a||!$e.value&&ye.value}),window.addEventListener("click",ut),window.addEventListener("pointerup",ct)}),te(()=>s.value.currentTime,()=>{Lt()}),te([()=>s.value.currentTrackId,()=>s.value.volume,()=>s.value.playbackMode,()=>s.value.isPlaying,h,j,g,x],()=>{zt()}),Jt(()=>{if(ft(),Te.value){const e=f.value;e&&(e.removeEventListener("timeupdate",Ee),e.removeEventListener("ended",Oe),e.removeEventListener("play",ze),e.removeEventListener("pause",Re),e.removeEventListener("progress",qe),e.removeEventListener("error",Be))}else ue();window.removeEventListener("click",ut),window.removeEventListener("pointerup",ct)}),te(S,e=>{e?(le(),pt()):ft()}),(e,t)=>(o(),n("div",{class:"w-full h-full backdrop-blur-md border border-white/20 rounded-2xl flex flex-col overflow-hidden shadow-lg hover:shadow-xl transition-all group relative",style:R({backgroundColor:`rgba(255, 255, 255, ${(Ge.widget.opacity??.1)*.4})`})},[V.value?(o(),n("div",{key:0,class:"absolute inset-0 bg-cover bg-center transition-all duration-700 blur-md opacity-80 pointer-events-none",style:R({backgroundImage:`url('${V.value}')`})},null,4)):(o(),n("div",Yt)),l("audio",{ref_key:"localAudioRef",ref:Qe,onTimeupdate:Ee,onEnded:Oe,onPlay:ze,onPause:Re,onProgress:qe,onError:Be,crossorigin:"anonymous"},null,544),$e.value?(o(),n("div",Zt,[l("div",{class:P(["aplayer aplayer-mini",{"aplayer-withlist":Pe.value}])},[l("div",ea,[l("div",ta,[l("button",{class:"aplayer-pic-btn",onClick:_(ge,["stop"]),title:s.value.isPlaying?"ÊöÇÂÅú":"Êí≠Êîæ",style:R(V.value?{backgroundImage:`url('${V.value}')`}:void 0)},[l("span",{class:P(["aplayer-pic-icon",{"is-playing":s.value.isPlaying}])},c(s.value.isPlaying?He:We),3)],12,aa)]),l("div",la,[l("div",sa,[l("span",{class:P(["aplayer-title",{"aplayer-marquee":(A.value?.title||"").length>15}])},[we(c(A.value?.title||"ÈÄâÊã©Êí≠Êîæ")+" ",1),(A.value?.title||"").length>15?(o(),n("span",ia,c(A.value?.title),1)):U("",!0)],2)]),l("div",ra,[l("span",{class:P(["aplayer-author",{"aplayer-marquee":F.value.length>20}])},[we(c(F.value)+" ",1),F.value.length>20?(o(),n("span",na,c(F.value),1)):U("",!0)],2)]),T.value?(o(),n("div",{key:0,class:"text-xs text-red-400 mt-0.5 truncate",title:T.value},c(T.value),9,oa)):U("",!0),l("div",ca,[l("div",ua,[l("button",{class:"aplayer-btn",onClick:_(Se,["stop"]),title:"‰∏ä‰∏ÄÈ¶ñ"},c(Ve)),l("button",{class:"aplayer-btn",onClick:t[0]||(t[0]=_(a=>ve(),["stop"])),title:"‰∏ã‰∏ÄÈ¶ñ"},c(Je))]),l("div",da,[l("button",{class:"aplayer-btn",onClick:_(je,["stop"]),title:s.value.playbackMode==="random"?"ÈöèÊú∫Êí≠Êîæ":s.value.playbackMode==="single"?"ÂçïÊõ≤Âæ™ÁéØ":"È°∫Â∫èÊí≠Êîæ"},c(s.value.playbackMode==="random"?gt:s.value.playbackMode==="single"?bt:ht),9,va),l("div",pa,[l("button",{class:"aplayer-btn",onClick:t[1]||(t[1]=_(a=>Q.value=!Q.value,["stop"])),title:"Èü≥Èáè"},[...t[14]||(t[14]=[l("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"w-5 h-5"},[l("path",{d:"M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"})],-1)])]),xe(l("div",{class:"aplayer-volume-panel",onClick:t[2]||(t[2]=_(()=>{},["stop"]))},[l("input",{type:"range",min:"0",max:"1",step:"0.05",value:s.value.volume,onInput:Le,class:"aplayer-volume-slider"},null,40,fa)],512),[[De,Q.value]])])])]),l("div",ya,[l("div",{class:"aplayer-bar-wrap",onClick:_(vt,["stop"])},[l("div",ma,[l("div",{class:"aplayer-loaded",style:R({width:`${Ze.value}%`})},null,4),l("div",{class:"aplayer-played",style:R({width:`${Ye.value}%`})},[...t[15]||(t[15]=[l("span",{class:"aplayer-thumb"},null,-1)])],4),l("input",{class:"aplayer-seek",type:"range",min:0,max:s.value.duration||0,value:s.value.currentTime,disabled:!s.value.duration,step:"0.1",onInput:Fe,onChange:be},null,40,ha)])]),l("span",ga,c(pe(s.value.currentTime)),1)])])])],2)])):ye.value?(o(),n("div",ba,[l("div",{class:P(["aplayer aplayer-mini is-tall",{"aplayer-withlist":Pe.value}])},[l("div",wa,[l("div",xa,[l("button",{class:"aplayer-pic-btn",onClick:_(ge,["stop"]),title:s.value.isPlaying?"ÊöÇÂÅú":"Êí≠Êîæ",style:R(V.value?{backgroundImage:`url('${V.value}')`}:void 0)},[l("span",{class:P(["aplayer-pic-icon",{"is-playing":s.value.isPlaying}])},c(s.value.isPlaying?He:We),3)],12,ka)]),l("div",_a,[l("div",Ta,[l("span",{class:P(["aplayer-title",{"aplayer-marquee":(A.value?.title||"").length>15}])},[we(c(A.value?.title||"ÈÄâÊã©Êí≠Êîæ")+" ",1),(A.value?.title||"").length>15?(o(),n("span",$a,c(A.value?.title),1)):U("",!0)],2)]),l("div",Ia,[l("span",{class:P(["aplayer-author",{"aplayer-marquee":F.value.length>20}])},[we(c(F.value)+" ",1),F.value.length>20?(o(),n("span",Pa,c(F.value),1)):U("",!0)],2)]),l("div",Ua,[l("div",Ca,[l("button",{class:"aplayer-btn",onClick:_(Se,["stop"]),title:"‰∏ä‰∏ÄÈ¶ñ"},c(Ve)),l("button",{class:"aplayer-btn",onClick:t[3]||(t[3]=_(a=>ve(),["stop"])),title:"‰∏ã‰∏ÄÈ¶ñ"},c(Je))]),l("div",Aa,[l("button",{class:"aplayer-btn",onClick:_(je,["stop"]),title:s.value.playbackMode==="random"?"ÈöèÊú∫Êí≠Êîæ":s.value.playbackMode==="single"?"ÂçïÊõ≤Âæ™ÁéØ":"È°∫Â∫èÊí≠Êîæ"},c(s.value.playbackMode==="random"?gt:s.value.playbackMode==="single"?bt:ht),9,Ma),l("div",ja,[l("button",{class:"aplayer-btn",onClick:t[4]||(t[4]=_(a=>Q.value=!Q.value,["stop"])),title:"Èü≥Èáè"},[...t[16]||(t[16]=[l("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"w-5 h-5"},[l("path",{d:"M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"})],-1)])]),xe(l("div",{class:"aplayer-volume-panel",onClick:t[5]||(t[5]=_(()=>{},["stop"]))},[l("input",{type:"range",min:"0",max:"1",step:"0.05",value:s.value.volume,onInput:Le,class:"aplayer-volume-slider"},null,40,Sa)],512),[[De,Q.value]])])])]),l("div",Na,[l("div",{class:"aplayer-bar-wrap",onClick:_(vt,["stop"])},[l("div",Ea,[l("div",{class:"aplayer-loaded",style:R({width:`${Ze.value}%`})},null,4),l("div",{class:"aplayer-played",style:R({width:`${Ye.value}%`})},[...t[17]||(t[17]=[l("span",{class:"aplayer-thumb"},null,-1)])],4),l("input",{class:"aplayer-seek",type:"range",min:0,max:s.value.duration||0,value:s.value.currentTime,disabled:!s.value.duration,step:"0.1",onInput:Fe,onChange:be},null,40,Oa)])]),l("span",La,c(pe(s.value.currentTime)),1)])])]),xe(l("div",{class:"aplayer-list",onClick:t[6]||(t[6]=_(()=>{},["stop"]))},[l("div",za,[Ie.value?(o(),n("div",Ra,"Âä†ËΩΩ‰∏≠...")):ne.value?(o(),n("div",Ba,c(ne.value),1)):(o(),n("div",Fa," Â∑≤Âä†ËΩΩÂÖ®ÈÉ®Ê≠åÊõ≤Ôºà"+c(K.value.length)+"Ôºâ ",1))])],512),[[De,Pe.value]])],2)])):(o(),n("div",qa,[l("div",Da,[l("div",Va,[l("div",Ja,[l("div",Wa,[V.value?(o(),n("img",{key:0,src:V.value,class:"w-full h-full object-cover"},null,8,Ha)):(o(),n("img",Ga))]),l("div",Ka,[l("div",Qa,c(A.value?.title||"ÈÅìÁêÜÈ±ºÈü≥‰πê"),1),l("div",Xa,c(F.value||(A.value?"":"Êú™Êí≠Êîæ")),1)]),l("button",{onClick:je,class:"absolute bottom-1 right-2 flex items-center justify-center text-[12px] scale-[1.8] transition-all duration-200 ease-out text-white/50 hover:text-white/90",title:s.value.playbackMode==="random"?"ÈöèÊú∫Êí≠Êîæ":s.value.playbackMode==="single"?"Âæ™ÁéØÊí≠Êîæ":"È°∫Â∫èÊí≠Êîæ"},c(s.value.playbackMode==="random"?"‚•Æ":s.value.playbackMode==="single"?"‚ü≥":"‚áâ"),9,Ya)]),l("div",Za,[l("div",el,[l("span",tl,c(pe(s.value.currentTime)),1),l("input",{type:"range",max:s.value.duration||100,value:s.value.currentTime,onInput:Fe,onChange:be,class:"flex-1 h-1 bg-white/20 rounded-lg appearance-none cursor-pointer accent-blue-400 min-w-0"},null,40,al),l("span",ll,c(pe(s.value.duration)),1)])])]),l("div",sl,[l("div",il,[(o(),n(W,null,H(["songs","artists","albums"],a=>l("button",{key:a,onClick:i=>Ct(a),class:P(["px-2 py-0.5 text-[10px] rounded whitespace-nowrap transition-colors",h.value===a?"bg-blue-500 text-white shadow-sm":"bg-white/10 text-white/60 hover:bg-white/20"])},c(At(a)),11,rl)),64))]),h.value==="playlists"?xe((o(),n("select",{key:0,"onUpdate:modelValue":t[7]||(t[7]=a=>j.value=a),onChange:J,class:"w-full bg-black/20 text-white/90 text-xs rounded px-2 py-1 outline-none border border-white/10 focus:border-blue-500/50 hover:bg-black/30 transition-colors"},[t[18]||(t[18]=l("option",{value:null,class:"text-black"},"ËØ∑ÈÄâÊã©Ê≠åÂçï...",-1)),(o(!0),n(W,null,H(_e.value,a=>(o(),n("option",{key:a.id,value:a.id,class:"text-black"},c(a.name),9,nl))),128))],544)),[[Wt,j.value]]):U("",!0)]),l("div",{class:"flex-1 overflow-y-auto overflow-x-hidden custom-scrollbar",onWheel:t[10]||(t[10]=_(()=>{},["stop"]))},[ae.value?(o(),n("div",ol," Âä†ËΩΩ‰∏≠... ")):T.value?(o(),n("div",cl,c(T.value),1)):(o(),n("div",ul,[h.value==="artists"&&!g.value?(o(),n("div",dl,[(o(!0),n(W,null,H(B.value,a=>(o(),n("div",{key:a.id,onClick:i=>Mt(a.id),class:"flex flex-col items-center gap-1 cursor-pointer group hover:bg-white/5 p-2 rounded-lg transition-colors"},[l("div",pl,[a.coverUrl?(o(),n("img",{key:0,src:ke(C).getAssetUrl(a.coverUrl),class:"w-full h-full object-cover"},null,8,fl)):(o(),n("div",yl," üë§ "))]),l("span",ml,c(a.name),1)],8,vl))),128))])):h.value==="albums"&&!x.value?(o(),n("div",hl,[(o(!0),n(W,null,H(D.value,a=>(o(),n("div",{key:a.id,onClick:i=>jt(a.id),class:"flex flex-col items-center gap-1 cursor-pointer group hover:bg-white/5 p-2 rounded-lg transition-colors"},[l("div",bl,[a.coverUrl?(o(),n("img",{key:0,src:ke(C).getAssetUrl(a.coverUrl),class:"w-full h-full object-cover"},null,8,wl)):(o(),n("div",xl," üíø "))]),l("span",kl,c(a.title),1)],8,gl))),128))])):(o(),n("div",_l,[h.value==="artists"&&g.value?(o(),n("div",Tl,[l("button",{onClick:t[8]||(t[8]=a=>g.value=null),class:"w-5 h-5 rounded-full bg-white/10 hover:bg-white/20 flex items-center justify-center text-white/80 transition-colors text-xs",title:"ËøîÂõû"}," ‚Üê "),l("div",$l,[B.value.find(a=>a.id===g.value)?.coverUrl?(o(),n("img",{key:0,src:ke(C).getAssetUrl(B.value.find(a=>a.id===g.value)?.coverUrl),class:"w-5 h-5 rounded-full object-cover border border-white/10"},null,8,Il)):U("",!0),l("span",Pl,c(B.value.find(a=>a.id===g.value)?.name||"Ëâ∫‰∫∫Ê≠åÂçï"),1)]),l("button",{onClick:et,class:"text-[10px] bg-blue-500 hover:bg-blue-600 text-white px-2 py-0.5 rounded shadow-sm transition-colors"}," Êí≠ÊîæÂÖ®ÈÉ® ")])):U("",!0),h.value==="albums"&&x.value?(o(),n("div",Ul,[l("button",{onClick:t[9]||(t[9]=a=>x.value=null),class:"w-5 h-5 rounded-full bg-white/10 hover:bg-white/20 flex items-center justify-center text-white/80 transition-colors text-xs",title:"ËøîÂõû"}," ‚Üê "),l("div",Cl,[D.value.find(a=>a.id===x.value)?.coverUrl?(o(),n("img",{key:0,src:ke(C).getAssetUrl(D.value.find(a=>a.id===x.value)?.coverUrl),class:"w-5 h-5 rounded object-cover border border-white/10"},null,8,Al)):U("",!0),l("span",Ml,c(D.value.find(a=>a.id===x.value)?.title||"‰∏ìËæëÊ≠åÂçï"),1)]),l("button",{onClick:et,class:"text-[10px] bg-blue-500 hover:bg-blue-600 text-white px-2 py-0.5 rounded shadow-sm transition-colors"}," Êí≠ÊîæÂÖ®ÈÉ® ")])):U("",!0),(o(!0),n(W,null,H(d.value,(a,i)=>(o(),n("div",{key:a.id,onClick:r=>q(a),class:P(["px-3 py-0.5 hover:bg-white/10 cursor-pointer flex items-center gap-1.5 transition-colors group/item",{"bg-blue-500/20":A.value?.id===a.id}])},[l("div",Sl,[A.value?.id===a.id&&s.value.isPlaying?(o(),n("span",Nl,[...t[19]||(t[19]=[l("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"w-3.5 h-3.5 inline-block"},[l("path",{d:"M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"})],-1)])])):(o(),n("span",El,c(i+1),1))]),l("div",Ol,[l("div",{class:P(["text-xs font-medium text-white/90 truncate",{"text-blue-400":A.value?.id===a.id}])},c(a.title),3),l("div",Ll,c(a.artist),1)]),l("div",zl,c(pe(a.duration||0)),1)],10,jl))),128))]))]))],32)]),l("div",{class:"w-[61.8%] flex flex-col bg-black/10 h-full relative",onWheel:t[13]||(t[13]=_(()=>{},["stop"]))},[l("div",{class:P(["absolute top-4 right-4 z-30 transition-opacity duration-300",[re.value?"opacity-100":"opacity-0 group-hover:opacity-100"]])},[l("button",{onClick:t[11]||(t[11]=a=>re.value=!re.value),class:"w-8 h-8 rounded-full bg-black/40 backdrop-blur-md flex items-center justify-center text-white/70 hover:text-white hover:bg-black/60 transition-all border border-white/10",title:"ÂàáÊç¢Êí≠ÊîæÊïàÊûú"},c(Ke.find(a=>a.id===G.value)?.icon||"üé®"),1),re.value?(o(),n("div",Rl,[(o(),n(W,null,H(Ke,a=>l("button",{key:a.id,onClick:i=>wt(a.id),class:P(["w-full px-4 py-2.5 text-left text-xs flex items-center gap-3 transition-colors hover:bg-white/10",G.value===a.id?"text-blue-400 font-bold bg-white/5":"text-white/70"])},[l("span",Fl,c(a.icon),1),l("span",null,c(a.label),1)],10,Bl)),64))])):U("",!0)],2),G.value==="lyrics"?(o(),n("div",{key:0,ref_key:"lyricsContainer",ref:Ae,class:"flex-1 overflow-y-auto overflow-x-hidden custom-scrollbar p-4 text-center scroll-smooth"},[I.value.length>0?(o(),n("div",ql,[(o(!0),n(W,null,H(I.value,(a,i)=>(o(),n("div",{key:i,class:P(["transition-all duration-500 py-2 text-sm leading-relaxed tracking-wide origin-center break-words",i===k.value?"text-white font-bold scale-[1.5] opacity-100":i===k.value+1?"text-white/90 font-bold scale-[1.3] opacity-90":i<k.value?"text-white/80 font-bold scale-[1.1] opacity-80":"text-white/35 opacity-50"]),ref_for:!0,ref:r=>{i===k.value&&(it.value=r)}},c(a.text),3))),128))])):s.value.lyrics?(o(),n("div",Dl,c(s.value.lyrics),1)):(o(),n("div",Vl,[...t[20]||(t[20]=[l("span",{class:"text-2xl opacity-50"},"üìù",-1),l("span",{class:"text-xs"},"ÊöÇÊó†Ê≠åËØç",-1)])]))],512)):G.value==="spectrum"?(o(),n("div",Jl,[l("div",Wl,[l("div",Hl,[(o(),n(W,null,H(12,a=>l("div",{key:a,class:"w-1.5 bg-gradient-to-t from-blue-600/40 to-blue-400/80 rounded-t-sm animate-pulse",style:R({height:`${20+Math.random()*80}%`,animationDuration:`${.5+Math.random()*1}s`})},null,4)),64))]),l("div",Gl,[I.value.length>0&&k.value>=0?(o(),n("div",Kl,[l("div",Ql,c(I.value[k.value]?.text),1),I.value[k.value+1]?(o(),n("div",Xl,c(I.value[k.value+1]?.text),1)):U("",!0)])):(o(),n("div",Yl,[...t[21]||(t[21]=[l("span",{class:"text-xs font-medium text-white/60"},"È¢ëË∞±ÂàÜÊûê",-1),l("span",{class:"text-[10px] opacity-50"},"Spectrum Analyzer",-1)])]))])])])):G.value==="abstract"?(o(),n("div",Zl,[t[23]||(t[23]=Ht('<div class="relative w-40 h-40 flex items-center justify-center" data-v-c9dbb507><div class="absolute inset-0 rounded-full border border-blue-500/20 animate-[ping_3s_linear_infinite]" data-v-c9dbb507></div><div class="absolute inset-4 rounded-full border border-purple-500/20 animate-[ping_2s_linear_infinite]" data-v-c9dbb507></div><div class="absolute inset-8 rounded-full border border-pink-500/20 animate-pulse" data-v-c9dbb507></div><div class="z-10 text-3xl animate-bounce" data-v-c9dbb507>‚ú®</div></div>',1)),l("div",es,[I.value.length>0&&k.value>=0?(o(),n("div",ts,[l("div",as,c(I.value[k.value]?.text),1),I.value[k.value+1]?(o(),n("div",ls,c(I.value[k.value+1]?.text),1)):U("",!0)])):(o(),n("div",ss,[...t[22]||(t[22]=[l("span",{class:"text-xs font-medium text-white/60"},"ÊäΩË±°Âä®Áîª",-1),l("span",{class:"text-[10px] opacity-50"},"Abstract Visualizations",-1)])]))])])):G.value==="vinyl"?(o(),n("div",is,[l("div",rs,[l("div",{class:P(["w-56 h-56 rounded-full bg-[#111] border-[6px] border-[#222] shadow-[0_0_50px_rgba(0,0,0,0.8)] flex items-center justify-center relative overflow-hidden",{"animate-[spin_10s_linear_infinite]":s.value.isPlaying}])},[t[24]||(t[24]=l("div",{class:"absolute inset-0 opacity-30",style:{background:`repeating-radial-gradient(
                      circle,
                      transparent 0,
                      transparent 3px,
                      rgba(255, 255, 255, 0.05) 4px,
                      transparent 5px
                    )`}},null,-1)),l("div",ns,[se.value?.coverUrl?(o(),n("img",{key:0,src:st(se.value),class:"w-full h-full object-cover"},null,8,os)):(o(),n("div",cs," üíø "))]),t[25]||(t[25]=l("div",{class:"absolute w-2 h-2 bg-black rounded-full z-20 shadow-inner"},null,-1))],2),l("div",{class:"absolute -top-6 -right-4 w-32 h-32 pointer-events-none transition-transform duration-700 ease-in-out origin-[85%_15%]",style:R({transform:s.value.isPlaying?"rotate(0deg)":"rotate(-25deg)"})},[...t[26]||(t[26]=[l("div",{class:"absolute top-[15%] right-[15%] w-4 h-4 bg-zinc-600 rounded-full"},null,-1),l("div",{class:"absolute top-[18%] right-[17%] w-1.5 h-24 bg-gradient-to-b from-zinc-500 to-zinc-700 rounded-full origin-top rotate-[25deg]"},null,-1),l("div",{class:"absolute bottom-[15%] left-[10%] w-4 h-6 bg-zinc-800 rounded-sm rotate-[25deg]"},null,-1)])],4)]),l("div",us,[I.value.length>0&&k.value>=0?(o(),n("div",ds,[l("div",vs,c(I.value[k.value]?.text),1),I.value[k.value+1]?(o(),n("div",ps,c(I.value[k.value+1]?.text),1)):U("",!0)])):(o(),n("div",fs,[...t[27]||(t[27]=[l("span",{class:"text-xs font-medium text-white/60"},"Â∞ÅÈù¢‰∏éÈªëËÉ∂",-1),l("span",{class:"text-[10px] opacity-50"},"Cover Art & Vinyl",-1)])]))])])):U("",!0),l("div",ys,[l("div",ms,[l("div",hs,[l("button",{onClick:Se,class:"w-7 h-7 rounded-full flex items-center justify-center bg-white/5 hover:bg-white/10 transition-colors text-white/70"},c(Ve)),l("button",{onClick:ge,class:"w-8 h-8 rounded-full flex items-center justify-center bg-white/10 hover:bg-white/20 transition-colors text-white scale-[1.3] transition-transform"},c(s.value.isPlaying?He:We),1),l("button",{onClick:t[12]||(t[12]=()=>ve()),class:"w-7 h-7 rounded-full flex items-center justify-center bg-white/5 hover:bg-white/10 transition-colors text-white/70"},c(Je))]),l("div",gs,[t[28]||(t[28]=l("span",{class:"text-xs text-white/70"},[l("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",class:"w-4 h-4"},[l("path",{d:"M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"})])],-1)),l("input",{type:"range",min:"0",max:"1",step:"0.05",value:s.value.volume,onInput:Le,class:"w-20 h-1 bg-white/20 rounded-lg appearance-none cursor-pointer accent-blue-400"},null,40,bs)])])])],32)]))],4))}}),_s=Qt(ws,[["__scopeId","data-v-c9dbb507"]]);export{_s as default};
