import{d as j,u as M,r as m,c as T,w as S,E as N,o as $,e as r,b as a,m as B,h as u,q as H,f as k,F as D,i as C,n as L,t as b,g as W,j as z,G as A,k as Y,C as U,_ as q}from"./index-0Xhfa8Kb.js";const G={key:0,class:"w-full py-2.5 text-xs text-white/60 text-center"},P=["onClick"],J={key:0,class:"absolute bottom-0 left-0 right-0 h-0.5 bg-white/60"},K={class:"flex-1 overflow-hidden relative"},O={key:0,class:"h-full flex flex-col items-center justify-center text-white/60 p-4 text-center"},Q={key:1,class:"p-8 text-center text-white/60 text-xs animate-pulse"},X={key:2,class:"p-8 text-center text-white/70 text-xs"},Z={key:3,class:"flex flex-col py-1"},ee=["href"],te={class:"text-sm text-white/80 group-hover/item:text-white transition-colors font-medium line-clamp-2 mb-1"},se={class:"flex justify-between items-center"},oe={key:0,class:"text-[10px] text-white/50 line-clamp-1 flex-1 mr-2"},le={key:1,class:"text-[10px] text-white/40 whitespace-nowrap"},re=900*1e3,ae=j({__name:"RssWidget",props:{widget:{}},setup(F){const i=M(),c=m(""),f=m([]),w=m(!1),_=m("");let o,d;const h=T(()=>i.rssFeeds.filter(e=>e.enable)),p=m([]);S(h,e=>{const s=p.value.map(l=>l.id).join(","),t=e.map(l=>l.id).join(",");s!==t&&(p.value=[...e])},{immediate:!0,deep:!0});const I=()=>{const e=i.rssFeeds.filter(s=>!s.enable);i.rssFeeds=[...p.value,...e],i.saveData()};S(h,e=>{if(e.length>0){if(!e.find(s=>s.id===c.value)){const s=e[0];s&&(c.value=s.id,g(s))}}else c.value="",f.value=[]},{deep:!0});const g=async e=>{if(!e)return;o&&(o(),o=void 0),d&&(clearInterval(d),d=void 0),c.value=e.id,_.value="",w.value=!0,f.value=[];const s=n=>{if(n.url===e.url){const v=n.data.items||[];f.value=v.map(x=>({title:x.title,link:x.link,pubDate:x.pubDate,contentSnippet:x.contentSnippet})),w.value=!1,o&&(o(),o=void 0)}},t=n=>{if(n.url===e.url){console.error(`Failed to load RSS: ${e.title}`,n.error);const v=typeof n.error=="string"&&n.error.trim()?n.error.trim():"";_.value=v?`åŠ è½½å¤±è´¥ï¼š${v}`:"åŠ è½½å¤±è´¥",f.value=[],w.value=!1,o&&(o(),o=void 0)}};o=()=>{i.socket.off("rss:data",s),i.socket.off("rss:error",t)},i.socket.on("rss:data",s),i.socket.on("rss:error",t);const l=()=>{i.socket.emit("rss:fetch",{url:e.url})};l(),d=setInterval(l,re)};N(()=>{const e=h.value[0];e&&(c.value=e.id,g(e))}),$(()=>{o&&(o(),o=void 0),d&&(clearInterval(d),d=void 0)});const R=e=>{const s=e.currentTarget,{scrollTop:t,scrollHeight:l,clientHeight:n}=s,v=e.deltaY,x=t<=0,V=t+n>=l-1;(x&&v<0||V&&v>0)&&(e.preventDefault(),e.stopPropagation())},y=m(null),E=e=>{y.value&&e.deltaY!==0&&(y.value.scrollLeft+=e.deltaY)};return(e,s)=>(a(),r("div",{class:"w-full h-full rounded-2xl backdrop-blur border border-white/10 overflow-hidden flex flex-col text-white relative transition-shadow",style:U({backgroundColor:`rgba(0,0,0,${Math.min(.85,Math.max(.15,F.widget?.opacity??.35))})`,color:"#fff"})},[B(z(A),{ref_key:"tabsRef",ref:y,modelValue:p.value,"onUpdate:modelValue":s[0]||(s[0]=t=>p.value=t),onWheel:W(E,["prevent"]),animation:150,onEnd:I,class:"flex border-b border-white/10 bg-white/10 select-none overflow-x-auto custom-scrollbar"},{default:H(()=>[h.value.length===0?(a(),r("div",G," æš‚æ— è®¢é˜…æº ")):k("",!0),(a(!0),r(D,null,C(p.value,t=>(a(),r("button",{key:t.id,onClick:l=>g(t),class:L(["flex-shrink-0 px-4 py-2.5 text-xs font-bold transition-all flex items-center justify-center gap-1.5 relative whitespace-nowrap cursor-move",c.value===t.id?"text-white bg-white/15":"text-white/60 hover:bg-white/10 hover:text-white"])},[u("span",null,b(t.title),1),c.value===t.id?(a(),r("div",J)):k("",!0)],10,P))),128))]),_:1},8,["modelValue"]),u("div",K,[u("div",{class:"h-full overflow-y-auto custom-scrollbar p-0",onWheel:R},[h.value.length===0?(a(),r("div",O,[...s[2]||(s[2]=[u("span",{class:"text-2xl mb-2"},"ðŸ“¡",-1),u("span",{class:"text-xs"},"è¯·åœ¨è®¾ç½®ä¸­æ·»åŠ å¹¶å¯ç”¨ RSS è®¢é˜…æº",-1)])])):w.value&&f.value.length===0?(a(),r("div",Q," åŠ è½½ä¸­... ")):_.value?(a(),r("div",X,[Y(b(_.value)+" ",1),u("button",{onClick:s[1]||(s[1]=t=>g(h.value.find(l=>l.id===c.value))),class:"block mx-auto mt-2 text-white/80 hover:text-white hover:underline"}," é‡è¯• ")])):(a(),r("div",Z,[(a(!0),r(D,null,C(f.value,(t,l)=>(a(),r("a",{key:l,href:t.link,target:"_blank",class:"block px-3 py-2 hover:bg-white/10 transition-colors group/item border-b border-white/10 last:border-0"},[u("div",te,b(t.title),1),u("div",se,[t.contentSnippet?(a(),r("div",oe,b(t.contentSnippet),1)):k("",!0),t.pubDate?(a(),r("div",le,b(new Date(t.pubDate).toLocaleDateString()),1)):k("",!0)])],8,ee))),128))]))],32)])],4))}}),ie=q(ae,[["__scopeId","data-v-67ecac25"]]);export{ie as default};
