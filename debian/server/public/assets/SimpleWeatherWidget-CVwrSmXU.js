import{d as G,r as p,w as W,u as Q,c as I,E as X,o as Y,e as s,b as i,h as o,f as u,a as Z,K as tt,F as m,i as x,C as D,n as w,t as c,j as et,g as q,y as at,A as ot,B as it,T as st,W as lt,_ as nt}from"./index-0Xhfa8Kb.js";const rt={class:"h-full w-full relative overflow-hidden text-white group select-none transition-all duration-500 rounded-2xl"},dt={key:0,class:"absolute -top-10 -right-10 w-48 h-48 opacity-30 animate-spin-slow"},ut={key:1,class:"absolute inset-0"},ct={key:2,class:"absolute inset-0 overflow-hidden"},ht={key:3,class:"absolute inset-0 flex justify-around items-start overflow-hidden opacity-50"},vt={key:4,class:"absolute inset-0 overflow-hidden"},pt={key:5,class:"absolute inset-0 overflow-hidden"},wt={class:"text-sm sm:text-base font-medium opacity-90 flex items-center gap-2"},ft={key:0,class:"mt-2 text-xs opacity-75 flex items-center gap-2"},yt={key:0,class:"w-full mt-2 pt-2 border-t border-white/10 space-y-2"},gt={class:"opacity-90"},bt={class:"flex items-center gap-2 opacity-80"},mt={key:0,class:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity z-20"},xt={class:"bg-gray-900/90 p-6 rounded-2xl border border-white/10 shadow-2xl max-w-sm w-full backdrop-blur-xl"},kt={class:"mb-6 w-full"},Ct={class:"flex items-center gap-2 mb-2 text-sm"},_t={key:0,class:"text-white/30"},It={key:1,class:"text-white font-bold"},Dt={key:0,class:"grid grid-cols-4 gap-2 mb-4"},Mt=["onClick"],jt={key:1,class:"grid grid-cols-4 gap-2 max-h-[200px] overflow-y-auto pr-1 custom-scrollbar"},$t=["onClick"],St={key:2,class:"h-[200px] flex items-center justify-center text-white/40 text-xs"},Kt={class:"flex gap-3 justify-end"},Bt=G({__name:"SimpleWeatherWidget",props:{widget:{}},setup(M){const f=p(null),P=async()=>{if(!f.value)try{const e=await lt(()=>import("./cityData-DPPCip0y.js"),[]);f.value=e.cityData}catch(e){console.error("Failed to load city data",e)}},g=p(!1),y=p(""),h=p("");W(g,e=>{e&&P()});const n=M,l=Q();W(()=>[l.appConfig.weatherSource,l.appConfig.amapKey],()=>{C()});const r=p({temp:"--",city:(()=>{if(n.widget?.data?.city)return n.widget.data.city;try{const e=localStorage.getItem("flatnas_auto_city");if(e)return JSON.parse(e).city}catch{}return"定位中..."})(),text:"...",humidity:"",today:{min:"",max:""},forecast:[]}),L=p(!1);let j=null,$=null;const V=p(Array.from({length:6},(e,t)=>({id:t+1,animationDelay:`${Math.random()}s`,opacity:Math.random()}))),F=p(Array.from({length:12},(e,t)=>({id:t+1,left:`${Math.random()*100}%`,top:"-10px",animationDelay:`${Math.random()*5}s`,animationDuration:`${3+Math.random()*4}s`})));n.widget?.data?.city&&(y.value=n.widget.data.city);const S=()=>{try{if(n.widget){n.widget.data||(n.widget.data={});const e=y.value.trim();n.widget.data.city=e,C()}}catch(e){console.error("Failed to save city",e)}finally{g.value=!1}},v=I(()=>{const e=r.value.text;return e.includes("雨")?"rain":e.includes("雪")?"snow":e.includes("雾")||e.includes("霾")?"fog":e.includes("云")||e.includes("阴")?"cloudy":e.includes("晴")?L.value?"clear-night":"sunny":"default"}),T=I(()=>["snow","cloudy","fog"].includes(v.value)),N=I(()=>{switch(v.value){case"sunny":return"bg-gradient-to-br from-blue-400 via-blue-300 to-orange-200";case"clear-night":return"bg-gradient-to-br from-indigo-900 via-purple-900 to-slate-900";case"cloudy":return"bg-gradient-to-br from-slate-400 via-slate-300 to-gray-200";case"rain":return"bg-gradient-to-br from-slate-700 via-blue-900 to-slate-800";case"snow":return"bg-gradient-to-br from-blue-100 via-white to-blue-50";case"fog":return"bg-gradient-to-br from-gray-500 via-slate-400 to-zinc-400";default:return"bg-gradient-to-br from-blue-500 via-indigo-500 to-purple-500"}}),R=()=>{const e=new Date().getHours();L.value=e<6||e>=18},k=I(()=>n.widget&&n.widget.h&&n.widget.h>1&&r.value.forecast&&r.value.forecast.length>0),A=e=>{try{const t=new Date(e),a=["周日","周一","周二","周三","周四","周五","周六"],d=new Date;return t.getDate()===d.getDate()&&t.getMonth()===d.getMonth()?"今天":a[t.getDay()]}catch{return e}};let K;const H=e=>{const t=l.appConfig.weatherSource||"uapi",a=l.appConfig.amapKey||"",d=l.appConfig.qweatherProjectId||"",B=l.appConfig.qweatherKeyId||"",z=l.appConfig.qweatherPrivateKey||"";let _=`/api/weather?city=${encodeURIComponent(e)}&source=${t}&key=${encodeURIComponent(a)}`;return t==="qweather"&&(_+=`&projectId=${encodeURIComponent(d)}&keyId=${encodeURIComponent(B)}&privateKey=${encodeURIComponent(z)}`),_},C=async()=>{K?.();const e=n.widget?.data?.city||y.value||"Shanghai",t=b=>{(b.city===e||b.city==="Shanghai"&&!n.widget?.data?.city)&&(r.value=b.data,d())},a=async b=>{if(b.city===e)try{const U=await fetch(H(e));if(!U.ok)throw new Error("REST weather failed");const E=await U.json();if(!E.success||!E.data)throw new Error("REST payload invalid");r.value=E.data}catch{r.value={temp:"22",city:n.widget?.data?.city||"本地",text:"舒适",humidity:"50%",today:{min:"18",max:"25"},forecast:[]}}finally{d()}},d=()=>{l.socket.off("weather:data",t),l.socket.off("weather:error",a)};K=d,l.socket.on("weather:data",t),l.socket.on("weather:error",a);const B=l.appConfig.weatherSource||"uapi",z=l.appConfig.amapKey||"",_=l.appConfig.qweatherProjectId||"",O=l.appConfig.qweatherKeyId||"",J=l.appConfig.qweatherPrivateKey||"";l.socket.emit("weather:fetch",{city:e,source:B,key:z,projectId:_,keyId:O,privateKey:J})};return X(()=>{R(),C(),j=setInterval(R,6e4),$=setInterval(C,36e5)}),Y(()=>{j&&clearInterval(j),$&&clearInterval($),K?.()}),(e,t)=>(i(),s("div",rt,[o("div",{class:w(["absolute inset-0 transition-colors duration-1000 ease-in-out",N.value]),style:D({opacity:M.widget?.opacity??1})},[v.value==="sunny"?(i(),s("div",dt,[...t[5]||(t[5]=[o("svg",{viewBox:"0 0 100 100",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[o("circle",{cx:"50",cy:"50",r:"20",fill:"yellow"}),o("path",{d:"M50 10V20 M50 80V90 M10 50H20 M80 50H90 M22 22L29 29 M71 71L78 78 M22 78L29 71 M71 29L78 22",stroke:"yellow","stroke-width":"4","stroke-linecap":"round"})],-1)])])):u("",!0),v.value==="clear-night"?(i(),s("div",ut,[...t[6]||(t[6]=[tt('<div class="absolute top-10 right-10 w-16 h-16 text-yellow-100 opacity-80 animate-pulse" data-v-66d70fd4><svg viewBox="0 0 24 24" fill="currentColor" data-v-66d70fd4><path d="M12 3a9 9 0 1 0 9 9c0-.46-.04-.92-.1-1.36a5.389 5.389 0 0 1-4.4 2.26 5.403 5.403 0 0 1-3.14-9.8c-.44-.06-.9-.1-1.36-.1z" data-v-66d70fd4></path></svg></div><div class="star absolute top-1/4 left-1/4 w-1 h-1 bg-white rounded-full animate-twinkle" data-v-66d70fd4></div><div class="star absolute top-3/4 right-1/3 w-1 h-1 bg-white rounded-full animate-twinkle delay-75" data-v-66d70fd4></div><div class="star absolute bottom-1/4 left-1/3 w-1 h-1 bg-white rounded-full animate-twinkle delay-150" data-v-66d70fd4></div>',4)])])):u("",!0),v.value==="cloudy"?(i(),s("div",ct,[...t[7]||(t[7]=[o("div",{class:"absolute top-4 right-[-20%] w-32 h-20 opacity-40 animate-float-slow"},[o("svg",{viewBox:"0 0 24 24",fill:"currentColor",class:"text-white"},[o("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96z"})])],-1)])])):u("",!0),v.value==="rain"?(i(),s("div",ht,[(i(!0),s(m,null,x(V.value,a=>(i(),s("div",{key:a.id,class:"w-0.5 h-16 bg-gradient-to-b from-transparent to-white animate-rain",style:D({animationDelay:a.animationDelay,opacity:a.opacity})},null,4))),128))])):u("",!0),v.value==="snow"?(i(),s("div",vt,[(i(!0),s(m,null,x(F.value,a=>(i(),s("div",{key:a.id,class:"absolute w-1.5 h-1.5 bg-white rounded-full animate-snow opacity-80",style:D({left:a.left,top:a.top,animationDelay:a.animationDelay,animationDuration:a.animationDuration})},null,4))),128))])):u("",!0),v.value==="fog"?(i(),s("div",pt,[...t[8]||(t[8]=[o("div",{class:"absolute bottom-0 left-[-50%] w-[200%] h-[60%] bg-white/20 blur-[40px] animate-fog-flow"},null,-1),o("div",{class:"absolute bottom-[-20%] left-[-20%] w-[150%] h-[50%] bg-white/10 blur-[30px] animate-fog-flow-reverse"},null,-1)])])):u("",!0)],6),o("div",{class:w(["absolute inset-0 backdrop-blur-[0px] group-hover:backdrop-blur-[2px] transition-all duration-500",T.value?"bg-black/30":"bg-black/5"]),style:D({opacity:M.widget?.opacity??1})},null,6),o("div",{class:w(["relative z-10 h-full flex flex-col items-center p-4 transition-all",k.value?"justify-between":"justify-center"])},[o("div",{class:w(["flex flex-col items-center justify-center",{"flex-1":k.value}])},[o("div",{class:w(["text-4xl sm:text-5xl font-bold tracking-tighter mb-2",T.value?"drop-shadow-[0_2px_4px_rgba(0,0,0,0.8)]":"drop-shadow-lg"])},c(r.value.temp)+"° ",3),o("div",wt,[o("span",null,c(r.value.text),1),t[9]||(t[9]=o("span",{class:"w-1 h-1 rounded-full bg-white/50"},null,-1)),o("span",null,c(r.value.city),1)]),r.value.today&&r.value.today.min&&!k.value?(i(),s("div",ft,[o("span",null,c(r.value.today.min)+"° / "+c(r.value.today.max)+"°",1)])):u("",!0)],2),k.value?(i(),s("div",yt,[(i(!0),s(m,null,x(r.value.forecast.slice(0,3),(a,d)=>(i(),s("div",{key:d,class:"flex items-center justify-between text-xs font-medium"},[o("span",gt,c(A(a.date)),1),o("div",bt,[o("span",null,c(a.mintempC)+"° / "+c(a.maxtempC)+"°",1)])]))),128))])):u("",!0)],2),n.widget&&et(l).isLogged?(i(),s("div",mt,[o("button",{onClick:t[0]||(t[0]=q(a=>g.value=!0,["stop"])),class:"p-1.5 bg-black/10 text-white/70 hover:text-white rounded-full hover:bg-black/30 backdrop-blur-md transition-colors",title:"设置城市"},[...t[10]||(t[10]=[o("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})],-1)])])])):u("",!0),(i(),Z(st,{to:"body"},[g.value?(i(),s("div",{key:0,class:"fixed inset-0 bg-black/60 backdrop-blur-md z-[9999] flex flex-col items-center justify-center p-4",onClick:t[4]||(t[4]=q(()=>{},["stop"]))},[o("div",xt,[t[11]||(t[11]=o("div",{class:"text-lg font-medium mb-4 text-white"},"设置城市",-1)),at(o("input",{"onUpdate:modelValue":t[1]||(t[1]=a=>y.value=a),onKeyup:it(S,["enter"]),placeholder:"输入城市 (为空自动)",class:"w-full bg-white/10 border border-white/20 rounded-lg px-3 py-2 text-white placeholder-white/40 text-left outline-none focus:bg-white/20 focus:border-white/40 mb-4 transition-all",autofocus:""},null,544),[[ot,y.value]]),o("div",kt,[o("div",Ct,[o("button",{onClick:t[2]||(t[2]=a=>h.value=""),class:w(["text-white/50 hover:text-white transition-colors",{"font-bold text-white":!h.value}])}," 省份/地区 ",2),h.value?(i(),s("span",_t,"/")):u("",!0),h.value?(i(),s("span",It,c(h.value),1)):u("",!0)]),h.value?f.value&&f.value[h.value]?(i(),s("div",jt,[(i(!0),s(m,null,x(f.value[h.value],a=>(i(),s("button",{key:a,onClick:d=>{y.value=a,S()},class:w(["px-2 py-1.5 bg-white/5 hover:bg-white/20 text-white/70 hover:text-white rounded text-xs transition-colors truncate border border-white/5 hover:border-white/20",{"bg-blue-500 text-white":y.value===a}])},c(a),11,$t))),128))])):(i(),s("div",St," 加载中... ")):(i(),s("div",Dt,[(i(!0),s(m,null,x(f.value?Object.keys(f.value):[],a=>(i(),s("button",{key:a,onClick:d=>h.value=a,class:w(["px-2 py-1.5 text-xs rounded transition-colors text-center truncate border",h.value===a?"bg-blue-500 border-blue-500 text-white shadow-md":"bg-white/5 border-white/10 text-white/70 hover:bg-white/10 hover:border-white/20"])},c(a),11,Mt))),128))]))]),o("div",Kt,[o("button",{onClick:t[3]||(t[3]=a=>g.value=!1),class:"px-4 py-2 bg-white/5 hover:bg-white/10 text-white/80 rounded-lg text-sm transition-colors"}," 取消 "),o("button",{onClick:S,class:"px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded-lg text-sm transition-colors font-medium shadow-lg shadow-blue-900/20"}," 确定 ")])])])):u("",!0)]))]))}}),Lt=nt(Bt,[["__scopeId","data-v-66d70fd4"]]);export{Lt as default};
